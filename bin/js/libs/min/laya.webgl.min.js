Laya.interface("laya.webgl.shapes.IShape"),Laya.interface("laya.webgl.submit.ISubmit"),Laya.interface("laya.webgl.text.ICharSegment"),Laya.interface("laya.webgl.canvas.save.ISaveData"),Laya.interface("laya.webgl.resource.IMergeAtlasBitmap"),Laya.interface("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var FilterActionGL=function(){function t(){}__class(t,"laya.filters.webgl.FilterActionGL",!0);var e=t.prototype;return Laya.imps(e,{"laya.filters.IFilterActionGL":!0}),e.setValue=LAYAFNVOID,e.setValueMix=LAYAFNVOID,e.apply3d=LAYAFNNULL,e.apply=LAYAFNNULL,__getset(0,e,"typeMix",function(){return 0}),t}(),ShaderValue=function(){function t(){}return __class(t,"laya.webgl.shader.ShaderValue",!0),t}(),WebGLContext=function(){function r(){}return __class(r,"laya.webgl.WebGLContext",!0),r.UseProgram=function(t){return r._useProgram!=t&&(WebGL.mainContext.useProgram(t),r._useProgram=t,!0)},r.setDepthTest=function(t,e){e!=r._depthTest&&((r._depthTest=e)?t.enable(2929):t.disable(2929))},r.setDepthMask=function(t,e){e!=r._depthMask&&(r._depthMask=e,t.depthMask(e))},r.setDepthFunc=function(t,e){e!=r._depthFunc&&(r._depthFunc=e,t.depthFunc(e))},r.setBlend=function(t,e){e!=r._blend&&((r._blend=e)?t.enable(3042):t.disable(3042))},r.setBlendFunc=function(t,e,i){(e!==r._sFactor||i!==r._dFactor)&&(r._sFactor=e,r._dFactor=i,t.blendFunc(e,i))},r.setCullFace=function(t,e){e!=r._cullFace&&((r._cullFace=e)?t.enable(2884):t.disable(2884))},r.setFrontFace=function(t,e){e!=r._frontFace&&(r._frontFace=e,t.frontFace(e))},r.bindTexture=function(t,e,i){t.bindTexture(e,i),r.curBindTexTarget=e,r.curBindTexValue=i},r.DEPTH_BUFFER_BIT=256,r.STENCIL_BUFFER_BIT=1024,r.COLOR_BUFFER_BIT=16384,r.POINTS=0,r.LINES=1,r.LINE_LOOP=2,r.LINE_STRIP=3,r.TRIANGLES=4,r.TRIANGLE_STRIP=5,r.TRIANGLE_FAN=6,r.ZERO=0,r.ONE=1,r.SRC_COLOR=768,r.ONE_MINUS_SRC_COLOR=769,r.SRC_ALPHA=770,r.ONE_MINUS_SRC_ALPHA=771,r.DST_ALPHA=772,r.ONE_MINUS_DST_ALPHA=773,r.DST_COLOR=774,r.ONE_MINUS_DST_COLOR=775,r.SRC_ALPHA_SATURATE=776,r.FUNC_ADD=32774,r.BLEND_EQUATION=32777,r.BLEND_EQUATION_RGB=32777,r.BLEND_EQUATION_ALPHA=34877,r.FUNC_SUBTRACT=32778,r.FUNC_REVERSE_SUBTRACT=32779,r.BLEND_DST_RGB=32968,r.BLEND_SRC_RGB=32969,r.BLEND_DST_ALPHA=32970,r.BLEND_SRC_ALPHA=32971,r.CONSTANT_COLOR=32769,r.ONE_MINUS_CONSTANT_COLOR=32770,r.CONSTANT_ALPHA=32771,r.ONE_MINUS_CONSTANT_ALPHA=32772,r.BLEND_COLOR=32773,r.ARRAY_BUFFER=34962,r.ELEMENT_ARRAY_BUFFER=34963,r.ARRAY_BUFFER_BINDING=34964,r.ELEMENT_ARRAY_BUFFER_BINDING=34965,r.STREAM_DRAW=35040,r.STATIC_DRAW=35044,r.DYNAMIC_DRAW=35048,r.BUFFER_SIZE=34660,r.BUFFER_USAGE=34661,r.CURRENT_VERTEX_ATTRIB=34342,r.FRONT=1028,r.BACK=1029,r.CULL_FACE=2884,r.FRONT_AND_BACK=1032,r.BLEND=3042,r.DITHER=3024,r.STENCIL_TEST=2960,r.DEPTH_TEST=2929,r.SCISSOR_TEST=3089,r.POLYGON_OFFSET_FILL=32823,r.SAMPLE_ALPHA_TO_COVERAGE=32926,r.SAMPLE_COVERAGE=32928,r.NO_ERROR=0,r.INVALID_ENUM=1280,r.INVALID_VALUE=1281,r.INVALID_OPERATION=1282,r.OUT_OF_MEMORY=1285,r.CW=2304,r.CCW=2305,r.LINE_WIDTH=2849,r.ALIASED_POINT_SIZE_RANGE=33901,r.ALIASED_LINE_WIDTH_RANGE=33902,r.CULL_FACE_MODE=2885,r.FRONT_FACE=2886,r.DEPTH_RANGE=2928,r.DEPTH_WRITEMASK=2930,r.DEPTH_CLEAR_VALUE=2931,r.DEPTH_FUNC=2932,r.STENCIL_CLEAR_VALUE=2961,r.STENCIL_FUNC=2962,r.STENCIL_FAIL=2964,r.STENCIL_PASS_DEPTH_FAIL=2965,r.STENCIL_PASS_DEPTH_PASS=2966,r.STENCIL_REF=2967,r.STENCIL_VALUE_MASK=2963,r.STENCIL_WRITEMASK=2968,r.STENCIL_BACK_FUNC=34816,r.STENCIL_BACK_FAIL=34817,r.STENCIL_BACK_PASS_DEPTH_FAIL=34818,r.STENCIL_BACK_PASS_DEPTH_PASS=34819,r.STENCIL_BACK_REF=36003,r.STENCIL_BACK_VALUE_MASK=36004,r.STENCIL_BACK_WRITEMASK=36005,r.VIEWPORT=2978,r.SCISSOR_BOX=3088,r.COLOR_CLEAR_VALUE=3106,r.COLOR_WRITEMASK=3107,r.UNPACK_ALIGNMENT=3317,r.PACK_ALIGNMENT=3333,r.MAX_TEXTURE_SIZE=3379,r.MAX_VIEWPORT_DIMS=3386,r.SUBPIXEL_BITS=3408,r.RED_BITS=3410,r.GREEN_BITS=3411,r.BLUE_BITS=3412,r.ALPHA_BITS=3413,r.DEPTH_BITS=3414,r.STENCIL_BITS=3415,r.POLYGON_OFFSET_UNITS=10752,r.POLYGON_OFFSET_FACTOR=32824,r.TEXTURE_BINDING_2D=32873,r.SAMPLE_BUFFERS=32936,r.SAMPLES=32937,r.SAMPLE_COVERAGE_VALUE=32938,r.SAMPLE_COVERAGE_INVERT=32939,r.NUM_COMPRESSED_TEXTURE_FORMATS=34466,r.COMPRESSED_TEXTURE_FORMATS=34467,r.DONT_CARE=4352,r.FASTEST=4353,r.NICEST=4354,r.GENERATE_MIPMAP_HINT=33170,r.BYTE=5120,r.UNSIGNED_BYTE=5121,r.SHORT=5122,r.UNSIGNED_SHORT=5123,r.INT=5124,r.UNSIGNED_INT=5125,r.FLOAT=5126,r.DEPTH_COMPONENT=6402,r.ALPHA=6406,r.RGB=6407,r.RGBA=6408,r.LUMINANCE=6409,r.LUMINANCE_ALPHA=6410,r.UNSIGNED_SHORT_4_4_4_4=32819,r.UNSIGNED_SHORT_5_5_5_1=32820,r.UNSIGNED_SHORT_5_6_5=33635,r.FRAGMENT_SHADER=35632,r.VERTEX_SHADER=35633,r.MAX_VERTEX_ATTRIBS=34921,r.MAX_VERTEX_UNIFORM_VECTORS=36347,r.MAX_VARYING_VECTORS=36348,r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,r.MAX_TEXTURE_IMAGE_UNITS=34930,r.MAX_FRAGMENT_UNIFORM_VECTORS=36349,r.SHADER_TYPE=35663,r.DELETE_STATUS=35712,r.LINK_STATUS=35714,r.VALIDATE_STATUS=35715,r.ATTACHED_SHADERS=35717,r.ACTIVE_UNIFORMS=35718,r.ACTIVE_ATTRIBUTES=35721,r.SHADING_LANGUAGE_VERSION=35724,r.CURRENT_PROGRAM=35725,r.NEVER=512,r.LESS=513,r.EQUAL=514,r.LEQUAL=515,r.GREATER=516,r.NOTEQUAL=517,r.GEQUAL=518,r.ALWAYS=519,r.KEEP=7680,r.REPLACE=7681,r.INCR=7682,r.DECR=7683,r.INVERT=5386,r.INCR_WRAP=34055,r.DECR_WRAP=34056,r.VENDOR=7936,r.RENDERER=7937,r.VERSION=7938,r.NEAREST=9728,r.LINEAR=9729,r.NEAREST_MIPMAP_NEAREST=9984,r.LINEAR_MIPMAP_NEAREST=9985,r.NEAREST_MIPMAP_LINEAR=9986,r.LINEAR_MIPMAP_LINEAR=9987,r.TEXTURE_MAG_FILTER=10240,r.TEXTURE_MIN_FILTER=10241,r.TEXTURE_WRAP_S=10242,r.TEXTURE_WRAP_T=10243,r.TEXTURE_2D=3553,r.TEXTURE=5890,r.TEXTURE_CUBE_MAP=34067,r.TEXTURE_BINDING_CUBE_MAP=34068,r.TEXTURE_CUBE_MAP_POSITIVE_X=34069,r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,r.MAX_CUBE_MAP_TEXTURE_SIZE=34076,r.TEXTURE0=33984,r.TEXTURE1=33985,r.TEXTURE2=33986,r.TEXTURE3=33987,r.TEXTURE4=33988,r.TEXTURE5=33989,r.TEXTURE6=33990,r.TEXTURE7=33991,r.TEXTURE8=33992,r.TEXTURE9=33993,r.TEXTURE10=33994,r.TEXTURE11=33995,r.TEXTURE12=33996,r.TEXTURE13=33997,r.TEXTURE14=33998,r.TEXTURE15=33999,r.TEXTURE16=34e3,r.TEXTURE17=34001,r.TEXTURE18=34002,r.TEXTURE19=34003,r.TEXTURE20=34004,r.TEXTURE21=34005,r.TEXTURE22=34006,r.TEXTURE23=34007,r.TEXTURE24=34008,r.TEXTURE25=34009,r.TEXTURE26=34010,r.TEXTURE27=34011,r.TEXTURE28=34012,r.TEXTURE29=34013,r.TEXTURE30=34014,r.TEXTURE31=34015,r.ACTIVE_TEXTURE=34016,r.REPEAT=10497,r.CLAMP_TO_EDGE=33071,r.MIRRORED_REPEAT=33648,r.FLOAT_VEC2=35664,r.FLOAT_VEC3=35665,r.FLOAT_VEC4=35666,r.INT_VEC2=35667,r.INT_VEC3=35668,r.INT_VEC4=35669,r.BOOL=35670,r.BOOL_VEC2=35671,r.BOOL_VEC3=35672,r.BOOL_VEC4=35673,r.FLOAT_MAT2=35674,r.FLOAT_MAT3=35675,r.FLOAT_MAT4=35676,r.SAMPLER_2D=35678,r.SAMPLER_CUBE=35680,r.VERTEX_ATTRIB_ARRAY_ENABLED=34338,r.VERTEX_ATTRIB_ARRAY_SIZE=34339,r.VERTEX_ATTRIB_ARRAY_STRIDE=34340,r.VERTEX_ATTRIB_ARRAY_TYPE=34341,r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,r.VERTEX_ATTRIB_ARRAY_POINTER=34373,r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,r.COMPILE_STATUS=35713,r.LOW_FLOAT=36336,r.MEDIUM_FLOAT=36337,r.HIGH_FLOAT=36338,r.LOW_INT=36339,r.MEDIUM_INT=36340,r.HIGH_INT=36341,r.FRAMEBUFFER=36160,r.RENDERBUFFER=36161,r.RGBA4=32854,r.RGB5_A1=32855,r.RGB565=36194,r.DEPTH_COMPONENT16=33189,r.STENCIL_INDEX=6401,r.STENCIL_INDEX8=36168,r.DEPTH_STENCIL=34041,r.RENDERBUFFER_WIDTH=36162,r.RENDERBUFFER_HEIGHT=36163,r.RENDERBUFFER_INTERNAL_FORMAT=36164,r.RENDERBUFFER_RED_SIZE=36176,r.RENDERBUFFER_GREEN_SIZE=36177,r.RENDERBUFFER_BLUE_SIZE=36178,r.RENDERBUFFER_ALPHA_SIZE=36179,r.RENDERBUFFER_DEPTH_SIZE=36180,r.RENDERBUFFER_STENCIL_SIZE=36181,r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,r.COLOR_ATTACHMENT0=36064,r.DEPTH_ATTACHMENT=36096,r.STENCIL_ATTACHMENT=36128,r.DEPTH_STENCIL_ATTACHMENT=33306,r.NONE=0,r.FRAMEBUFFER_COMPLETE=36053,r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,r.FRAMEBUFFER_UNSUPPORTED=36061,r.FRAMEBUFFER_BINDING=36006,r.RENDERBUFFER_BINDING=36007,r.MAX_RENDERBUFFER_SIZE=34024,r.INVALID_FRAMEBUFFER_OPERATION=1286,r.UNPACK_FLIP_Y_WEBGL=37440,r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,r.CONTEXT_LOST_WEBGL=37442,r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,r.BROWSER_DEFAULT_WEBGL=37444,r._useProgram=null,r._depthTest=!0,r._depthMask=!0,r._blend=!1,r._cullFace=!1,r.curBindTexTarget=null,r.curBindTexValue=null,__static(r,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),r}(),SubmitCMD=function(){function r(){this.fun=null,this.args=null}__class(r,"laya.webgl.submit.SubmitCMD",!0);var t=r.prototype;return Laya.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(null,this.args),1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=r._cache;t[t._length++]=this},r.create=function(t,e){var i=r._cache._length?r._cache[--r._cache._length]:new r;return i.fun=e,i.args=t,i},r._cache=((r._cache=[])._length=0,r._cache),r}(),SubmitOtherIBVB=function(){function _(){this.offset=0,this.startIndex=0,this._mat=Matrix.create()}__class(_,"laya.webgl.submit.SubmitOtherIBVB",!0);var t=_.prototype;return Laya.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.releaseRender=function(){var t=_._cache;t[t._length++]=this},t.getRenderType=function(){return 10009},t.renderSubmit=function(){var t=this._shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this._shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=RenderState2D.worldMatrix4,r=Matrix.TEMP;Matrix.mulPre(this._mat,i[0],i[1],i[4],i[5],i[12],i[13],r);var a=RenderState2D.worldMatrix4=_.tempMatrix4;a[0]=r.a,a[1]=r.b,a[4]=r.c,a[5]=r.d,a[12]=r.tx,a[13]=r.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var s=WebGL.mainContext;return BlendMode.activeBlendFunction!=this._blendFn&&(s.enable(3042),this._blendFn(s),BlendMode.activeBlendFunction=this._blendFn),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,s.drawElements(4,this._numEle,5123,this.startIndex),RenderState2D.worldMatrix4=i,BaseShader.activeShader=null,1},_.create=function(t,e,i,r,a,s,n,h,l){void 0===l&&(l=0);var o=_._cache._length?_._cache[--_._cache._length]:new _;o._ib=i,o._vb=e,o._numEle=r,o._shader=a,o._shaderValue=s;var u=t._nBlendType;switch(o._blendFn=t._targets?BlendMode.targetFns[u]:BlendMode.fns[u],l){case 0:o.offset=0,o.startIndex=h/(CONST3D2D.BYTES_PE*e.vertexStride)*1.5,o.startIndex*=CONST3D2D.BYTES_PIDX;break;case 1:o.startIndex=n,o.offset=h}return o},_._cache=((_._cache=[])._length=0,_._cache),_.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_}(),SubmitScissor=function(){function i(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new Rectangle,this.screenRect=new Rectangle}__class(i,"laya.webgl.submit.SubmitScissor",!0);var t=i.prototype;return Laya.imps(t,{"laya.webgl.submit.ISubmit":!0}),t._scissor=function(t,e,i,r){var a=RenderState2D.worldMatrix4,s=a[0],n=a[5],h=a[12],l=a[13];if(r*=n,(i*=s)<1||r<1)return!1;var o=(t=t*s+h)+i,u=(e=e*n+l)+r;t<0&&(i=o-(t=0)),e<0&&(r=u-(e=0));var _=RenderState2D.worldClipRect;if(t=Math.max(t,_.x),e=Math.max(e,_.y),i=Math.min(o,_.right)-t,r=Math.min(u,_.bottom)-e,i<1||r<1)return!1;var c=RenderState2D.worldScissorTest;return this.screenRect.copyFrom(_),_.x=t,_.y=e,_.width=i,_.height=r,RenderState2D.worldScissorTest=!0,e=RenderState2D.height-e-r,WebGL.mainContext.scissor(t,e,i,r),WebGL.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),c?(e=RenderState2D.height-this.screenRect.y-this.screenRect.height,WebGL.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),WebGL.mainContext.enable(3089)):(WebGL.mainContext.disable(3089),RenderState2D.worldScissorTest=!1),_.copyFrom(this.screenRect),!0},t._scissorWithTagart=function(t,e,i,r){if(i<1||r<1)return!1;var a=t+i,s=e+r;t<0&&(i=a-(t=0)),e<0&&(r=s-(e=0));var n=RenderState2D.worldClipRect;if(t=Math.max(t,n.x),e=Math.max(e,n.y),i=Math.min(a,n.right)-t,r=Math.min(s,n.bottom)-e,i<1||r<1)return!1;var h=RenderState2D.worldScissorTest;return this.screenRect.copyFrom(n),RenderState2D.worldScissorTest=!0,n.x=t,n.y=e,n.width=i,n.height=r,e=RenderState2D.height-e-r,WebGL.mainContext.scissor(t,e,i,r),WebGL.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),h?(e=RenderState2D.height-this.screenRect.y-this.screenRect.height,WebGL.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),WebGL.mainContext.enable(3089)):(WebGL.mainContext.disable(3089),RenderState2D.worldScissorTest=!1),n.copyFrom(this.screenRect),!0},t.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1||(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height)),this.submitLength+1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=i._cache;(t[t._length++]=this).context=null},i.create=function(t){var e=i._cache._length?i._cache[--i._cache._length]:new i;return e.context=t,e},i._cache=((i._cache=[])._length=0,i._cache),i}(),SubmitStencil=function(){function l(){this.step=0,this.blendMode=null,this.level=0}__class(l,"laya.webgl.submit.SubmitStencil",!0);var t=l.prototype;return Laya.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6();break;case 7:this.do7();break;case 8:this.do8()}return 1},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=l._cache;t[t._length++]=this},t.do1=function(){var t=WebGL.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7682)},t.do2=function(){var t=WebGL.mainContext;t.stencilFunc(514,this.level+1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},t.do3=function(){var t=WebGL.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680),t.clear(1024),t.disable(2960)},t.do4=function(){var t=WebGL.mainContext;0==this.level&&(t.enable(2960),t.clear(1024)),t.colorMask(!1,!1,!1,!1),t.stencilFunc(519,0,255),t.stencilOp(7680,7680,7682)},t.do5=function(){var t=WebGL.mainContext;t.stencilFunc(514,this.level,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},t.do6=function(){var t=WebGL.mainContext;BlendMode.targetFns[BlendMode.TOINT[this.blendMode]](t)},t.do7=function(){var t=WebGL.mainContext;t.colorMask(!1,!1,!1,!1),t.stencilOp(7680,7680,7683)},t.do8=function(){var t=WebGL.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7680)},l.restore=function(t,e,i,r,a){var s;if((t._renderKey=0)<l._mask&&l._mask--,0==l._mask)s=laya.webgl.submit.SubmitStencil.create(3),t.addRenderObject(s),t._curSubmit=Submit.RENDERBASE;else{s=laya.webgl.submit.SubmitStencil.create(7),t.addRenderObject(s);var n=t._vb;n._byteLength;if(GlUtils.fillRectImgVb(n,null,e.x,e.y,e.width,e.height,Texture.DEF_UV,i,r,a,0,0)){t._shader2D.glTexture=null;var h=t._curSubmit=Submit.createSubmit(t,t._ib,n,(n._byteLength-64)/32*3,Value2D.create(2,0));h.shaderValue.ALPHA=1,t._submits[t._submits._length++]=h,t._curSubmit._numEle+=6,t._curSubmit=Submit.RENDERBASE}else alert("clipRect calc stencil rect error");s=laya.webgl.submit.SubmitStencil.create(8),t.addRenderObject(s)}},l.restore2=function(t,e){var i;(t._renderKey=0)<l._mask&&l._mask--,0==l._mask?(i=laya.webgl.submit.SubmitStencil.create(3),t.addRenderObject(i),t._curSubmit=Submit.RENDERBASE):(i=laya.webgl.submit.SubmitStencil.create(7),t.addRenderObject(i),t._submits[t._submits._length++]=e,i=laya.webgl.submit.SubmitStencil.create(8),t.addRenderObject(i))},l.create=function(t){var e=l._cache._length?l._cache[--l._cache._length]:new l;return 5==(e.step=t)&&++l._mask,e.level=l._mask,e},l._cache=((l._cache=[])._length=0,l._cache),l._mask=0,l}(),SubmitTarget=function(){function h(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}__class(h,"laya.webgl.submit.SubmitTarget",!0);var t=h.prototype;return Laya.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){this._vb.bind_upload(this._ib);var t=this.scope.getValue(this.proName);return t&&(this.shaderValue.texture=t.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[t.width,t.height]),this.shaderValue.upload(),this.blend(),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,WebGL.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},t.blend=function(){if(BlendMode.activeBlendFunction!=BlendMode.fns[this.blendType]){var t=WebGL.mainContext;t.enable(3042),BlendMode.fns[this.blendType](t),BlendMode.activeBlendFunction=BlendMode.fns[this.blendType]}},t.getRenderType=function(){return 0},t.releaseRender=function(){var t=h._cache;t[t._length++]=this},h.create=function(t,e,i,r,a,s){var n=h._cache._length?h._cache[--h._cache._length]:new h;return n._ib=e,n._vb=i,n.proName=s,n._startIdx=r*CONST3D2D.BYTES_PIDX,n._numEle=0,n.blendType=t._nBlendType,n.shaderValue=a,n.shaderValue.setValue(t._shader2D),n},h._cache=((h._cache=[])._length=0,h._cache),h}(),Submit=function(){function l(t){void 0===t&&(t=1e4),this._renderType=t}__class(l,"laya.webgl.submit.Submit",!0);var t=l.prototype;return Laya.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.releaseRender=function(){var t=l._cache;(t[t._length++]=this).shaderValue.release(),this._vb=null},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0==this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=WebGL.mainContext;return this.shaderValue.upload(),BlendMode.activeBlendFunction!=this._blendFn&&(i.enable(3042),this._blendFn(i),BlendMode.activeBlendFunction=this._blendFn),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,i.drawElements(4,this._numEle,5123,this._startIdx),1},l.__init__=function(){var t=l.RENDERBASE=new l(-1);t.shaderValue=new Value2D(0,0),t.shaderValue.ALPHA=-1234},l.createSubmit=function(t,e,i,r,a){var s=l._cache._length?l._cache[--l._cache._length]:new l;null==i&&((i=s._selfVb||(s._selfVb=VertexBuffer2D.create(-1))).clear(),r=0),s._ib=e,s._vb=i,s._startIdx=r*CONST3D2D.BYTES_PIDX,s._numEle=0;var n=t._nBlendType;s._blendFn=t._targets?BlendMode.targetFns[n]:BlendMode.fns[n],s.shaderValue=a,s.shaderValue.setValue(t._shader2D);var h=t._shader2D.filters;return h&&s.shaderValue.setFilters(h),s},l.createShape=function(t,e,i,r,a,s){var n=l._cache._length?l._cache[--l._cache._length]:new l;n._ib=e,n._vb=i,n._numEle=r,n._startIdx=a,n.shaderValue=s,n.shaderValue.setValue(t._shader2D);var h=t._nBlendType;return n._blendFn=t._targets?BlendMode.targetFns[h]:BlendMode.fns[h],n},l.TYPE_2D=1e4,l.TYPE_CANVAS=10003,l.TYPE_CMDSETRT=10004,l.TYPE_CUSTOM=10005,l.TYPE_BLURRT=10006,l.TYPE_CMDDESTORYPRERT=10007,l.TYPE_DISABLESTENCIL=10008,l.TYPE_OTHERIBVB=10009,l.TYPE_PRIMITIVE=10010,l.TYPE_RT=10011,l.TYPE_BLUR_RT=10012,l.TYPE_TARGET=10013,l.TYPE_CHANGE_VALUE=10014,l.TYPE_SHAPE=10015,l.TYPE_TEXTURE=10016,l.TYPE_FILLTEXTURE=10017,l.RENDERBASE=null,l._cache=((l._cache=[])._length=0,l._cache),l}(),SubmitCMDScope=function(){function e(){this.variables={}}__class(e,"laya.webgl.submit.SubmitCMDScope",!0);var t=e.prototype;return t.getValue=function(t){return this.variables[t]},t.addValue=function(t,e){return this.variables[t]=e},t.setValue=function(t,e){return this.variables.hasOwnProperty(t)?this.variables[t]=e:null},t.clear=function(){for(var t in this.variables)delete this.variables[t]},t.recycle=function(){this.clear(),e.POOL.push(this)},e.create=function(){var t=e.POOL.pop();return t||(t=new e),t},e.POOL=[],e}(),BasePoly=function(){function t(t,e,i,r,a,s,n,h,l){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===l&&(l=0),this.x=t,this.y=e,this.width=i,this.height=r,this.edges=a,this.color=s,this.borderWidth=n,this.borderColor=h}__class(t,"laya.webgl.shapes.BasePoly",!0);var e=t.prototype;return Laya.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.rebuild=function(t){},e.setMatrix=function(t){},e.needUpdate=function(t){return!0},e.sector=function(t,e,i){var r=this.x,a=this.y,s=this.edges,n=(this.r1-this.r0)/s,h=this.width,l=this.height,o=this.color,u=(o>>16&255)/255,_=(o>>8&255)/255,c=(255&o)/255;t.push(r,a,u,_,c);for(var d=0;d<s+1;d++)t.push(r+Math.sin(n*d+this.r0)*h,a+Math.cos(n*d+this.r0)*l),t.push(u,_,c);for(d=0;d<s;d++)e.push(i,i+d+1,i+d+2)},e.createLine2=function(t,e,i,r,a,s){var n,h,l,o,u,_,c,d,f,m,g,p,x,b,v,T,y,S,A,E,R=t.concat(),M=a,L=this.borderColor,w=(L>>16&255)/255,C=(L>>8&255)/255,I=(255&L)/255,D=R.length/2,B=r,P=i/2;l=R[0],o=R[1],m=l-(u=R[2]),f=(f=-(o-(_=R[3])))/(E=Math.sqrt(f*f+m*m))*P,m=m/E*P,M.push(l-f+this.x,o-m+this.y,w,C,I,l+f+this.x,o+m+this.y,w,C,I);for(var F=1;F<D-1;F++)l=R[2*(F-1)],o=R[2*(F-1)+1],u=R[2*F],_=R[2*F+1],c=R[2*(F+1)],d=R[2*(F+1)+1],m=l-u,p=u-c,v=(-(f=(f=-(o-_))/(E=Math.sqrt(f*f+m*m))*P)+l)*(-(m=m/E*P)+_)-(-f+u)*(-m+o),S=(-(g=(g=-(_-d))/(E=Math.sqrt(g*g+p*p))*P)+c)*(-(p=p/E*P)+_)-(-g+u)*(-p+d),A=(x=-m+o-(-m+_))*(y=-g+u-(-g+c))-(T=-p+d-(-p+_))*(b=-f+u-(-f+l)),Math.abs(A)<.1?(A+=10.1,M.push(u-f+this.x,_-m+this.y,w,C,I,u+f+this.x,_+m+this.y,w,C,I)):(((n=(b*S-y*v)/A)-u)*(n-u)+((h=(T*v-x*S)/A)-_)+(h-_),M.push(n+this.x,h+this.y,w,C,I,u-(n-u)+this.x,_-(h-_)+this.y,w,C,I));l=R[R.length-4],o=R[R.length-3],m=l-(u=R[R.length-2]),f=(f=-(o-(_=R[R.length-1])))/(E=Math.sqrt(f*f+m*m))*P,m=m/E*P,M.push(u-f+this.x,_-m+this.y,w,C,I,u+f+this.x,_+m+this.y,w,C,I);var N=s;for(F=1;F<N;F++)e.push(B+2*(F-1),B+2*(F-1)+1,B+2*F+1,B+2*F+1,B+2*F,B+2*(F-1));return M},e.createLine=function(t,e,i,r){var a=t.concat(),s=t,n=this.borderColor,h=(n>>16&255)/255,l=(n>>8&255)/255,o=(255&n)/255;a.splice(0,5);var u,_,c,d,f,m,g,p,x,b,v,T,y,S,A,E,R,M,L,w,C=a.length/5,I=r,D=i/2;c=a[0],d=a[1],b=c-(f=a[5]),x=(x=-(d-(m=a[6])))/(w=Math.sqrt(x*x+b*b))*D,b=b/w*D,s.push(c-x,d-b,h,l,o,c+x,d+b,h,l,o);for(var B=1;B<C-1;B++)c=a[5*(B-1)],d=a[5*(B-1)+1],f=a[5*B],m=a[5*B+1],g=a[5*(B+1)],p=a[5*(B+1)+1],b=c-f,T=f-g,A=(-(x=(x=-(d-m))/(w=Math.sqrt(x*x+b*b))*D)+c)*(-(b=b/w*D)+m)-(-x+f)*(-b+d),M=(-(v=(v=-(m-p))/(w=Math.sqrt(v*v+T*T))*D)+g)*(-(T=T/w*D)+m)-(-v+f)*(-T+p),L=(y=-b+d-(-b+m))*(R=-v+f-(-v+g))-(E=-T+p-(-T+m))*(S=-x+f-(-x+c)),Math.abs(L)<.1?(L+=10.1,s.push(f-x,m-b,h,l,o,f+x,m+b,h,l,o)):(((u=(S*M-R*A)/L)-f)*(u-f)+((_=(E*A-y*M)/L)-m)+(_-m),s.push(u,_,h,l,o,f-(u-f),m-(_-m),h,l,o));c=a[a.length-10],d=a[a.length-9],b=c-(f=a[a.length-5]),x=(x=-(d-(m=a[a.length-4])))/(w=Math.sqrt(x*x+b*b))*D,b=b/w*D,s.push(f-x,m-b,h,l,o,f+x,m+b,h,l,o);var P=this.edges+1;for(B=1;B<P;B++)e.push(I+2*(B-1),I+2*(B-1)+1,I+2*B+1,I+2*B+1,I+2*B,I+2*(B-1));return s},e.createLoopLine=function(t,e,i,r,a,s){var n=t.concat(),h=a||t,l=this.borderColor,o=(l>>16&255)/255,u=(l>>8&255)/255,_=(255&l)/255;n.splice(0,5);var c=[n[0],n[1]],d=[n[n.length-5],n[n.length-4]],f=d[0]+.5*(c[0]-d[0]),m=d[1]+.5*(c[1]-d[1]);n.unshift(f,m,0,0,0),n.push(f,m,0,0,0);var g,p,x,b,v,T,y,S,A,E,R,M,L,w,C,I,D,B,P,F,N=n.length/5,V=r,G=i/2;x=n[0],b=n[1],E=x-(v=n[5]),A=(A=-(b-(T=n[6])))/(F=Math.sqrt(A*A+E*E))*G,E=E/F*G,h.push(x-A,b-E,o,u,_,x+A,b+E,o,u,_);for(var O=1;O<N-1;O++)x=n[5*(O-1)],b=n[5*(O-1)+1],v=n[5*O],T=n[5*O+1],y=n[5*(O+1)],S=n[5*(O+1)+1],E=x-v,M=v-y,C=(-(A=(A=-(b-T))/(F=Math.sqrt(A*A+E*E))*G)+x)*(-(E=E/F*G)+T)-(-A+v)*(-E+b),B=(-(R=(R=-(T-S))/(F=Math.sqrt(R*R+M*M))*G)+y)*(-(M=M/F*G)+T)-(-R+v)*(-M+S),P=(L=-E+b-(-E+T))*(D=-R+v-(-R+y))-(I=-M+S-(-M+T))*(w=-A+v-(-A+x)),Math.abs(P)<.1?(P+=10.1,h.push(v-A,T-E,o,u,_,v+A,T+E,o,u,_)):(((g=(w*B-D*C)/P)-v)*(g-v)+((p=(I*C-L*B)/P)-T)+(p-T),h.push(g,p,o,u,_,v-(g-v),T-(p-T),o,u,_));s&&(e=s);var W=this.edges+1;for(O=1;O<W;O++)e.push(V+2*(O-1),V+2*(O-1)+1,V+2*O+1,V+2*O+1,V+2*O,V+2*(O-1));return e.push(V+2*(O-1),V+2*(O-1)+1,V+1,V+1,V,V+2*(O-1)),h},t}(),Earcut=function(){function m(){}return __class(m,"laya.webgl.shapes.Earcut",!0),m.earcut=function(t,e,i){i=i||2;var r,a,s,n,h,l,o,u=e&&e.length,_=u?e[0]*i:t.length,c=m.linkedList(t,0,_,i,!0),d=[];if(!c)return d;if(u&&(c=m.eliminateHoles(t,e,c,i)),t.length>80*i){r=s=t[0],a=n=t[1];for(var f=i;f<_;f+=i)(h=t[f])<r&&(r=h),(l=t[f+1])<a&&(a=l),s<h&&(s=h),n<l&&(n=l);o=0!=(o=Math.max(s-r,n-a))?1/o:0}return m.earcutLinked(c,d,i,r,a,o),d},m.linkedList=function(t,e,i,r,a){var s,n;if(a==0<m.signedArea(t,e,i,r))for(s=e;s<i;s+=r)n=m.insertNode(s,t[s],t[s+1],n);else for(s=i-r;e<=s;s-=r)n=m.insertNode(s,t[s],t[s+1],n);return n&&m.equals(n,n.next)&&(m.removeNode(n),n=n.next),n},m.filterPoints=function(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!m.equals(r,r.next)&&0!=m.area(r.prev,r,r.next))r=r.next;else{if(m.removeNode(r),(r=e=r.prev)==r.next)break;i=!0}}while(i||r!=e);return e},m.earcutLinked=function(t,e,i,r,a,s,n){if(t){!n&&s&&m.indexCurve(t,r,a,s);for(var h,l,o=t;t.prev!=t.next;)if(h=t.prev,l=t.next,s?m.isEarHashed(t,r,a,s):m.isEar(t))e.push(h.i/i),e.push(t.i/i),e.push(l.i/i),m.removeNode(t),t=l.next,o=l.next;else if((t=l)==o){n?1==n?(t=m.cureLocalIntersections(t,e,i),m.earcutLinked(t,e,i,r,a,s,2)):2==n&&m.splitEarcut(t,e,i,r,a,s):m.earcutLinked(m.filterPoints(t,null),e,i,r,a,s,1);break}}},m.isEar=function(t){var e=t.prev,i=t,r=t.next;if(0<=m.area(e,i,r))return!1;for(var a=t.next.next;a!=t.prev;){if(m.pointInTriangle(e.x,e.y,i.x,i.y,r.x,r.y,a.x,a.y)&&0<=m.area(a.prev,a,a.next))return!1;a=a.next}return!0},m.isEarHashed=function(t,e,i,r){var a=t.prev,s=t,n=t.next;if(0<=m.area(a,s,n))return!1;for(var h=a.x<s.x?a.x<n.x?a.x:n.x:s.x<n.x?s.x:n.x,l=a.y<s.y?a.y<n.y?a.y:n.y:s.y<n.y?s.y:n.y,o=a.x>s.x?a.x>n.x?a.x:n.x:s.x>n.x?s.x:n.x,u=a.y>s.y?a.y>n.y?a.y:n.y:s.y>n.y?s.y:n.y,_=m.zOrder(h,l,e,i,r),c=m.zOrder(o,u,e,i,r),d=t.nextZ;d&&d.z<=c;){if(d!=t.prev&&d!=t.next&&m.pointInTriangle(a.x,a.y,s.x,s.y,n.x,n.y,d.x,d.y)&&0<=m.area(d.prev,d,d.next))return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=_;){if(d!=t.prev&&d!=t.next&&m.pointInTriangle(a.x,a.y,s.x,s.y,n.x,n.y,d.x,d.y)&&0<=m.area(d.prev,d,d.next))return!1;d=d.prevZ}return!0},m.cureLocalIntersections=function(t,e,i){var r=t;do{var a=r.prev,s=r.next.next;!m.equals(a,s)&&m.intersects(a,r,r.next,s)&&m.locallyInside(a,s)&&m.locallyInside(s,a)&&(e.push(a.i/i),e.push(r.i/i),e.push(s.i/i),m.removeNode(r),m.removeNode(r.next),r=t=s),r=r.next}while(r!=t);return r},m.splitEarcut=function(t,e,i,r,a,s){var n=t;do{for(var h=n.next.next;h!=n.prev;){if(n.i!=h.i&&m.isValidDiagonal(n,h)){var l=m.splitPolygon(n,h);return n=m.filterPoints(n,n.next),l=m.filterPoints(l,l.next),m.earcutLinked(n,e,i,r,a,s),void m.earcutLinked(l,e,i,r,a,s)}h=h.next}n=n.next}while(n!=t)},m.eliminateHoles=function(t,e,i,r){var a,s,n,h,l,o=[];for(a=0,s=e.length;a<s;a++)n=e[a]*r,h=a<s-1?e[a+1]*r:t.length,(l=m.linkedList(t,n,h,r,!1))==l.next&&(l.steiner=!0),o.push(m.getLeftmost(l));for(o.sort(m.compareX),a=0;a<o.length;a++)m.eliminateHole(o[a],i),i=m.filterPoints(i,i.next);return i},m.compareX=function(t,e){return t.x-e.x},m.eliminateHole=function(t,e){if(e=m.findHoleBridge(t,e)){var i=m.splitPolygon(e,t);m.filterPoints(i,i.next)}},m.findHoleBridge=function(t,e){var i,r=e,a=t.x,s=t.y,n=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!=r.y){var h=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(h<=a&&n<h){if((n=h)==a){if(s==r.y)return r;if(s==r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!=e);if(!i)return null;if(a==n)return i.prev;var l,o=i,u=i.x,_=i.y,c=1/0;for(r=i.next;r!=o;)a>=r.x&&r.x>=u&&a!=r.x&&m.pointInTriangle(s<_?a:n,s,u,_,s<_?n:a,s,r.x,r.y)&&((l=Math.abs(s-r.y)/(a-r.x))<c||l==c&&r.x>i.x)&&m.locallyInside(r,t)&&(i=r,c=l),r=r.next;return i},m.indexCurve=function(t,e,i,r){for(var a=t;null==a.z&&(a.z=m.zOrder(a.x,a.y,e,i,r)),a.prevZ=a.prev,a.nextZ=a.next,(a=a.next)!=t;);a.prevZ.nextZ=null,a.prevZ=null,m.sortLinked(a)},m.sortLinked=function(t){var e,i,r,a,s,n,h,l,o=1;do{for(i=t,s=t=null,n=0;i;){for(n++,r=i,e=h=0;e<o&&(h++,r=r.nextZ);e++);for(l=o;0<h||0<l&&r;)0!=h&&(0==l||!r||i.z<=r.z)?(i=(a=i).nextZ,h--):(r=(a=r).nextZ,l--),s?s.nextZ=a:t=a,a.prevZ=s,s=a;i=r}s.nextZ=null,o*=2}while(1<n);return t},m.zOrder=function(t,e,i,r,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*a)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*a)|e<<8))|e<<4))|e<<2))|e<<1))<<1},m.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!=t;);return i},m.pointInTriangle=function(t,e,i,r,a,s,n,h){return 0<=(a-n)*(e-h)-(t-n)*(s-h)&&0<=(t-n)*(r-h)-(i-n)*(e-h)&&0<=(i-n)*(s-h)-(a-n)*(r-h)},m.isValidDiagonal=function(t,e){return t.next.i!=e.i&&t.prev.i!=e.i&&!m.intersectsPolygon(t,e)&&m.locallyInside(t,e)&&m.locallyInside(e,t)&&m.middleInside(t,e)},m.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},m.equals=function(t,e){return t.x==e.x&&t.y==e.y},m.intersects=function(t,e,i,r){return!!(m.equals(t,e)&&m.equals(i,r)||m.equals(t,r)&&m.equals(i,e))||0<m.area(t,e,i)!=0<m.area(t,e,r)&&0<m.area(i,r,t)!=0<m.area(i,r,e)},m.intersectsPolygon=function(t,e){var i=t;do{if(i.i!=t.i&&i.next.i!=t.i&&i.i!=e.i&&i.next.i!=e.i&&m.intersects(i,i.next,t,e))return!0;i=i.next}while(i!=t);return!1},m.locallyInside=function(t,e){return m.area(t.prev,t,t.next)<0?0<=m.area(t,e,t.next)&&0<=m.area(t,t.prev,e):m.area(t,e,t.prev)<0||m.area(t,t.next,e)<0},m.middleInside=function(t,e){for(var i=t,r=!1,a=(t.x+e.x)/2,s=(t.y+e.y)/2;i.y>s!=i.next.y>s&&i.next.y!=i.y&&a<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),(i=i.next)!=t;);return r},m.splitPolygon=function(t,e){var i=new EarcutNode(t.i,t.x,t.y),r=new EarcutNode(e.i,e.x,e.y),a=t.next,s=e.prev;return(t.next=e).prev=t,(i.next=a).prev=i,(r.next=i).prev=r,(s.next=r).prev=s,r},m.insertNode=function(t,e,i,r){var a=new EarcutNode(t,e,i);return r?(a.next=r.next,(a.prev=r).next.prev=a,r.next=a):(a.prev=a).next=a,a},m.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},m.signedArea=function(t,e,i,r){for(var a=0,s=e,n=i-r;s<i;s+=r)a+=(t[n]-t[s])*(t[s+1]+t[n+1]),n=s;return a},m}(),EarcutNode=function(){function t(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return __class(t,"laya.webgl.shapes.EarcutNode",!0),t}(),Vertex=function(){function t(t){if(t instanceof Float32Array)this.points=t;else if(t instanceof Array){t.length;this.points=new Float32Array(t)}}__class(t,"laya.webgl.shapes.Vertex",!0);var e=t.prototype;return Laya.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.needUpdate=function(t){return!1},e.rebuild=function(t){},e.setMatrix=function(t){},t}(),GeometryData=function(){function t(t,e,i,r,a,s,n){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this.fillColor=r,this.fillAlpha=a,this.shape=n,this.fill=s}__class(t,"laya.webgl.shapes.GeometryData",!0);var e=t.prototype;return e.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},e.getIndexData=function(){return null},e.getVertexData=function(){return null},e.destroy=function(){this.shape=null},t}(),ShaderCompile=function(){var x,i;function b(t,e,i,r,a){var s=this;function n(t){var e=[],i=new x(e);return s._compileToTree(i,t.split("\n"),0,e,a),i}var h=Browser.now();this._VS=n(e),this._PS=n(i),this._nameMap=r,2<Browser.now()-h&&console.log("ShaderCompile use time:"+(Browser.now()-h)+"  size:"+e.length+"/"+i.length)}__class(b,"laya.webgl.utils.ShaderCompile",!0);var t=b.prototype;return t._compileToTree=function(t,e,i,r,a){var s,n,h,l,o,u,_,c=0,d=0,f=0,m=0;for(d=i;d<e.length;d++)if(!((h=e[d]).length<1)&&0!=(c=h.indexOf("//"))){if(0<=c&&(h=h.substr(0,c)),s=_||new x(r),_=null,s.text=h,s.noCompile=!0,0<=(c=h.indexOf("#"))){for(l="#",m=c+1,f=h.length;m<f;m++){var g=h.charAt(m);if(" "==g||"\t"==g||"?"==g)break;l+=g}switch(s.name=l){case"#ifdef":case"#ifndef":if(s.src=h,s.noCompile=null!=h.match(/[!&|()=<>]/),s.noCompile?console.log("function():Boolean{return "+h.substr(c+s.name.length)+"}"):(u=h.replace(/^\s*/,"").split(/\s+/),s.setCondition(u[1],"#ifdef"==l?1:2),s.text="//"+s.text),s.setParent(t),t=s,a)for(u=h.substr(m).split(b._splitToWordExps3),m=0;m<u.length;m++)(h=u[m]).length&&(a[h]=!0);continue;case"#if":if(s.src=h,s.noCompile=!0,s.setParent(t),t=s,a)for(u=h.substr(m).split(b._splitToWordExps3),m=0;m<u.length;m++)(h=u[m]).length&&"defined"!=h&&(a[h]=!0);continue;case"#else":s.src=h,n=(t=t.parent).childs[t.childs.length-1],s.noCompile=n.noCompile,s.noCompile||(s.condition=n.condition,s.conditionType=1==n.conditionType?2:1,s.text="//"+s.text+" "+n.text+" "+s.conditionType),s.setParent(t),t=s;continue;case"#endif":n=(t=t.parent).childs[t.childs.length-1],s.noCompile=n.noCompile,s.noCompile||(s.text="//"+s.text),s.setParent(t);continue;case"#include":u=b.splitToWords(h,null);var p=b.includes[u[1]];if(!p)throw"ShaderCompile error no this include file:"+u[1];if((c=u[0].indexOf("?"))<0){s.setParent(t),h=p.getWith("with"==u[2]?u[3]:null),this._compileToTree(s,h.split("\n"),0,r,a),s.text="";continue}s.setCondition(u[0].substr(c+1),1),s.text=p.getWith("with"==u[2]?u[3]:null);break;case"#import":o=(u=b.splitToWords(h,null))[1],r.push({node:s,file:b.includes[o],ofs:s.text.length});continue}}else{if((n=t.childs[t.childs.length-1])&&!n.name){0<r.length&&b.splitToWords(h,n),_=s,n.text+="\n"+h;continue}0<r.length&&b.splitToWords(h,s)}s.setParent(t)}},t.createShader=function(t,e,i){var r={},a="";if(t)for(var s in t)a+="#define "+s+"\n",r[s]=!0;var n=this._VS.toscript(r,[]),h=this._PS.toscript(r,[]);return(i||Shader.create)(a+n.join("\n"),a+h.join("\n"),e,this._nameMap)},b._parseOne=function(t,e,i,r,a,s){var n={type:b.shaderParamsMap[i[r+1]],name:i[r+2],size:isNaN(parseInt(i[r+3]))?1:parseInt(i[r+3])};return s&&("attribute"==a?t.push(n):e.push(n)),":"==i[r+3]&&(n.type=i[r+4],r+=2),r+=2},b.addInclude=function(t,e){if(!e||0==e.length)throw new Error("add shader include file err:"+t);if(b.includes[t])throw new Error("add shader include file err, has add:"+t);b.includes[t]=new i(e)},b.preGetParams=function(t,e){var i=[t,e],r={},a=[],s=[],n={},h=[];r.attributes=a,r.uniforms=s,r.defines=n;for(var l=0,o=0,u=0;u<2;u++){i[u]=i[u].replace(b._removeAnnotation,"");var _,c=i[u].match(b._reg);for(l=0,o=c.length;l<o;l++){var d=c[l];if("attribute"==d||"uniform"==d)l=b._parseOne(a,s,c,l,d,!0);else{if("#define"==d){h[d=c[++l]]=1;continue}if("#ifdef"==d){n[_=c[++l]]=n[_]||[];for(l++;l<o;l++)if("attribute"==(d=c[l])||"uniform"==d)l=b._parseOne(a,s,c,l,d,h[_]);else if("#else"==d)for(l++;l<o;l++)if("attribute"==(d=c[l])||"uniform"==d)l=b._parseOne(a,s,c,l,d,!h[_]);else if("#endif"==d)break}}}}return r},b.splitToWords=function(t,e){for(var i,r,a=[],s=-1,n=0,h=t.length;n<h;n++)if(i=t.charAt(n),0<=" \t=+-*/&%!<>()'\",;".indexOf(i)){if(0<=s&&1<n-s&&(r=t.substr(s,n-s),a.push(r)),'"'==i||"'"==i){var l=t.indexOf(i,n+1);if(l<0)throw"Sharder err:"+t;a.push(t.substr(n+1,l-n-1)),n=l,s=-1;continue}"("==i&&e&&0<a.length&&(r=a[a.length-1]+";","vec4;main;".indexOf(r)<0&&(e.useFuns+=r)),s=-1}else s<0&&(s=n);return s<h&&1<h-s&&(r=t.substr(s,h-s),a.push(r)),a},b.IFDEF_NO=0,b.IFDEF_YES=1,b.IFDEF_ELSE=2,b.IFDEF_PARENT=3,b._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),b._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),b._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),b.includes={},__static(b,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),b.__init$=function(){x=function(){function i(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}__class(i,"",!0);var t=i.prototype;return t.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++i.__id)},t._toscript=function(r,a,s){if(this.childs.length<1&&!this.text)return a;a.length;if(this.condition){var t=!!this.condition.call(r);if(2==this.conditionType&&(t=!t),!t)return a}if(this.text&&a.push(this.text),0<this.childs.length&&this.childs.forEach(function(t,e,i){t._toscript(r,a,s)}),0<this.includefiles.length&&0<this.useFuns.length)for(var e,i=0,n=this.includefiles.length;i<n;i++)this.includefiles[i].curUseID!=s&&0<(e=this.includefiles[i].file.getFunsScript(this.useFuns)).length&&(this.includefiles[i].curUseID=s,a[0]=e+a[0]);return a},i.__id=1,i}(),i=function(){function t(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,i=0,r=0;!((e=t.indexOf("#begin",e))<0);){for(r=e+5;!((r=t.indexOf("#end",r))<0)&&"i"==t.charAt(r+4);)r+=5;if(r<0)throw"add include err,no #end:"+t;i=t.indexOf("\n",e);var a=b.splitToWords(t.substr(e,i-e),null);"code"==a[1]?this.codes[a[2]]=t.substr(i+1,r-i-1):"function"==a[1]&&(i=t.indexOf("function",e),i+="function".length,this.funs[a[3]]=t.substr(i+1,r-i-1),this.funnames+=a[3]+";"),e=r+1}}__class(t,"",!0);var e=t.prototype;return e.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},e.getFunsScript=function(t){var e="";for(var i in this.funs)0<=t.indexOf(i+";")&&(e+=this.funs[i]);return e},t}()},b}(),CONST3D2D=function(){function t(){}return __class(t,"laya.webgl.utils.CONST3D2D",!0),t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,__static(t,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),t}(),RenderState2D=function(){function a(){}return __class(a,"laya.webgl.utils.RenderState2D",!0),a.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},a.mat2MatArray=function(t,e){var i=t,r=e;return r[0]=i.a,r[1]=i.b,r[2]=a.EMPTYMAT4_ARRAY[2],r[3]=a.EMPTYMAT4_ARRAY[3],r[4]=i.c,r[5]=i.d,r[6]=a.EMPTYMAT4_ARRAY[6],r[7]=a.EMPTYMAT4_ARRAY[7],r[8]=a.EMPTYMAT4_ARRAY[8],r[9]=a.EMPTYMAT4_ARRAY[9],r[10]=a.EMPTYMAT4_ARRAY[10],r[11]=a.EMPTYMAT4_ARRAY[11],r[12]=i.tx,r[13]=i.ty,r[14]=a.EMPTYMAT4_ARRAY[14],r[15]=a.EMPTYMAT4_ARRAY[15],e},a.restoreTempArray=function(){a.TEMPMAT4_ARRAY[0]=1,a.TEMPMAT4_ARRAY[1]=0,a.TEMPMAT4_ARRAY[4]=0,a.TEMPMAT4_ARRAY[5]=1,a.TEMPMAT4_ARRAY[12]=0,a.TEMPMAT4_ARRAY[13]=0},a.clear=function(){a.worldScissorTest=!1,a.worldShaderDefines=null,a.worldFilters=null,a.worldAlpha=1,a.worldClipRect.x=a.worldClipRect.y=0,a.worldClipRect.width=a.width,a.worldClipRect.height=a.height,a.curRenderTarget=null},a._MAXSIZE=99999999,a.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a.worldMatrix4=a.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a.worldAlpha=1,a.worldScissorTest=!1,a.worldFilters=null,a.worldShaderDefines=null,a.curRenderTarget=null,a.width=0,a.height=0,__static(a,["worldMatrix",function(){return this.worldMatrix=new Matrix},"worldClipRect",function(){return this.worldClipRect=new Rectangle(0,0,99999999,99999999)}]),a}(),Mesh2D=function(){function e(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new VertexBuffer2D(t,35048),e&&this._vb._resizeBuffer(e,!1),this._ib=new IndexBuffer2D,i&&this._ib._resizeBuffer(i,!1)}__class(e,"laya.webgl.utils.Mesh2D",!0);var t=e.prototype;return t.cloneWithNewVB=function(){var t=new e(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},t.cloneWithNewVBIB=function(){var t=new e(this._stride,0,0);return t._attribInfo=this._attribInfo,t},t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},t.getVBR=function(){return this._vb},t.getIBR=function(){return this._ib},t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},t.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,r=0,a=0;a<t;a++)e[i++]=r,e[i++]=r+2,e[i++]=r+1,e[i++]=r,e[i++]=r+3,e[i++]=r+2,r+=4;this._ib.setNeedUpload()},t.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},t.releaseMesh=LAYAFNVOID,t.destroy=function(){},t.clearVB=function(){this._vb.clear()},e._gvaoid=0,e}(),GlUtils=function(){function f(){}return __class(f,"laya.webgl.utils.GlUtils",!0),f.make2DProjection=function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},f.fillIBQuadrangle=function(t,e){if(65535/4<e)throw Error("IBQuadrangle count:"+e+" must<:"+Math.floor(65535/4));e=Math.floor(e),t._resizeBuffer(6*(e+1)*2,!1),t.byteLength=t.bufferLength;for(var i=t.getUint16Array(),r=0,a=0;a<e;a++)i[r++]=4*a,i[r++]=4*a+2,i[r++]=4*a+1,i[r++]=4*a,i[r++]=4*a+3,i[r++]=4*a+2;return t.setNeedUpload(),!0},f.expandIBQuadrangle=function(t,e){t.bufferLength>=6*e*2||f.fillIBQuadrangle(t,e)},f.mathCeilPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},f.fillQuadrangleImgVb=function(t,e,i,r,a,s,n,h){var l=16+(t._byteLength>>2);t.byteLength=l<<2;var o=t.getFloat32Array();o[(l-=16)+2]=a[0],o[l+3]=a[1],o[l+6]=a[2],o[l+7]=a[3],o[l+10]=a[4],o[l+11]=a[5],o[l+14]=a[6],o[l+15]=a[7];var u=s.a,_=s.b,c=s.c,d=s.d;if(1!=u||0!=_||0!=c||1!=d){s.bTransform=!0;var f=s.tx+n,m=s.ty+h;o[l]=(r[0]+e)*u+(r[1]+i)*c+f,o[l+1]=(r[0]+e)*_+(r[1]+i)*d+m,o[l+4]=(r[2]+e)*u+(r[3]+i)*c+f,o[l+5]=(r[2]+e)*_+(r[3]+i)*d+m,o[l+8]=(r[4]+e)*u+(r[5]+i)*c+f,o[l+9]=(r[4]+e)*_+(r[5]+i)*d+m,o[l+12]=(r[6]+e)*u+(r[7]+i)*c+f,o[l+13]=(r[6]+e)*_+(r[7]+i)*d+m}else s.bTransform=!1,e+=s.tx+n,i+=s.ty+h,o[l]=e+r[0],o[l+1]=i+r[1],o[l+4]=e+r[2],o[l+5]=i+r[3],o[l+8]=e+r[4],o[l+9]=i+r[5],o[l+12]=e+r[6],o[l+13]=i+r[7];return t._upload=!0},f.fillTranglesVB=function(t,e,i,r,a,s,n){var h=(t._byteLength>>2)+r.length;t.byteLength=h<<2;var l=t.getFloat32Array();h-=r.length;for(var o=r.length,u=a.a,_=a.b,c=a.c,d=a.d,f=0;f<o;f+=4)if(l[h+f+2]=r[f+2],l[h+f+3]=r[f+3],1!=u||0!=_||0!=c||1!=d){a.bTransform=!0;var m=a.tx+s,g=a.ty+n;l[h+f]=(r[f]+e)*u+(r[f+1]+i)*c+m,l[h+f+1]=(r[f]+e)*_+(r[f+1]+i)*d+g}else a.bTransform=!1,e+=a.tx+s,i+=a.ty+n,l[h+f]=e+r[f],l[h+f+1]=i+r[f+1];return t._upload=!0},f.copyPreImgVb=function(t,e,i){var r=t._byteLength>>2;t.byteLength=r+16<<2;for(var a=t.getFloat32Array(),s=0,n=r-16;s<4;s++)a[r]=a[n]+e,++n,a[++r]=a[n]+i,++n,a[++r]=a[n],++n,a[++r]=a[n],++r,++n;t._upload=!0},f.fillRectImgVb=function(t,e,i,r,a,s,n,h,l,o,u,_,c){void 0===c&&(c=!1);var d,f,m,g,p,x,b,v,T,y,S,A,E,R,M,L,w=1,C=h.a,I=h.b,D=h.c,B=h.d,P=e&&e.width<99999999;if(1!=C||0!=I||0!=D||1!=B?(h.bTransform=!0,0==I&&0==D&&(w=23,T=a+i,y=s+r,d=C*i+(S=h.tx+l),m=C*T+S,f=B*r+(A=h.ty+o),g=B*y+A)):(w=23,h.bTransform=!1,m=(d=i+h.tx+l)+a,g=(f=r+h.ty+o)+s),P&&(p=e.x,x=e.y,b=e.width+p,v=e.height+x),1!=w){if(Math.min(d,m)>=b)return!1;if(Math.min(f,g)>=v)return!1;if(Math.max(m,d)<=p)return!1;if(Math.max(g,f)<=x)return!1}var F=t._byteLength>>2;t.byteLength=F+16<<2;var N=t.getFloat32Array();switch(N[F+2]=n[0],N[F+3]=n[1],N[F+6]=n[2],N[F+7]=n[3],N[F+10]=n[4],N[F+11]=n[5],N[F+14]=n[6],N[F+15]=n[7],w){case 1:S=h.tx+l,A=h.ty+o;var V=C*i,G=D*r,O=B*r,W=I*i,U=C*(T=a+i),k=D*(y=s+r),H=B*y,z=I*T;N[F+13]=c?(E=V+G+S,M=Math.round(E)-E,R=O+W+A,L=Math.round(R)-R,N[F]=E+M,N[F+1]=R+L,N[F+4]=U+G+S+M,N[F+5]=O+z+A+L,N[F+8]=U+k+S+M,N[F+9]=H+z+A+L,N[F+12]=V+k+S+M,H+W+A+L):(N[F]=V+G+S,N[F+1]=O+W+A,N[F+4]=U+G+S,N[F+5]=O+z+A,N[F+8]=U+k+S,N[F+9]=H+z+A,N[F+12]=V+k+S,H+W+A);break;case 23:N[F+13]=c?(E=d+u,M=Math.round(E)-E,R=f,L=Math.round(R)-R,N[F]=E+M,N[F+1]=R+L,N[F+4]=m+u+M,N[F+5]=f+L,N[F+8]=m+M,N[F+9]=g+L,N[F+12]=d+M,g+L):(N[F]=d+u,N[F+1]=f,N[F+4]=m+u,N[F+5]=f,N[F+8]=m,N[F+9]=g,N[F+12]=d,g)}return t._upload=!0},f.fillLineVb=function(t,e,i,r,a,s,n,h){var l=.5*n,o=f._fillLineArray,u=-(r-s),_=i-a,c=Math.sqrt(u*u+_*_);u/=c,_/=c,u*=l,_*=l,o[0]=i-u,o[1]=r-_,o[4]=i+u,o[5]=r+_,o[8]=a+u,o[9]=s+_,o[12]=a-u,o[13]=s-_,h&&h.transformPointArray(o,o);var d=16+(t._byteLength>>2);return t.byteLength=d<<2,t.insertData(o,d-16),!0},f._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f}(),MatirxArray=function(){function l(){}return __class(l,"laya.webgl.utils.MatirxArray",!0),l.ArrayMul=function(t,e,i){if(t)if(e)for(var r=NaN,a=NaN,s=NaN,n=NaN,h=0;h<4;h++)r=t[h],a=t[h+4],s=t[h+8],n=t[h+12],i[h]=r*e[0]+a*e[1]+s*e[2]+n*e[3],i[h+4]=r*e[4]+a*e[5]+s*e[6]+n*e[7],i[h+8]=r*e[8]+a*e[9]+s*e[10]+n*e[11],i[h+12]=r*e[12]+a*e[13]+s*e[14]+n*e[15];else l.copyArray(t,i);else l.copyArray(e,i)},l.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]},l}(),DrawStyle=function(){function i(t){this._color=Color.create("black"),this.setValue(t)}__class(i,"laya.webgl.canvas.DrawStyle",!0);var t=i.prototype;return t.setValue=function(t){if(t){if("string"==typeof t)return void(this._color=Color.create(t));if(t instanceof laya.utils.Color)return void(this._color=t)}},t.reset=function(){this._color=Color.create("black")},t.equal=function(t){return"string"==typeof t?this._color.strColor==t:t instanceof laya.utils.Color&&this._color.numColor==t.numColor},t.toColorStr=function(){return this._color.strColor},i.create=function(t){var e;if(t&&("string"==typeof t?e=Color.create(t):t instanceof laya.utils.Color&&(e=t),e))return e._drawStyle||(e._drawStyle=new i(t));return laya.webgl.canvas.DrawStyle.DEFAULT},__static(i,["DEFAULT",function(){return this.DEFAULT=new i("#000000")}]),i}(),Path=function(){function t(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];WebGL.mainContext;this.ib=IndexBuffer2D.create(35048),this.vb=VertexBuffer2D.create(5)}__class(t,"laya.webgl.canvas.Path",!0);var e=t.prototype;return e.addPoint=function(t,e){this.tempArray.push(t,e)},e.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},e.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},e.polygon=function(t,e,i,r,a,s){var n;return this.geomatrys.push(this._curGeomatry=n=new Polygon(t,e,i,r,a,s)),r||(n.fill=!1),null==s&&(n.borderWidth=0),n},e.setGeomtry=function(t){this.geomatrys.push(this._curGeomatry=t)},e.drawLine=function(t,e,i,r,a){var s;return this.closePath?this.geomatrys.push(this._curGeomatry=s=new LoopLine(t,e,i,r,a)):this.geomatrys.push(this._curGeomatry=s=new Line(t,e,i,r,a)),s.fill=!1,s},e.update=function(){var t=this.ib._byteLength,e=this.geomatrys.length;this.offset=t;for(var i=this.geoStart;i<e;i++)this.geomatrys[i].getData(this.ib,this.vb,this.vb._byteLength/20);this.geoStart=e,this.count=(this.ib._byteLength-t)/CONST3D2D.BYTES_PIDX},e.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},e.recover=function(){this._curGeomatry=null,this.vb.destory(),this.vb=null,this.ib.destory(),this.ib=null},t}(),BlendMode=function(){function e(){}return __class(e,"laya.webgl.canvas.BlendMode",!0),e._init_=function(t){e.fns=[e.BlendNormal,e.BlendAdd,e.BlendMultiply,e.BlendScreen,e.BlendOverlay,e.BlendLight,e.BlendMask,e.BlendDestinationOut],e.targetFns=[e.BlendNormalTarget,e.BlendAddTarget,e.BlendMultiplyTarget,e.BlendScreenTarget,e.BlendOverlayTarget,e.BlendLightTarget,e.BlendMask,e.BlendDestinationOut]},e.BlendNormal=function(t){t.blendFunc(1,771)},e.BlendAdd=function(t){t.blendFunc(1,772)},e.BlendMultiply=function(t){t.blendFunc(774,771)},e.BlendScreen=function(t){t.blendFunc(1,1)},e.BlendOverlay=function(t){t.blendFunc(1,769)},e.BlendLight=function(t){t.blendFunc(1,1)},e.BlendNormalTarget=function(t){t.blendFunc(1,771)},e.BlendAddTarget=function(t){t.blendFunc(1,772)},e.BlendMultiplyTarget=function(t){t.blendFunc(774,771)},e.BlendScreenTarget=function(t){t.blendFunc(1,1)},e.BlendOverlayTarget=function(t){t.blendFunc(1,769)},e.BlendLightTarget=function(t){t.blendFunc(1,1)},e.BlendMask=function(t){t.blendFunc(0,770)},e.BlendDestinationOut=function(t){t.blendFunc(0,0)},e.activeBlendFunction=null,e.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],e.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},e.NORMAL="normal",e.ADD="add",e.MULTIPLY="multiply",e.SCREEN="screen",e.LIGHT="light",e.OVERLAY="overlay",e.DESTINATIONOUT="destination-out",e.fns=[],e.targetFns=[],e}(),SaveClipRect=function(){function s(){this._clipRect=new Rectangle}__class(s,"laya.webgl.canvas.save.SaveClipRect",!0);var t=s.prototype;return Laya.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=LAYAFNFALSE,t.restore=function(t){t._clipRect=this._clipSaveRect,(s._cache[s._cache._length++]=this)._submitScissor.submitLength=t._submits._length-this._submitScissor.submitIndex,t._curSubmit=Submit.RENDERBASE,t._renderKey=0},s.save=function(t,e){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var i=s._cache,r=0<i._length?i[--i._length]:new s;r._clipSaveRect=t._clipRect,t._clipRect=r._clipRect.copyFrom(t._clipRect),r._submitScissor=e;var a=t._save;a[a._length++]=r}},__static(s,["_cache",function(){return this._cache=SaveBase._createArray()}]),s}(),SaveClipRectStencil=function(){function d(){this._contextX=0,this._contextY=0,this._clipRect=new Rectangle,this._rect=new Rectangle,this._matrix=new Matrix}__class(d,"laya.webgl.canvas.save.SaveClipRectStencil",!0);var t=d.prototype;return Laya.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=LAYAFNFALSE,t.restore=function(t){SubmitStencil.restore(t,this._rect,this._saveMatrix,this._contextX,this._contextY),t._clipRect=this._clipSaveRect,t._curMat=this._saveMatrix,t._x=this._contextX,t._y=this._contextY,d._cache[d._cache._length++]=this,t._curSubmit=Submit.RENDERBASE},d.save=function(t,e,i,r,a,s,n,h,l,o){if(262144!=(262144&t._saveMark._saveuse)){t._saveMark._saveuse|=262144;var u=d._cache,_=0<u._length?u[--u._length]:new d;_._clipSaveRect=t._clipRect,_._clipRect.setTo(n,h,l,o),t._clipRect=_._clipRect,_._rect.x=i,_._rect.y=r,_._rect.width=a,_._rect.height=s,_._contextX=t._x,_._contextY=t._y,_._saveMatrix=t._curMat,t._curMat.copyTo(_._matrix),t._curMat=_._matrix,_._submitStencil=e;var c=t._save;c[c._length++]=_}},__static(d,["_cache",function(){return this._cache=SaveBase._createArray()}]),d}(),SaveTransform=function(){function s(){this._matrix=new Matrix}__class(s,"laya.webgl.canvas.save.SaveTransform",!0);var t=s.prototype;return Laya.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=LAYAFNFALSE,t.restore=function(t){t._curMat=this._savematrix,s._no[s._no._length++]=this},s.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var i=s._no,r=0<i._length?i[--i._length]:new s;r._savematrix=t._curMat,t._curMat=t._curMat.copyTo(r._matrix);var a=t._save;a[a._length++]=r}},__static(s,["_no",function(){return this._no=SaveBase._createArray()}]),s}(),SaveBase=function(){function h(){}__class(h,"laya.webgl.canvas.save.SaveBase",!0);var t=h.prototype;return Laya.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=LAYAFNFALSE,t.restore=function(t){this._dataObj[this._valueName]=this._value,(h._cache[h._cache._length++]=this)._newSubmit&&(t._curSubmit=Submit.RENDERBASE,t._renderKey=0)},h._createArray=function(){var t=[];return t._length=0,t},h._init=function(){var t=h._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t},h.save=function(t,e,i,r){if((t._saveMark._saveuse&e)!=e){t._saveMark._saveuse|=e;var a=h._cache,s=0<a._length?a[--a._length]:new h;s._value=i[s._valueName=h._namemap[e]],s._dataObj=i,s._newSubmit=r;var n=t._save;n[n._length++]=s}},h._cache=laya.webgl.canvas.save.SaveBase._createArray(),h._namemap=h._init(),h}(),SaveMark=function(){function r(){this._saveuse=0}__class(r,"laya.webgl.canvas.save.SaveMark",!0);var t=r.prototype;return Laya.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,r._no[r._no._length++]=this},r.Create=function(t){var e=r._no,i=0<e._length?e[--e._length]:new r;return i._saveuse=0,i._preSaveMark=t._saveMark,t._saveMark=i},__static(r,["_no",function(){return this._no=SaveBase._createArray()}]),r}(),SaveTranslate=function(){function a(){}__class(a,"laya.webgl.canvas.save.SaveTranslate",!0);var t=a.prototype;return Laya.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=LAYAFNFALSE,t.restore=function(t){t._curMat;t._x=this._x,t._y=this._y,a._no[a._no._length++]=this},a.save=function(t){var e=a._no,i=0<e._length?e[--e._length]:new a;i._x=t._x,i._y=t._y;var r=t._save;r[r._length++]=i},__static(a,["_no",function(){return this._no=SaveBase._createArray()}]),a}(),WebGL=function(){function n(){}return __class(n,"laya.webgl.WebGL",!0),n._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},n._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},n._uint16ArraySlice=function(t){var e,i=arguments,r=0,a=0;if(0==i.length)for(r=this.length,e=new Uint16Array(r),a=0;a<r;a++)e[a]=this[a];else if(2==i.length){var s=i[0],n=i[1];if(s<n)for(r=n-s,e=new Uint16Array(r),a=s;a<n;a++)e[a-s]=this[a];else e=new Uint16Array(0)}return e},n.expandContext=function(){var t=Context.prototype,e=CanvasRenderingContext2D.prototype;e.fillTrangles=t.fillTrangles,Buffer2D.__int__(null),e.setIBVB=function(t,e,i,r,a,s,n,h,l,o){void 0===l&&(l=0),void 0===o&&(o=0),null==i&&(this._ib=this._ib||IndexBuffer2D.QuadrangleIB,i=this._ib,GlUtils.expandIBQuadrangle(i,r._byteLength/64+8)),this._setIBVB(t,e,i,r,a,s,n,h,l,o)},e.fillTrangles=function(t,e,i,r,a){this._curMat=this._curMat||Matrix.create(),this._vb=this._vb||VertexBuffer2D.create(),this._ib||(this._ib=IndexBuffer2D.create(),GlUtils.fillIBQuadrangle(this._ib,n/4));var s=this._vb,n=r.length>>4;GlUtils.fillTranglesVB(s,e,i,r,a||this._curMat,0,0),GlUtils.expandIBQuadrangle(this._ib,s._byteLength/64+8);var h=new Value2D(1,0);h.textureHost=t;var l=new Shader2X("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}");s._vertType=3,this._setIBVB(e,i,this._ib,s,6*n,a,l,h,0,0)}},n.enable=function(){if(Browser.__init__(),Render.isConchApp&&!Render.isConchWebGL)return RunDriver.skinAniSprite=function(){return new SkinMesh},n.expandContext(),!1;if(RunDriver.getWebGLContext=function(t){for(var e,i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=0;r<i.length;r++){try{e=t.getContext(i[r],{stencil:Config.isStencil,alpha:Config.isAlpha,antialias:Config.isAntialias,premultipliedAlpha:Config.premultipliedAlpha,preserveDrawingBuffer:Config.preserveDrawingBuffer})}catch(t){}if(e)return e}return null},null==(n.mainContext=RunDriver.getWebGLContext(Render._mainCanvas)))return!1;if(Render.isWebGL)return!0;HTMLImage.create=function(t,e){return new WebGLImage(t,e)},HTMLSubImage.create=function(t,e,i,r,a,s,n){return new WebGLSubImage(t,e,i,r,a,s,n)},Render.WebGL=n,Render.isWebGL=!0,DrawText.__init__(),RunDriver.createRenderSprite=function(t,e){return new RenderSprite3D(t,e)},RunDriver.createWebGLContext2D=function(t){return new WebGLContext2D(t)},RunDriver.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},RunDriver.createGraphics=function(){return new GraphicsGL};var t=RunDriver.createFilterAction;return RunDriver.createFilterAction=t||function(t){return new ColorFilterActionGL},RunDriver.clear=function(t){RenderState2D.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=Render.context.ctx,i=0==e._submits._length||Config.preserveDrawingBuffer?Color.create(t)._color:Stage._wgColor;i&&e.clearBG(i[0],i[1],i[2],i[3]),RenderState2D.clear()},RunDriver.addToAtlas=function(t,e){void 0===e&&(e=!1);var i=t.bitmap;Render.optimizeTextureMemory(t.url,t)?Laya.__typeof(i,"laya.webgl.resource.IMergeAtlasBitmap")&&i.allowMerageInAtlas&&i.on("recovered",t,t.addTextureToAtlas):i.enableMerageInAtlas=!1},RunDriver.isAtlas=function(t){return t instanceof laya.webgl.atlas.AtlasWebGLCanvas},AtlasResourceManager._enable(),RunDriver.beginFlush=function(){for(var t=AtlasResourceManager.instance,e=t.getAtlaserCount(),i=0;i<e;i++){var r=t.getAtlaserByIndex(i).texture;r._flashCacheImageNeedFlush&&RunDriver.flashFlushImage(r)}},RunDriver.drawToCanvas=function(t,e,i,r,a,s){(i<=0||r<=0)&&console.log("[error] canvasWidth and canvasHeight should greater than zero"),a-=t.x,s-=t.y;var n=RenderTarget2D.create(i,r,6408,5121,0,!1);n.start(),n.clear(0,0,0,0),Render.context.clear(),RenderSprite.renders[e]._fun(t,Render.context,a,RenderState2D.height-r+s),Render.context.flush(),n.end();var h=n.getData(0,0,n.width,n.height);n.recycle();var l=new WebGLCanvas;l._canvas=Browser.createElement("canvas"),l.size(i,r);var o=l._canvas.getContext("2d");Browser.canvas.size(i,r);var u=Browser.context,_=u.createImageData(i,r);return _.data.set(new Uint8ClampedArray(h.buffer)),l._imgData=_,u.putImageData(_,0,0),o.save(),o.translate(0,r),o.scale(1,-1),o.drawImage(Browser.canvas.source,0,0),o.restore(),l},RunDriver.createFilterAction=function(t){var e;switch(t){case 32:e=new ColorFilterActionGL}return e},RunDriver.addTextureToAtlas=function(t){t._uvID++,AtlasResourceManager._atlasRestore++,t.bitmap.enableMerageInAtlas&&AtlasResourceManager.instance.addToAtlas(t)},RunDriver.getTexturePixels=function(t,e,i,r,a){Render.context.ctx.clear();var s=new Sprite;s.graphics.drawTexture(t,-e,-i);var n=RenderTarget2D.create(r,a);n.start(),n.clear(0,0,0,0),s.render(Render.context,0,0),Render.context.ctx.flush(),n.end();for(var h=n.getData(0,0,r,a),l=[],o=0,u=a-1;0<=u;u--)for(var _=0;_<r;_++)o=4*(u*r+_),l.push(h[o]),l.push(h[o+1]),l.push(h[o+2]),l.push(h[o+3]);return l},RunDriver.skinAniSprite=function(){return new SkinMesh},HTMLCanvas.create=function(t,e){var i=new WebGLCanvas;return i._imgData=e,i.flipY=!1,i},Filter._filterStart=function(t,e,i,r,a){var s=t.getValue("bounds"),n=RenderTarget2D.create(s.width,s.height);if(n.start(),n.clear(0,0,0,0),t.addValue("src",n),t.addValue("ScissorTest",RenderState2D.worldScissorTest),RenderState2D.worldScissorTest){var h=new Rectangle;h.copyFrom(i.ctx._clipRect),t.addValue("clipRect",h),RenderState2D.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},Filter._filterEnd=function(t,e,i,r,a){var s=t.getValue("bounds");t.getValue("src").end();var n=RenderTarget2D.create(s.width,s.height);n.start(),n.clear(0,0,0,0),t.addValue("out",n),e._set$P("_filterCache",n),e._set$P("_isHaveGlowFilter",t.getValue("_isHaveGlowFilter"))},Filter._EndTarget=function(t,e){if(t.getValue("src").recycle(),t.getValue("out").end(),t.getValue("ScissorTest")){RenderState2D.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),e.ctx.save();var i=t.getValue("clipRect");e.ctx.clipRect(i.x,i.y,i.width,i.height)}},Filter._useSrc=function(t){var e=t.getValue("out");e.end(),(e=t.getValue("src")).start(),e.clear(0,0,0,0)},Filter._endSrc=function(t){t.getValue("src").end()},Filter._useOut=function(t){var e=t.getValue("src");e.end(),(e=t.getValue("out")).start(),e.clear(0,0,0,0)},Filter._endOut=function(t){t.getValue("out").end()},Filter._recycleScope=function(t){t.recycle()},Filter._filter=function(t,e,i,r){var a=this._next;if(a){var s,n,h=t.filters,l=h.length;if(1==l&&32==h[0].type)return e.ctx.save(),e.ctx.setFilters([h[0]]),a._fun.call(a,t,e,i,r),void e.ctx.restore();var o=SubmitCMDScope.create(),u=Point.TEMP,_=e.ctx._getTransformMatrix(),c=Matrix.create();_.copyTo(c);var d=0,f=0,m=!1,g=t._$P._filterCache?t._$P._filterCache:null;if(!g||t._repaint){m=t._isHaveGlowFilter(),o.addValue("_isHaveGlowFilter",m),m&&(d=50,f=25),(n=new Rectangle).copyFrom(t.getSelfBounds()),n.x+=t.x,n.y+=t.y,n.x-=t.pivotX+4,n.y-=t.pivotY+4;var p=n.x,x=n.y;if(n.width+=d+8,n.height+=d+8,u.x=n.x*c.a+n.y*c.c,u.y=n.y*c.d+n.x*c.b,n.x=u.x,n.y=u.y,u.x=n.width*c.a+n.height*c.c,u.y=n.height*c.d+n.width*c.b,n.width=u.x,n.height=u.y,n.width<=0||n.height<=0)return;g&&g.recycle(),o.addValue("bounds",n);var b=SubmitCMD.create([o,t,e,0,0],Filter._filterStart);e.addRenderObject(b),e.ctx._renderKey=0,e.ctx._shader2D.glTexture=null;var v=t.x-p+f,T=t.y-x+f;a._fun.call(a,t,e,v,T),b=SubmitCMD.create([o,t,e,0,0],Filter._filterEnd),e.addRenderObject(b);for(var y=0;y<l;y++){0!=y&&(b=SubmitCMD.create([o],Filter._useSrc),e.addRenderObject(b),s=Value2D.create(1,0),Matrix.TEMP.identity(),e.ctx.drawTarget(o,0,0,n.width,n.height,Matrix.TEMP,"out",s,null,BlendMode.TOINT.overlay),b=SubmitCMD.create([o],Filter._useOut),e.addRenderObject(b)),h[y].action.apply3d(o,t,e,0,0)}b=SubmitCMD.create([o,e],Filter._EndTarget),e.addRenderObject(b)}else{if((m=!!t._$P._isHaveGlowFilter&&t._$P._isHaveGlowFilter)&&(d=50,f=25),(n=t.getBounds()).width<=0||n.height<=0)return;n.width+=d,n.height+=d,u.x=n.x*c.a+n.y*c.c,u.y=n.y*c.d+n.x*c.b,n.x=u.x,n.y=u.y,u.x=n.width*c.a+n.height*c.c,u.y=n.height*c.d+n.width*c.b,n.width=u.x,n.height=u.y,o.addValue("out",g)}i=i-f-t.x,r=r-f-t.y,u.setTo(i,r),c.transformPoint(u),i=u.x+n.x,r=u.y+n.y,s=Value2D.create(1,0),Matrix.TEMP.identity(),e.ctx.drawTarget(o,i,r,n.width,n.height,Matrix.TEMP,"out",s,null,BlendMode.TOINT.overlay),b=SubmitCMD.create([o],Filter._recycleScope),e.addRenderObject(b),c.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=n._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=n._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=n._uint8ArraySlice),!0},n.onStageResize=function(t,e){null!=n.mainContext&&(n.mainContext.viewport(0,0,t,e),RenderState2D.width=t,RenderState2D.height=e)},n.onInvalidGLRes=function(){AtlasResourceManager.instance.freeAll(),ResourceManager.releaseContentManagers(!0),n.doNodeRepaint(Laya.stage),n.mainContext.viewport(0,0,RenderState2D.width,RenderState2D.height),Laya.stage.event("devicelost")},n.doNodeRepaint=function(t){0==t.numChildren&&t.repaint();for(var e=0;e<t.numChildren;e++)n.doNodeRepaint(t.getChildAt(e))},n.init=function(t,e,i){n.mainCanvas=t,HTMLCanvas._createContext=function(t){return new WebGLContext2D(t)},WebGLCanvas._createContext=function(t){return new WebGLContext2D(t)};var r=laya.webgl.WebGL.mainContext;if(null!=r.getShaderPrecisionFormat){var a=r.getShaderPrecisionFormat(35633,36338),s=r.getShaderPrecisionFormat(35632,36338);n.shaderHighPrecision=!(!a.precision||!s.precision)}else n.shaderHighPrecision=!1;if(n.compressAstc=r.getExtension("WEBGL_compressed_texture_astc"),n.compressAtc=r.getExtension("WEBGL_compressed_texture_atc"),n.compressEtc=r.getExtension("WEBGL_compressed_texture_etc"),n.compressEtc1=r.getExtension("WEBGL_compressed_texture_etc1"),n.compressPvrtc=r.getExtension("WEBGL_compressed_texture_pvrtc"),n.compressS3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),n.compressS3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),r.deleteTexture1=r.deleteTexture,r.deleteTexture=function(t){t==WebGLContext.curBindTexValue&&(WebGLContext.curBindTexValue=null),r.deleteTexture1(t)},n.onStageResize(e,i),null==n.mainContext)throw new Error("webGL getContext err!");System.__init__(),AtlasResourceManager.__init__(),ShaderDefines2D.__init__(),Submit.__init__(),WebGLContext2D.__init__(),Value2D.__init__(),Shader2D.__init__(),Buffer2D.__int__(r),BlendMode._init_(r),Render.isConchApp&&conch.setOnInvalidGLRes(n.onInvalidGLRes)},n.compressAstc=null,n.compressAtc=null,n.compressEtc=null,n.compressEtc1=null,n.compressPvrtc=null,n.compressS3tc=null,n.compressS3tc_srgb=null,n.mainCanvas=null,n.mainContext=null,n.antialias=!0,n.shaderHighPrecision=!1,n._bg_null=[0,0,0,0],n}(),ShaderDefines=function(){function e(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}__class(e,"laya.webgl.shader.ShaderDefines",!0);var t=e.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)==t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||e._toText(this._value,this._int2name,this._int2nameMap)},e._reg=function(t,e,i,r){r[i[t]=e]=t},e._toText=function(t,e,i){var r=i[t];if(r)return r;for(var a={},s=1,n=0;n<32&&!(t<(s=1<<n));n++)if(t&s){var h=e[s];h&&(a[h]="")}return i[t]=a},e._toInt=function(t,e){for(var i=t.split("."),r=0,a=0,s=i.length;a<s;a++){var n=e[i[a]];if(!n)throw new Error("Defines to int err:"+t+"/"+i[a]);r|=n}return r},e}(),Shader2D=function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new ShaderDefines2D}return __class(t,"laya.webgl.shader.d2.Shader2D",!0),t.prototype.destroy=function(){this.defines=null,this.filters=null,this.glTexture=null,this.strokeStyle=null,this.fillStyle=null},t.__init__=function(){var t,e;Shader.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),Shader.addInclude("parts/ColorFilter_ps_logic.glsl","mat4 alphaMat =colorMat;\n\nalphaMat[0][3] *= gl_FragColor.a;\nalphaMat[1][3] *= gl_FragColor.a;\nalphaMat[2][3] *= gl_FragColor.a;\n\ngl_FragColor = gl_FragColor * alphaMat;\ngl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n"),Shader.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),Shader.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\tvec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);\ngl_FragColor.rgb *= gl_FragColor.a;"),Shader.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),Shader.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\n//float sigma=strength/3.0;//3=13\n//float sig2 = sigma*sigma;\n//float _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\n//float gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO vs\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),Shader.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),Shader.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\ngl_FragColor.xyz *= colorAdd.a;"),t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   color.rgb*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Shader.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",e='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n\tvec4 a = vec4(color.r, color.g, color.b, color.a);\n\ta.w = alpha;\n\ta.xyz *= alpha;\n\tgl_FragColor = a;\n\t#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',Shader.preCompile2D(0,2,t,e,null),t="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=alpha;\n}",Shader.preCompile2D(0,4,t,e,null),t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Shader.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",Shader.preCompile2D(0,512,t,e,null)},t}(),SkinMesh=function(){function n(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMatrix=new Matrix}__class(n,"laya.webgl.shader.d2.skinAnishader.SkinMesh",!0);var t=n.prototype;return t.init=function(t,e,i){if(e)this._vs=e;else{this._vs=[];var r=t.width,a=t.height;this._vs.push(0,0,0,0,1,1,1,1),this._vs.push(r,0,1,0,1,1,1,1),this._vs.push(r,a,1,1,1,1,1,1),this._vs.push(0,a,0,1,1,1,1,1)}this._ps=i||(n._defaultPS||(n._defaultPS=[]).push(0,1,3,3,1,2),n._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=t},t.init2=function(t,e,i,r,a){this.transform&&(this.transform=null),i?this._ps=i:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=r,this._uvs=a,this.mEleNum=this._ps.length,this.mTexture=t,(Render.isConchNode||Render.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},t._initMyData=function(){var t=0,e=0,i=4*this._verticles.length;this._vs=n._tempVS;var r=!1;if(Render.isConchNode||Render.isConchApp?(this._vs.length=i,r=!0):this._vs.length<i&&(this._vs.length=i,r=!0),n._tVSLen=i,r)for(;t<i;)this._vs[t]=this._verticles[e],this._vs[t+1]=this._verticles[e+1],this._vs[t+2]=this._uvs[e],this._vs[t+3]=this._uvs[e+1],this._vs[t+4]=1,this._vs[t+5]=1,this._vs[t+6]=1,this._vs[t+7]=1,t+=8,e+=2;else for(;t<i;)this._vs[t]=this._verticles[e],this._vs[t+1]=this._verticles[e+1],this._vs[t+2]=this._uvs[e],this._vs[t+3]=this._uvs[e+1],t+=8,e+=2},t.getData2=function(t,e,i){var r;this.mVBBuffer=t,this.mIBBuffer=e,this._initMyData(),t.appendEx2(this._vs,Float32Array,n._tVSLen,4),this._indexStart=e._byteLength,(r=n._tempIB).length<this._ps.length&&(r.length=this._ps.length);for(var a=0,s=this._ps.length;a<s;a++)r[a]=this._ps[a]+i;e.appendEx2(r,Uint16Array,this._ps.length,2)},t.getData=function(t,e,i){if(this.mVBBuffer=t,this.mIBBuffer=e,t.append(this.mVBData),this._indexStart=e._byteLength,this.mIBData.start!=i){for(var r=0,a=this._ps.length;r<a;r++)this.mIBData[r]=this._ps[r]+i;this.mIBData.start=i}e.append(this.mIBData)},t.render=function(t,e,i){if(Render.isWebGL&&this.mTexture){t._renderKey=0,t._shader2D.glTexture=null,SkinMeshBuffer.getInstance().addSkinMesh(this);var r=Submit.createShape(t,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,Value2D.create(512,0));this.transform||(this.transform=Matrix.EMPTY),this.transform.translate(e,i),Matrix.mul(this.transform,t._curMat,this._tempMatrix),this.transform.translate(-e,-i);var a=r.shaderValue,s=a.u_mmat2||RenderState2D.getMatrArray();RenderState2D.mat2MatArray(this._tempMatrix,s),a.textureHost=this.mTexture,a.offsetX=0,a.offsetY=0,a.u_mmat2=s,a.ALPHA=t._shader2D.ALPHA,t._submits[t._submits._length++]=r}else Render.isConchApp&&this.mTexture&&(this.transform||(this.transform=Matrix.EMPTY),t.setSkinMesh&&t.setSkinMesh(e,i,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},n._tempVS=[],n._tempIB=[],n._defaultPS=null,n._tVSLen=0,n}(),SkinMeshBuffer=function(){function t(){this.ib=null,this.vb=null;WebGL.mainContext;this.ib=IndexBuffer2D.create(35048),this.vb=VertexBuffer2D.create(8)}__class(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer",!0);var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),FontInContext=function(){function a(t){this._index=0,this._size=14,this._italic=-2,a._cache2=a._cache2||[],this.setFont(t||"14px Arial")}__class(a,"laya.webgl.text.FontInContext",!1);var t=a.prototype;return t.setFont=function(t){var e=a._cache2[t];if(e)this._words=e[0],this._size=e[1];else{this._words=t.split(" ");for(var i=0,r=this._words.length;i<r;i++)if(0<this._words[i].indexOf("px")){this._index=i;break}this._size=parseInt(this._words[this._index]),a._cache2[t]=[this._words,this._size]}this._text=null,this._italic=-2},t.getItalic=function(){return-2==this._italic&&(this._italic=this.hasType("italic")),this._italic},t.hasType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]==t)return e;return-1},t.removeType=function(t){for(var e=0,i=this._words.length;e<i;e++)if(this._words[e]==t){this._words.splice(e,1),this._index>e&&this._index--;break}this._text=null,this._italic=-2},t.copyTo=function(t){return t._text=this._text,t._size=this._size,t._index=this._index,t._words=this._words.slice(),t._italic=-2,t},t.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},__getset(0,t,"size",function(){return this._size},function(t){this._size=t,this._words[this._index]=t+"px",this._text=null}),a.create=function(t){var e=a._cache[t];return e||(e=a._cache[t]=new a(t))},a.EMPTY=new a,a._cache={},a._cache2=null,a}(),CharSegment=function(){function t(){this._sourceStr=null}__class(t,"laya.webgl.text.CharSegment",!0);var e=t.prototype;return Laya.imps(e,{"laya.webgl.text.ICharSegment":!0}),e.textToSpit=function(t){this._sourceStr=t},e.getChar=function(t){return this._sourceStr.charAt(t)},e.getCharCode=function(t){return this._sourceStr.charCodeAt(t)},e.length=function(){return this._sourceStr.length},t}(),DrawText=function(){var t;function C(){}return __class(C,"laya.webgl.text.DrawText",!0),C.__init__=function(){C._charsTemp=new Array,C._drawValue=new t,C._charSeg=new CharSegment},C.customCharSeg=function(t){C._charSeg=t},C.getChar=function(t,e,i){var r=WebGLCharImage.createOneChar(t,i);return-1!=e&&(C._charsCache[e]=r),r},C._drawSlow=function(t,e,i,r,a,s,n,h,l,o,u,_,c,d,f){var m,g,p=C._drawValue.value(s,h,l,o,c,d,f),x=0,b=0,v=C._charsTemp,T=0,y=NaN;if(r)for(v.length=r.length,x=0,b=r.length;x<b;x++)y=(g=r[x]).charNum+p.txtID,v[x]=m=C._charsCache[y]||C.getChar(g.char,y,p),m.active();else{var S=i instanceof laya.utils.WordText?i.toString():i;if(Text.CharacterCache){C._charSeg.textToSpit(S);var A=C._charSeg.length();for(x=0,b=v.length=A;x<b;x++)y=C._charSeg.getCharCode(x)+p.txtID,v[x]=m=C._charsCache[y]||C.getChar(C._charSeg.getChar(x),y,p),m.active(),T+=m.cw}else v.length=0,(m=C.getChar(S,-1,p)).active(),T+=m.cw,v[0]=m}var E=0;null!=n&&"left"!=n&&(E=-("center"==n?T/2:T));var R,M,L=NaN,w=0;if(r)for(x=0,b=v.length;x<b;x++)(m=v[x]).isSpace||(g=r[x],L=m.borderSize,R=m.texture,e._drawText(R,u+E+g.x*c-L,_+g.y*d-L,R.width,R.height,a,0,0,0,0));else{for(x=0,b=v.length;x<b;x++)(m=v[x]).isSpace||(L=m.borderSize,R=m.texture,e._drawText(R,u+E-L,_-L,R.width,R.height,a,0,0,0,0),t&&((M=t[w++])||(M=t[w-1]=[]),M[0]=R,M[1]=E-L,M[2]=-L)),E+=m.cw;t&&(t.length=w)}},C._drawFast=function(t,e,i,r,a){for(var s,n,h=0,l=t.length;h<l;h++)(s=(n=t[h])[0]).active(),e._drawText(s,r+n[1],a+n[2],s.width,s.height,i,0,0,0,0)},C.drawText=function(t,e,i,r,a,s,n,h,l,o,u,_){if(void 0===_&&(_=0),!(e&&0===e.length||i&&0==i.length)){var c=r.a,d=r.d;(0!=r.b||0!=r.c)&&(c=d=1);var f=1!=c||1!=d;if(f&&Laya.stage.transform){var m=Laya.stage.transform;f=m.a==c&&m.d==d}else f=!1;if(f){var g=(r=r.copyTo(WebGLContext2D._tmpMatrix)).tx,p=r.ty;r.scale(1/c,1/d),r._checkTransform(),o*=c,u*=d,o+=g-r.tx,u+=p-r.ty}else c=d=1;if(i)C._drawSlow(null,t,e,i,r,a,s,n,h,l,o,u,c,d,_);else{if(null==e.toUpperCase){var x=c+1e5*d,b=e;return void(b.changed||b.id!=x?(b.id=x,b.changed=!1,C._drawSlow(b.save,t,e,i,r,a,s,n,h,l,o,u,c,d,_)):C._drawFast(b.save,t,r,o,u))}var v=e+a.toString()+n+h+l+c+d+s,T=C._textsCache[v];Text.CharacterCache?T?C._drawFast(T,t,r,o,u):(C._textsCache.__length||(C._textsCache.__length=0),C._textsCache.__length>Config.WebGLTextCacheCount&&((C._textsCache={}).__length=0,C._curPoolIndex=0),C._textCachesPool[C._curPoolIndex]?(T=C._textsCache[v]=C._textCachesPool[C._curPoolIndex]).length=0:C._textCachesPool[C._curPoolIndex]=T=C._textsCache[v]=[],C._textsCache.__length++,C._curPoolIndex++,C._drawSlow(T,t,e,i,r,a,s,n,h,l,o,u,c,d,_)):C._drawSlow(T,t,e,i,r,a,s,n,h,l,o,u,c,d,_)}}},C._charsTemp=null,C._textCachesPool=[],C._curPoolIndex=0,C._charsCache={},C._textsCache={},C._drawValue=null,C.d=[],C._charSeg=null,C.__init$=function(){t=function(){function l(){}return __class(l,"",!0),l.prototype.value=function(t,e,i,r,a,s,n){this.font=t,this.fillColor=e,this.borderColor=i,this.lineWidth=r,this.scaleX=a,this.scaleY=s,this.underLine=n;var h=t.toString()+a+s+r+e+i+n;return this.txtID=l._keymap[h],this.txtID||(this.txtID=1e-7*++l._keymapCount,l._keymap[h]=this.txtID),this},l.clear=function(){l._keymap={},l._keymapCount=1},l._keymap={},l._keymapCount=1,l}()},C}(),AtlasGrid=function(){var r,a;function t(t,e,i){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new a,void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._cells=null,this._rowInfo=null,this._init(t,e),this._atlasID=i}__class(t,"laya.webgl.atlas.AtlasGrid",!0);var e=t.prototype;return e.getAltasID=function(){return this._atlasID},e.setAltasID=function(t){0<=t&&(this._atlasID=t)},e.addTex=function(t,e,i){var r=this._get(e,i);return 0==r.ret||(this._fill(r.x,r.y,e,i,t),this._texCount++),r},e._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},e._init=function(t,e){if(this._width=t,this._height=e,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=__newvec(this._height);for(var i=0;i<this._height;i++)this._rowInfo[i]=new r;return this._clear(),!0},e._get=function(t,e){var i=new MergeFillInfo;if(t>=this._failSize.width&&e>=this._failSize.height)return i;for(var r=-1,a=-1,s=this._width,n=this._height,h=this._cells,l=0;l<n;l++)if(!(this._rowInfo[l].spaceCount<t))for(var o=0;o<s;){var u=3*(l*s+o);if(0!=h[u]||h[u+1]<t||h[u+2]<e)o+=h[u+1];else{r=o,a=l;for(var _=0;_<t;_++)if(h[3*_+u+2]<e){r=-1;break}if(!(r<0))return i.ret=!0,i.x=r,i.y=a,i;o+=h[u+1]}}return i},e._fill=function(t,e,i,r,a){var s=this._width,n=this._height;this._check(t+i<=s&&e+r<=n);for(var h=e;h<r+e;++h){this._check(this._rowInfo[h].spaceCount>=i),this._rowInfo[h].spaceCount-=i;for(var l=0;l<i;l++){var o=3*(t+h*s+l);this._check(0==this._cells[o]),this._cells[o]=a,this._cells[o+1]=i,this._cells[o+2]=r}}if(0<t)for(h=0;h<r;++h){var u=0;for(l=t-1;0<=l&&0==this._cells[3*((e+h)*s+l)];--l,++u);for(l=u;0<l;--l)this._cells[3*((e+h)*s+t-l)+1]=l,this._check(0<l)}if(0<e)for(l=t;l<t+i;++l){for(u=0,h=e-1;0<=h&&0==this._cells[3*(l+h*s)];--h,u++);for(h=u;0<h;--h)this._cells[3*(l+(e-h)*s)+2]=h,this._check(0<h)}},e._check=function(t){0==t&&console.log("xtexMerger ")},e._clear=function(){for(var t=this._texCount=0;t<this._height;t++)this._rowInfo[t].spaceCount=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var r=3*(e*this._width+i);this._cells[r]=0,this._cells[r+1]=this._width-i,this._cells[r+2]=this._width-e}this._failSize.width=this._width+1,this._failSize.height=this._height+1},t.__init$=function(){r=function(){function t(){this.spaceCount=0}return __class(t,"",!0),t}(),a=function(){function t(){this.width=0,this.height=0}return __class(t,"",!0),t}()},t}(),MergeFillInfo=function(){function t(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return __class(t,"laya.webgl.atlas.MergeFillInfo",!0),t}(),AtlasResourceManager=function(){function p(t,e,i,r){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=r,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this._atlaserArray=[]}__class(p,"laya.webgl.atlas.AtlasResourceManager",!0);var t=p.prototype;return t.setAtlasParam=function(t,e,i,r){if(1==this._setAtlasParam)return p._sid_=0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=r,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log(""),-1},t.pushData=function(t){var e,i=t.bitmap,r=-1,a=null,s=0,n=0;for(s=0,e=this._atlaserArray.length;s<e&&(n=(this._curAtlasIndex+s)%e,-1==(r=(a=this._atlaserArray[n]).findBitmapIsExist(i)));s++);if(-1!=r){var h=a.InAtlasWebGLImagesOffsetValue[r];return f=h[0],m=h[1],a.addToAtlas(t,f,m),!0}this._setAtlasParam=!1;for(var l=Math.ceil((t.bitmap.width+2)/this._gridSize),o=Math.ceil((t.bitmap.height+2)/this._gridSize),u=!1,_=0;_<2;_++){var c=this._maxAtlaserCount;for(s=0;s<c;s++){n=(this._curAtlasIndex+s)%c,this._atlaserArray.length-1>=n||this._atlaserArray.push(new Atlaser(this._gridNumX,this._gridNumY,this._width,this._height,p._sid_++));var d=this._atlaserArray[n],f=0,m=0,g=d.addTex(1,l,o);if(g.ret){f=g.x*this._gridSize+1,m=g.y*this._gridSize+1,i.lock=!0,d.addToAtlasTexture(i,f,m),d.addToAtlas(t,f,m),u=!0,this._curAtlasIndex=n;break}}if(u)break;this._atlaserArray.push(new Atlaser(this._gridNumX,this._gridNumY,this._width,this._height,p._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return u||console.log(">>>AtlasManager pushData error"),u},t.addToAtlas=function(t){laya.webgl.atlas.AtlasResourceManager.instance.pushData(t)},t.garbageCollection=function(){if(1==this._needGC){for(var t=this._atlaserArray.length-this._maxAtlaserCount,e=0;e<t;e++)this._atlaserArray[e].dispose(),console.log("AtlasResourceManager:Dispose the inner Atlas");console.log(">>>>altas garbageCollection ="+t),this._atlaserArray.splice(0,t),this._needGC=!1}return!0},t.freeAll=function(){for(var t=0,e=this._atlaserArray.length;t<e;t++)this._atlaserArray[t].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},t.getAtlaserCount=function(){return this._atlaserArray.length},t.getAtlaserByIndex=function(t){return this._atlaserArray[t]},__getset(1,p,"atlasLimitWidth",function(){return p._atlasLimitWidth},function(t){p._atlasLimitWidth=t}),__getset(1,p,"enabled",function(){return Config.atlasEnable}),__getset(1,p,"atlasLimitHeight",function(){return p._atlasLimitHeight},function(t){p._atlasLimitHeight=t}),__getset(1,p,"instance",function(){return p._Instance||(p._Instance=new p(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),p._Instance}),p._enable=function(){Config.atlasEnable=!0},p._disable=function(){Config.atlasEnable=!1},p.__init__=function(){p.atlasTextureWidth=2048,p.atlasTextureHeight=2048,p.maxTextureCount=6,p.atlasLimitWidth=512,p.atlasLimitHeight=512},p._atlasLimitWidth=0,p._atlasLimitHeight=0,p.gridSize=16,p.atlasTextureWidth=0,p.atlasTextureHeight=0,p.maxTextureCount=0,p._atlasRestore=0,p.BOARDER_TYPE_NO=0,p.BOARDER_TYPE_RIGHT=1,p.BOARDER_TYPE_LEFT=2,p.BOARDER_TYPE_BOTTOM=4,p.BOARDER_TYPE_TOP=8,p.BOARDER_TYPE_ALL=15,p._sid_=0,p._Instance=null,p}(),RenderTargetMAX=function(){function t(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new Rectangle}__class(t,"laya.webgl.resource.RenderTargetMAX",!0);var e=t.prototype;return e.setSP=function(t){this._sp=t},e.size=function(t,e){var i=this;this._width!=t||this._height!=e?(this.repaint=!0,this._width=t,this._height=e,this.target?this.target.size(t,e):this.target=RenderTarget2D.create(t,e),this.target.hasListener("recovered")||this.target.on("recovered",this,function(t){Laya.timer.callLater(i._sp,i._sp.repaint)})):this.target.size(t,e)},e._flushToTarget=function(t,e){if(!e._destroy){var i=RenderState2D.worldScissorTest,r=RenderState2D.worldClipRect;RenderState2D.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,RenderState2D.worldScissorTest=!1,WebGL.mainContext.disable(3089);var a=RenderState2D.worldAlpha,s=RenderState2D.worldMatrix4,n=RenderState2D.worldMatrix,h=RenderState2D.worldFilters,l=RenderState2D.worldShaderDefines;if(RenderState2D.worldMatrix=Matrix.EMPTY,RenderState2D.restoreTempArray(),RenderState2D.worldMatrix4=RenderState2D.TEMPMAT4_ARRAY,RenderState2D.worldAlpha=1,RenderState2D.worldFilters=null,RenderState2D.worldShaderDefines=null,BaseShader.activeShader=null,e.start(),Config.showCanvasMark?e.clear(0,1,0,.3):e.clear(0,0,0,0),t.flush(),e.end(),BaseShader.activeShader=null,RenderState2D.worldAlpha=a,RenderState2D.worldMatrix4=s,RenderState2D.worldMatrix=n,RenderState2D.worldFilters=h,RenderState2D.worldShaderDefines=l,RenderState2D.worldScissorTest=i){var o=RenderState2D.height-r.y-r.height;WebGL.mainContext.scissor(r.x,o,r.width,r.height),WebGL.mainContext.enable(3089)}RenderState2D.worldClipRect=r}},e.flush=function(t){this.repaint&&(this._flushToTarget(t,this.target),this.repaint=!1)},e.drawTo=function(t,e,i,r,a){t.drawTexture(this.target.getTexture(),e,i,r,a,0,0)},e.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},t}(),RenderSprite3D=function(t){function g(t,e){g.__super.call(this,t,e)}__class(g,"laya.webgl.utils.RenderSprite3D",!1,t);var e=g.prototype;return e.onCreate=function(t){switch(t){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},e._mask=function(t,e,i,r){var a,s,n=this._next,h=t.mask;if(h){e.ctx.save();var l=e.ctx.globalCompositeOperation,o=new Rectangle;if(o.copyFrom(h.getBounds()),o.width=Math.round(o.width),o.height=Math.round(o.height),o.x=Math.round(o.x),o.y=Math.round(o.y),0<o.width&&0<o.height){var u=t._style._tf,_=SubmitCMDScope.create();_.addValue("bounds",o),a=SubmitCMD.create([_,e],laya.webgl.utils.RenderSprite3D.tmpTarget),e.addRenderObject(a),h.render(e,-o.x,-o.y),a=SubmitCMD.create([_],laya.webgl.utils.RenderSprite3D.endTmpTarget),e.addRenderObject(a),e.ctx.save(),e.clipRect(i-u.translateX+o.x,r-u.translateY+o.y,o.width,o.height),n._fun.call(n,t,e,i,r),e.ctx.restore(),s=SubmitStencil.create(6),l=e.ctx.globalCompositeOperation,s.blendMode="mask",e.addRenderObject(s),Matrix.TEMP.identity();var c=Value2D.create(1,0),d=Texture.INV_UV,f=o.width,m=o.height;(o.width<32||o.height<32)&&((d=g.tempUV)[0]=0,d[1]=0,d[2]=32<=o.width?1:o.width/32,d[3]=0,d[4]=32<=o.width?1:o.width/32,d[5]=32<=o.height?1:o.height/32,d[6]=0,d[7]=32<=o.height?1:o.height/32,o.width=32<=o.width?o.width:32,o.height=32<=o.height?o.height:32,d[1]*=-1,d[3]*=-1,d[5]*=-1,d[7]*=-1,d[1]+=1,d[3]+=1,d[5]+=1,d[7]+=1),e.ctx.drawTarget(_,i+o.x-u.translateX,r+o.y-u.translateY,f,m,Matrix.TEMP,"tmpTarget",c,d,6),a=SubmitCMD.create([_],laya.webgl.utils.RenderSprite3D.recycleTarget),e.addRenderObject(a),(s=SubmitStencil.create(6)).blendMode=l,e.addRenderObject(s)}e.ctx.restore()}else n._fun.call(n,t,e,i,r)},e._blend=function(t,e,i,r){var a=t._style,s=this._next;a.blendMode?(e.ctx.save(),e.ctx.globalCompositeOperation=a.blendMode,s._fun.call(s,t,e,i,r),e.ctx.restore()):s._fun.call(s,t,e,i,r)},e._transform=function(t,e,i,r){var a=t.transform,s=this._next;if(a&&s!=RenderSprite.NORENDER){var n=e.ctx;t._style;a.tx=i,a.ty=r;var h=n._getTransformMatrix(),l=h.clone();Matrix.mul(a,h,h),h._checkTransform(),a.tx=a.ty=0,s._fun.call(s,t,e,0,0),l.copyTo(h),l.destroy()}else s._fun.call(s,t,e,i,r)},g.tmpTarget=function(t,e){var i=t.getValue("bounds"),r=RenderTarget2D.create(i.width,i.height);r.start(),r.clear(0,0,0,0),t.addValue("tmpTarget",r)},g.endTmpTarget=function(t){t.getValue("tmpTarget").end()},g.recycleTarget=function(t){t.getValue("tmpTarget").recycle(),t.recycle()},__static(g,["tempUV",function(){return this.tempUV=new Array(8)}]),g}(RenderSprite),Value2D=function(t){function r(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,r.__super.call(this),this.defines=new ShaderDefines2D,this.position=r._POSITION,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=r._cache[this._cacheID],0<t&&!this._inClassCache&&(this._inClassCache=r._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}__class(r,"laya.webgl.shader.d2.value.Value2D",!1,ShaderValue);var e=r.prototype;return e.setValue=LAYAFNVOID,e.refresh=function(){var t=this.size;return t[0]=RenderState2D.width,t[1]=RenderState2D.height,this.alpha=this.ALPHA*RenderState2D.worldAlpha,this.mmat=RenderState2D.worldMatrix4,this},e._ShaderWithCompile=function(){return Shader.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Shader2X.create)},e._withWorldShaderDefines=function(){var t=RenderState2D.worldShaderDefines,e=Shader.sharders[this.mainID|this.defines._value|t.getValue()];if(!e){var i,r={};for(i in this.defines.toNameDic())r[i]="";for(i in t.toNameDic())r[i]="";e=Shader.withCompile2D(0,this.mainID,r,this.mainID|this.defines._value|t.getValue(),Shader2X.create)}var a=RenderState2D.worldFilters;if(!a)return e;for(var s,n=a.length,h=0;h<n;h++)(s=a[h])&&s.action.setValue(this);return e},e.upload=function(){var t=RenderState2D;this.alpha=this.ALPHA*t.worldAlpha,RenderState2D.worldMatrix4!=RenderState2D.TEMPMAT4_ARRAY&&this.defines.add(128),WebGL.shaderHighPrecision&&this.defines.add(1024);var e,i=t.worldShaderDefines?this._withWorldShaderDefines():Shader.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=t.width,this.size[1]=t.height,this.mmat=t.worldMatrix4,BaseShader.activeShader!==i?i._shaderValueWidth!=t.width||i._shaderValueHeight!=t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick2||i._make2dQuick2():i._shaderValueWidth!=t.width||i._shaderValueHeight!=t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick1||i._make2dQuick1(),i.upload(this,e)},e.setFilters=function(t){if(this.filters=t)for(var e,i=t.length,r=0;r<i;r++)(e=t[r])&&(this.defines.add(e.type),e.action.setValue(this))},e.clear=function(){this.defines.setValue(this.subID)},e.release=function(){(this._inClassCache[this._inClassCache._length++]=this).fillStyle=null,this.strokeStyle=null,this.clear()},r._initone=function(t,e){r._typeClass[t]=e,r._cache[t]=[],r._cache[t]._length=0},r.__init__=function(){r._POSITION=[2,5126,!1,4*CONST3D2D.BYTES_PE,0],r._TEXCOORD=[2,5126,!1,4*CONST3D2D.BYTES_PE,2*CONST3D2D.BYTES_PE],r._initone(2,Color2dSV),r._initone(4,PrimitiveSV),r._initone(256,FillTextureSV),r._initone(512,SkinSV),r._initone(1,TextureSV),r._initone(65,TextSV),r._initone(9,TextureSV)},r.create=function(t,e){var i=r._cache[t|e];return i._length?i[--i._length]:new r._typeClass[t|e](e)},r._POSITION=null,r._TEXCOORD=null,r._cache=[],r._typeClass=[],r.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r}(),WebGLContext2D=function(t){var i;function O(t){this._x=0,this._y=0,this._id=++O._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=null,this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this._shader2D=null,this.meshlist=[],this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,O.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=O.MAXCLIPRECT,this.mOutPoint,this._canvas=t,O._contextcount++,Render.isFlash?(this._ib=IndexBuffer2D.create(35044),GlUtils.fillIBQuadrangle(this._ib,16)):this._ib=IndexBuffer2D.QuadrangleIB,this.clear()}__class(O,"laya.webgl.canvas.WebGLContext2D",!1,t);var e=O.prototype;return e.setIsMainContext=function(){this._isMain=!0},e.clearBG=function(t,e,i,r){var a=WebGL.mainContext;a.clearColor(t,e,i,r),a.clear(16384)},e._getSubmits=function(){return this._submits},e._releaseMem=function(){if(this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this._other&&(this._other.font=null),this._save=null,this._vb&&(this._vb.releaseResource(),this._vb.destroy(),this._vb.destory(),this._vb=null)}},e.destroy=function(){--O._contextcount,this.sprite=null,this._releaseMem(),this._targets&&this._targets.destroy(),this._targets=null,this._canvas=null,this._ib&&this._ib!=IndexBuffer2D.QuadrangleIB&&this._ib.releaseResource()},e.clear=function(){this._submits||(this._other=i.DEFAULT,this._curMat=Matrix.create(),this._vb=VertexBuffer2D.create(-1),this._submits=[],this._save=[SaveMark.Create(this)],this._save.length=10,this._shader2D=new Shader2D,this._triangleMesh=MeshTexture.getAMesh()),this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=i.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=O.MAXCLIPRECT,this._curSubmit=Submit.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=DrawStyle.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},e.size=function(t,e){if(this._width!=t||this._height!=e)if(0==t||0==e){0!=this._vb._byteLength&&(this._width=t,this._height=e,this._vb.clear(),this._vb.upload());for(var i=0,r=this._submits._length;i<r;i++)this._submits[i].releaseRender();this._submits.length=0,this._submits._length=0,this._curSubmit=null,this._path&&this._path.recover(),this._path=null,this.sprite=null,this._targets&&this._targets.destroy(),this._targets=null}else this._width=t,this._height=e,this._targets&&this._targets.size(t,e),this._canvas.memorySize-=this._canvas.memorySize;0==t&&0==e&&this._releaseMem()},e._getTransformMatrix=function(){return this._curMat},e.translate=function(t,e){0==t&&0==e||(SaveTranslate.save(this),this._curMat.bTransform&&(SaveTransform.save(this),this._curMat.transformPointN(Point.TEMP.setTo(t,e)),t=Point.TEMP.x,e=Point.TEMP.y),this._x+=t,this._y+=e)},e.save=function(){this._save[this._save._length++]=SaveMark.Create(this)},e.restore=function(){var t=this._save._length;if(!(t<1))for(var e=t-1;0<=e;e--){var i=this._save[e];if(i.restore(this),i.isSaveMark())return void(this._save._length=e)}},e._fillText=function(t,e,i,r,a,s,n,h,l,o){void 0===o&&(o=0);var u=this._shader2D,_=this._curSubmit.shaderValue,c=a?FontInContext.create(a):this._other.font;if(AtlasResourceManager.enabled)u.ALPHA!=_.ALPHA&&(u.glTexture=null),DrawText.drawText(this,t,e,this._curMat,c,l||this._other.textAlign,s,n,h,i,r,o);else{this._shader2D.defines.getValue();var d=s?Color.create(s)._color:u.colorAdd;u.ALPHA==_.ALPHA&&d==u.colorAdd&&_.colorAdd==u.colorAdd||(u.glTexture=null,u.colorAdd=d),DrawText.drawText(this,t,e,this._curMat,c,l||this._other.textAlign,s,n,h,i,r,o)}},e.fillWords=function(t,e,i,r,a,s){this._fillText(null,t,e,i,r,a,null,-1,null,s)},e.fillBorderWords=function(t,e,i,r,a,s,n){this._fillBorderText(null,t,e,i,r,a,s,n,null)},e.fillText=function(t,e,i,r,a,s){this._fillText(t,null,e,i,r,a,null,-1,s)},e.strokeText=function(t,e,i,r,a,s,n){this._fillText(t,null,e,i,r,null,a,s||1,n)},e.fillBorderText=function(t,e,i,r,a,s,n,h){this._fillBorderText(t,null,e,i,r,a,s,n,h)},e._fillBorderText=function(t,e,i,r,a,s,n,h,l){if(!AtlasResourceManager.enabled)return this._fillText(t,e,i,r,a,null,n,h||1,l),void this._fillText(t,e,i,r,a,s,null,-1,l);var o=this._shader2D,u=this._curSubmit.shaderValue;o.ALPHA!=u.ALPHA&&(o.glTexture=null);var _=a?(O._fontTemp.setFont(a),O._fontTemp):this._other.font;DrawText.drawText(this,t,e,this._curMat,_,l||this._other.textAlign,s,n,h||1,i,r,0)},e.fillRect=function(t,e,i,r,a){var s=this._vb;if(GlUtils.fillRectImgVb(s,this._clipRect,t,e,i,r,Texture.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var n=this._shader2D.fillStyle;a&&(this._shader2D.fillStyle=DrawStyle.create(a));var h=this._shader2D,l=this._curSubmit.shaderValue;if(h.fillStyle!=l.fillStyle||h.ALPHA!=l.ALPHA){h.glTexture=null;var o=this._curSubmit=Submit.createSubmit(this,this._ib,s,(s._byteLength-64)/32*3,Value2D.create(2,0));o.shaderValue.color=h.fillStyle._color._color,o.shaderValue.ALPHA=h.ALPHA,this._submits[this._submits._length++]=o}this._curSubmit._numEle+=6,this._shader2D.fillStyle=n}},e.fillTexture=function(t,e,i,r,a,s,n,h){if(t.loaded&&t.bitmap&&t.source){var l=this._vb,o=t.bitmap.width,u=t.bitmap.height,_=t.uv,c=n.x%t.width,d=n.y%t.height;if(o!=h.w||u!=h.h){if(!h.w&&!h.h)switch(h.oy=h.ox=0,s){case"repeat":h.width=r,h.height=a;break;case"repeat-x":h.width=r,d<0?t.height+d>a?h.height=a:h.height=t.height+d:(h.oy=d,t.height+d>a?h.height=a-d:h.height=t.height);break;case"repeat-y":c<0?t.width+c>r?h.width=r:h.width=t.width+c:(h.ox=c,t.width+c>r?h.width=r-c:h.width=t.width),h.height=a;break;default:h.width=r,h.height=a}h.w=o,h.h=u,h.uv=[0,0,h.width/o,0,h.width/o,h.height/u,0,h.height/u]}if(e+=h.ox,i+=h.oy,c-=h.ox,d-=h.oy,GlUtils.fillRectImgVb(l,this._clipRect,e,i,h.width,h.height,h.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var f=SubmitTexture.create(this,this._ib,l,(l._byteLength-64)/32*3,Value2D.create(256,0)),m=(this._submits[this._submits._length++]=f).shaderValue;m.textureHost=t;var g=_[0]*o,p=_[1]*u,x=(_[2]-_[0])*o,b=(_[5]-_[3])*u,v=-c/o,T=-d/u;m.u_TexRange[0]=g/o,m.u_TexRange[1]=x/o,m.u_TexRange[2]=p/u,m.u_TexRange[3]=b/u,m.u_offset[0]=v,m.u_offset[1]=T,AtlasResourceManager.enabled&&!this._isMain&&f.addTexture(t,(l._byteLength>>2)-16),(this._curSubmit=f)._renderType=10017,f._numEle+=6}}else this.sprite&&Laya.timer.callLater(this,__bind(this,this._repaintSprite))},e.setShader=function(t){SaveBase.save(this,1048576,this._shader2D,!0),this._shader2D.shader=t},e.setFilters=function(t){SaveBase.save(this,2097152,this._shader2D,!0),this._shader2D.filters=t,this._curSubmit=Submit.RENDERBASE,this._renderKey=0,this._drawCount++},e.drawTexture=function(t,e,i,r,a,s,n){this._drawTextureM(t,e,i,r,a,s,n,null,1)},e.addTextureVb=function(t,e,i){var r=this._curSubmit._vb||this._vb,a=r._byteLength>>2;r.byteLength=a+16<<2;for(var s=r.getFloat32Array(),n=0;n<16;n+=4)s[a++]=t[n]+e,s[a++]=t[n+1]+i,s[a++]=t[n+2],s[a++]=t[n+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),r._upload=!0},e.willDrawTexture=function(t,e){if(!(t.loaded&&t.bitmap&&t.source))return this.sprite&&Laya.timer.callLater(this,__bind(this,this._repaintSprite)),0;var i=t.bitmap,r=i.id+this._shader2D.ALPHA*e+10016;if(r==this._renderKey)return r;var a=this._shader2D,s=a.ALPHA,n=this._curSubmit.shaderValue;a.ALPHA*=e,this._renderKey=r,this._drawCount++,a.glTexture=i;var h=this._vb,l=null,o=h._byteLength/32*3;return l=SubmitTexture.create(this,this._ib,h,o,Value2D.create(1,0)),(this._submits[this._submits._length++]=l).shaderValue.textureHost=t,l._renderType=10016,l._preIsSameTextureShader=10016==this._curSubmit._renderType&&a.ALPHA==n.ALPHA,this._curSubmit=l,a.ALPHA=s,r},e.drawTextures=function(t,e,i,r){if(t.loaded&&t.bitmap&&t.source){var a=this._clipRect;if(this._clipRect=O.MAXCLIPRECT,this._drawTextureM(t,e[0],e[1],t.width,t.height,i,r,null,1)){if(this._clipRect=a,Stat.drawCall++,!(e.length<4)){for(var s=this._curSubmit._vb||this._vb,n=this._curMat.a,h=this._curMat.d,l=2,o=e.length;l<o;l+=2)GlUtils.copyPreImgVb(s,(e[l]-e[l-2])*n,(e[l+1]-e[l-1])*h),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}}else alert("drawTextures err")}else this.sprite&&Laya.timer.callLater(this,__bind(this,this._repaintSprite))},e._drawTextureM=function(t,e,i,r,a,s,n,h,l){if(!t.loaded||!t.source)return this.sprite&&Laya.timer.callLater(this,__bind(this,this._repaintSprite)),!1;var o=this._curSubmit._vb||this._vb,u=t.bitmap;e+=s,i+=n,this._drawCount++;var _=u.id+this._shader2D.ALPHA*l+10016;if(_!=this._renderKey){this._renderKey=_;var c=this._curSubmit.shaderValue,d=this._shader2D,f=d.ALPHA;d.ALPHA*=l,d.glTexture=u;var m=this._vb,g=null,p=m._byteLength/32*3;g=SubmitTexture.create(this,this._ib,m,p,Value2D.create(1,0)),(this._submits[this._submits._length++]=g).shaderValue.textureHost=t,g._renderType=10016,g._preIsSameTextureShader=10016==this._curSubmit._renderType&&d.ALPHA==c.ALPHA,this._curSubmit=g,o=this._curSubmit._vb||this._vb,d.ALPHA=f}return!!GlUtils.fillRectImgVb(o,this._clipRect,e,i,r||t.width,a||t.height,t.uv,h||this._curMat,this._x,this._y,0,0)&&(AtlasResourceManager.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(o._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0)},e._repaintSprite=function(){this.sprite&&this.sprite.repaint()},e._drawText=function(t,e,i,r,a,s,n,h,l,o){var u=t.bitmap;this._drawCount++;var _=u.id+this._shader2D.ALPHA+10016;if(_!=this._renderKey){this._renderKey=_;var c=this._curSubmit.shaderValue,d=this._shader2D;d.glTexture=u;var f=this._vb,m=null,g=f._byteLength/32*3;(m=AtlasResourceManager.enabled?SubmitTexture.create(this,this._ib,f,g,Value2D.create(1,0)):SubmitTexture.create(this,this._ib,f,g,TextSV.create()))._preIsSameTextureShader=10016==this._curSubmit._renderType&&d.ALPHA==c.ALPHA,(this._submits[this._submits._length++]=m).shaderValue.textureHost=t,m._renderType=10016,this._curSubmit=m}t.active();var p=this._curSubmit._vb||this._vb;GlUtils.fillRectImgVb(p,this._clipRect,e+n,i+h,r||t.width,a||t.height,t.uv,s||this._curMat,this._x,this._y,l,o,!0)&&(AtlasResourceManager.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(p._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},e.drawTextureWithTransform=function(t,e,i,r,a,s,n,h,l){if(s){var o=this._curMat,u=this._x,_=this._y;(0!=n||0!=h)&&(this._x=n*o.a+h*o.c,this._y=h*o.d+n*o.b),s&&o.bTransform?(Matrix.mul(s,o,O._tmpMatrix),(s=O._tmpMatrix)._checkTransform()):(this._x+=o.tx,this._y+=o.ty),this._drawTextureM(t,e,i,r,a,0,0,s,l),this._x=u,this._y=_}else this._drawTextureM(t,e,i,r,a,n,h,null,l)},e.fillQuadrangle=function(t,e,i,r,a){var s=this._curSubmit,n=this._vb,h=this._shader2D,l=s.shaderValue;if(this._renderKey=0,t.bitmap){var o=t.bitmap;h.glTexture==o&&h.ALPHA==l.ALPHA||(h.glTexture=o,(s=this._curSubmit=Submit.createSubmit(this,this._ib,n,n._byteLength/32*3,Value2D.create(1,0))).shaderValue.glTexture=o,this._submits[this._submits._length++]=s),GlUtils.fillQuadrangleImgVb(n,e,i,r,t.uv,a||this._curMat,this._x,this._y)}else s.shaderValue.fillStyle&&s.shaderValue.fillStyle.equal(t)&&h.ALPHA==l.ALPHA||(h.glTexture=null,(s=this._curSubmit=Submit.createSubmit(this,this._ib,n,n._byteLength/32*3,Value2D.create(2,0))).shaderValue.defines.add(2),s.shaderValue.fillStyle=DrawStyle.create(t),this._submits[this._submits._length++]=s),GlUtils.fillQuadrangleImgVb(n,e,i,r,Texture.DEF_UV,a||this._curMat,this._x,this._y);s._numEle+=6},e.drawTexture2=function(t,e,i,r,a,s,n,h){if(0!=s){var l=this._curMat;if(this._x=t*l.a+e*l.c,this._y=e*l.d+t*l.b,a&&(a=l.bTransform||a.bTransform?(Matrix.mul(a,l,O._tmpMatrix),O._tmpMatrix):(this._x+=a.tx+l.tx,this._y+=a.ty+l.ty,Matrix.EMPTY)),1!=s||n){var o=this._shader2D.ALPHA,u=this._nBlendType;this._shader2D.ALPHA=s,n&&(this._nBlendType=BlendMode.TOINT(n)),this._drawTextureM(h[0],h[1]-i,h[2]-r,h[3],h[4],0,0,a,1),this._shader2D.ALPHA=o,this._nBlendType=u}else this._drawTextureM(h[0],h[1]-i,h[2]-r,h[3],h[4],0,0,a,1);this._x=this._y=0}},e.drawCanvas=function(t,e,i,r,a){var s=t.context;if(this._renderKey=0,s._targets)this._submits[this._submits._length++]=SubmitCanvas.create(s,0,null),this._curSubmit=Submit.RENDERBASE,s._targets.drawTo(this,e,i,r,a);else{var n=this._submits[this._submits._length++]=SubmitCanvas.create(s,this._shader2D.ALPHA,this._shader2D.filters),h=r/t.width,l=a/t.height,o=n._matrix;this._curMat.copyTo(o),1!=h&&1!=l&&o.scale(h,l);var u=o.tx,_=o.ty;o.tx=o.ty=0,o.transformPoint(Point.TEMP.setTo(e,i)),o.translate(Point.TEMP.x+u,Point.TEMP.y+_),this._curSubmit=Submit.RENDERBASE}Config.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=s._targets?"yellow":"green",this.strokeRect(e-1,i-1,r+2,a+2,1),this.strokeRect(e,i,r,a,1),this.restore())},e.drawTarget=function(t,e,i,r,a,s,n,h,l,o){void 0===o&&(o=-1);var u=this._vb;if(GlUtils.fillRectImgVb(u,this._clipRect,e,i,r,a,l||Texture.DEF_UV,s||this._curMat,this._x,this._y,0,0)){this._renderKey=0,this._shader2D.glTexture=null;this._curSubmit.shaderValue;var _=this._curSubmit=SubmitTarget.create(this,this._ib,u,(u._byteLength-64)/32*3,h,n);_.blendType=-1==o?this._nBlendType:o,_.scope=t,this._submits[this._submits._length++]=_,this._curSubmit._numEle+=6}},e.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},e._mixRGBandAlpha=function(t,e){var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},e.drawTriangles=function(t,e,i,r,a,s,n,h,l,o){if(!t.loaded||!t.source)return this.sprite&&Laya.timer.callLater(this,__bind(this,this._repaintSprite)),!1;this._drawCount++;t.bitmap;var u=this._mixRGBandAlpha(4294967295,h),_=(r.length,s.length);this._renderKey=-1;var c=this._curSubmit=SubmitTexture.create(this,this._triangleMesh.getIBR(),this._triangleMesh.getVBR(),this._triangleMesh.indexNum,Value2D.create(1,0));return c.shaderValue.textureHost=t,c._renderType=10016,this._submits[this._submits._length++]=c,n?(O._tmpMatrix.a=n.a,O._tmpMatrix.b=n.b,O._tmpMatrix.c=n.c,O._tmpMatrix.d=n.d,O._tmpMatrix.tx=n.tx+e,O._tmpMatrix.ty=n.ty+i,Matrix.mul(O._tmpMatrix,this._curMat,O._tmpMatrix)):(O._tmpMatrix.a=this._curMat.a,O._tmpMatrix.b=this._curMat.b,O._tmpMatrix.c=this._curMat.c,O._tmpMatrix.d=this._curMat.d,O._tmpMatrix.tx=this._curMat.tx+e,O._tmpMatrix.ty=this._curMat.ty+i),this._triangleMesh.addData(r,a,s,O._tmpMatrix,u,this),this._curSubmit._numEle+=_,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0},e.transform=function(t,e,i,r,a,s){SaveTransform.save(this),Matrix.mul(Matrix.TEMP.setTo(t,e,i,r,a,s),this._curMat,this._curMat),this._curMat._checkTransform()},e.setTransformByMatrix=function(t){t.copyTo(this._curMat)},e.transformByMatrix=function(t){SaveTransform.save(this),Matrix.mul(t,this._curMat,this._curMat),this._curMat._checkTransform()},e.rotate=function(t){SaveTransform.save(this),this._curMat.rotateEx(t)},e.scale=function(t,e){SaveTransform.save(this),this._curMat.scaleEx(t,e)},e.clipRect=function(t,e,i,r){if(0!=this._curMat.b||0!=this._curMat.c){this._renderKey=0;var a=SubmitStencil.create(4);this.addRenderObject(a);var s=this._vb,n=s._byteLength>>2;if(GlUtils.fillRectImgVb(s,null,t,e,i,r,Texture.DEF_UV,this._curMat,this._x,this._y,0,0)){this._shader2D.glTexture=null;var h=this._curSubmit=Submit.createSubmit(this,this._ib,s,(s._byteLength-64)/32*3,Value2D.create(2,0));h.shaderValue.ALPHA=1,this._submits[this._submits._length++]=h,this._curSubmit._numEle+=6}else alert("clipRect calc stencil rect error");var l=SubmitStencil.create(5);this.addRenderObject(l);var o=s.getFloat32Array(),u=Math.min(Math.min(Math.min(o[n+0],o[n+4]),o[n+8]),o[n+12]),_=Math.max(Math.max(Math.max(o[n+0],o[n+4]),o[n+8]),o[n+12]),c=Math.min(Math.min(Math.min(o[n+1],o[n+5]),o[n+9]),o[n+13]),d=Math.max(Math.max(Math.max(o[n+1],o[n+5]),o[n+9]),o[n+13]);SaveClipRectStencil.save(this,l,t,e,i,r,u,c,_-u,d-c),this._curSubmit=Submit.RENDERBASE}else{i*=this._curMat.a,r*=this._curMat.d;var f=Point.TEMP;this._curMat.transformPoint(f.setTo(t,e)),i<0&&(f.x=f.x+i,i=-i),r<0&&(f.y=f.y+r,r=-r),this._renderKey=0;var m=this._curSubmit=SubmitScissor.create(this);(this._submits[this._submits._length++]=m).submitIndex=this._submits._length,m.submitLength=9999999,SaveClipRect.save(this,m);var g=this._clipRect,p=g.x,x=g.y,b=f.x+i,v=f.y+r;p<f.x&&(g.x=f.x),x<f.y&&(g.y=f.y),g.width=Math.min(b,p+g.width)-g.x,g.height=Math.min(v,x+g.height)-g.y,this._shader2D.glTexture=null,m.clipRect.copyFrom(g),this._curSubmit=Submit.RENDERBASE}},e.setIBVB=function(t,e,i,r,a,s,n,h,l,o,u){if(void 0===l&&(l=0),void 0===o&&(o=0),void 0===u&&(u=0),null==i){if(Render.isFlash){var _=r;_._selfIB||(_._selfIB=IndexBuffer2D.create(35044)),_._selfIB.clear(),i=_._selfIB}else i=this._ib;GlUtils.expandIBQuadrangle(i,r._byteLength/(4*r.vertexStride*4))}if(!h||!n)throw Error("setIBVB must input:shader shaderValues");var c=SubmitOtherIBVB.create(this,r,i,a,n,h,l,o,u);s||(s=Matrix.EMPTY),s.translate(t,e),Matrix.mul(s,this._curMat,c._mat),s.translate(-t,-e),this._submits[this._submits._length++]=c,this._curSubmit=Submit.RENDERBASE,this._renderKey=0},e.addRenderObject=function(t){this._submits[this._submits._length++]=t},e.fillTrangles=function(t,e,i,r,a){var s=this._curSubmit,n=this._vb,h=this._shader2D,l=s.shaderValue,o=r.length>>4,u=t.bitmap;this._renderKey=0,h.glTexture==u&&h.ALPHA==l.ALPHA||((s=this._curSubmit=Submit.createSubmit(this,this._ib,n,n._byteLength/32*3,Value2D.create(1,0))).shaderValue.textureHost=t,this._submits[this._submits._length++]=s),GlUtils.fillTranglesVB(n,e,i,r,a||this._curMat,this._x,this._y),s._numEle+=6*o},e.submitElement=function(t,e){var i=this._submits;for(e<0&&(e=i._length);t<e;)t+=i[t].renderSubmit()},e.finish=function(){WebGL.mainContext.finish()},e.flush=function(){var t=Math.max(this._vb._byteLength/64,this._maxNumEle/6)+8;if(t>this._ib.bufferLength/12&&GlUtils.expandIBQuadrangle(this._ib,t),!this._isMain&&AtlasResourceManager.enabled&&AtlasResourceManager._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=AtlasResourceManager._atlasRestore;for(var e=this._submits,i=0,r=e._length;i<r;i++){var a=e[i];10016==a.getRenderType()&&a.checkTexture()}}this.submitElement(0,this._submits._length),this._path&&this._path.reset(),SkinMeshBuffer.instance&&SkinMeshBuffer.getInstance().reset();var s;for(i=0,s=this.meshlist.length;i<s;i++){var n=this.meshlist[i];n.canReuse?n.releaseMesh():n.destroy()}return this.meshlist.length=0,this._curSubmit=Submit.RENDERBASE,this._renderKey=0,this._triangleMesh=MeshTexture.getAMesh(),this.meshlist.push(this._triangleMesh),this._submits._length},e.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=VectorGraphManager.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},e.movePath=function(t,e){var i=t,r=e;t=this._curMat.a*i+this._curMat.c*r+this._curMat.tx,e=this._curMat.b*i+this._curMat.d*r+this._curMat.ty,this.mX+=t,this.mY+=e},e.beginPath=function(){var t=this._getPath();t.tempArray.length=0,t.closePath=!1,this.mX=0,this.mY=0},e.closePath=function(){this._path.closePath=!0},e.fill=function(t){void 0===t&&(t=!1);var e=this._getPath();this.drawPoly(0,0,e.tempArray,this.fillStyle._color.numColor,0,0,t)},e.stroke=function(){var t=this._getPath();if(0<this.lineWidth){if(-1==this.mId)t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var e=VectorGraphManager.getInstance().shapeLineDic[this.mId];e.rebuild(t.tempArray),t.setGeomtry(e)}else VectorGraphManager.getInstance().addLine(this.mId,t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor));t.update();var i=[this.mX,this.mY],r=Submit.createShape(this,t.ib,t.vb,t.count,t.offset,Value2D.create(4,0));r.shaderValue.ALPHA=this._shader2D.ALPHA,r.shaderValue.u_pos=i,r.shaderValue.u_mmat2=RenderState2D.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=r,this._renderKey=-1}},e.line=function(t,e,i,r,a,s){var n=this._curSubmit,h=this._vb;if(GlUtils.fillLineVb(h,this._clipRect,t,e,i,r,a,s)){this._renderKey=0;var l=this._shader2D,o=n.shaderValue;l.strokeStyle==o.strokeStyle&&l.ALPHA==o.ALPHA||(l.glTexture=null,(n=this._curSubmit=Submit.createSubmit(this,this._ib,h,(h._byteLength-64)/32*3,Value2D.create(2,0))).shaderValue.strokeStyle=l.strokeStyle,n.shaderValue.mainID=2,n.shaderValue.ALPHA=l.ALPHA,this._submits[this._submits._length++]=n),n._numEle+=6}},e.moveTo=function(t,e,i){void 0===i&&(i=!0);var r=this._getPath();if(i){var a=t,s=e;t=this._curMat.a*a+this._curMat.c*s,e=this._curMat.b*a+this._curMat.d*s}r.addPoint(t,e)},e.lineTo=function(t,e,i){void 0===i&&(i=!0);var r=this._getPath();if(i){var a=t,s=e;t=this._curMat.a*a+this._curMat.c*s,e=this._curMat.b*a+this._curMat.d*s}r.addPoint(t,e)},e.drawCurves=function(t,e,i){this.setPathId(-1),this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var r=i[2];t+=i[0],e+=i[1],this.movePath(t,e),this.moveTo(r[0],r[1]);for(var a=2,s=r.length;a<s;)this.quadraticCurveTo(r[a++],r[a++],r[a++],r[a++]);this.stroke()},e.arcTo=function(t,e,i,r,a){if(-1==this.mId||!this.mHaveKey){var s=0,n=0,h=0,l=this._getPath();this._curMat.copyTo(O._tmpMatrix),O._tmpMatrix.tx=O._tmpMatrix.ty=0,O._tempPoint.setTo(l.getEndPointX(),l.getEndPointY()),O._tmpMatrix.invertTransformPoint(O._tempPoint);var o=O._tempPoint.x-t,u=O._tempPoint.y-e,_=Math.sqrt(o*o+u*u);if(!(_<=1e-6)){var c=o/_,d=u/_,f=i-t,m=r-e,g=f*f+m*m,p=Math.sqrt(g);if(!(p<=1e-6)){var x=f/p,b=m/p,v=c+x,T=d+b,y=Math.sqrt(v*v+T*T);if(!(y<=1e-6)){var S=v/y,A=T/y,E=Math.acos(S*c+A*d),R=Math.PI/2-E,M=(_=a/Math.tan(R))*c+t,L=_*d+e,w=Math.sqrt(_*_+a*a),C=t+S*w,I=e+A*w,D=0,B=0;if(0<=c*b-d*x){var P=2*R/O.SEGNUM;D=Math.sin(P),B=Math.cos(P)}else P=2*-R/O.SEGNUM,D=Math.sin(P),B=Math.cos(P);n=this._curMat.a*M+this._curMat.c*L,h=this._curMat.b*M+this._curMat.d*L,n==this._path.getEndPointX()&&h==this._path.getEndPointY()||l.addPoint(n,h);var F=M-C,N=L-I;for(s=0;s<O.SEGNUM;s++){var V=F*B+N*D,G=-F*D+N*B;n=V+C,h=G+I,t=this._curMat.a*n+this._curMat.c*h,h=e=this._curMat.b*n+this._curMat.d*h,(n=t)==this._path.getEndPointX()&&h==this._path.getEndPointY()||l.addPoint(n,h),F=V,N=G}}}}}},e.arc=function(t,e,i,r,a,s,n){if(void 0===s&&(s=!1),void 0===n&&(n=!0),-1!=this.mId){var h=VectorGraphManager.getInstance().shapeDic[this.mId];if(h&&this.mHaveKey&&!h.needUpdate(this._curMat))return;e=t=0}var l,o=0,u=0,_=0,c=0,d=0,f=0,m=0;if(u=a-r,s)if(Math.abs(u)>=2*Math.PI)u=2*-Math.PI;else for(;0<u;)u-=2*Math.PI;else if(Math.abs(u)>=2*Math.PI)u=2*Math.PI;else for(;u<0;)u+=2*Math.PI;l=u/(m=i<101?Math.max(10,u*i/5):i<201?Math.max(10,u*i/20):Math.max(10,u*i/40))/2,_=Math.abs(4/3*(1-Math.cos(l))/Math.sin(l)),s&&(_=-_);var g=this._getPath(),p=NaN,x=NaN;for(f=0;f<=m;f++)o=r+u*(f/m),c=t+Math.cos(o)*i,d=e+Math.sin(o)*i,n&&(p=c,x=d,c=this._curMat.a*p+this._curMat.c*x,d=this._curMat.b*p+this._curMat.d*x),c==this._path.getEndPointX()&&d==this._path.getEndPointY()||g.addPoint(c,d);c=t+Math.cos(a)*i,d=e+Math.sin(a)*i,n&&(p=c,x=d,c=this._curMat.a*p+this._curMat.c*x,d=this._curMat.b*p+this._curMat.d*x),c==this._path.getEndPointX()&&d==this._path.getEndPointY()||g.addPoint(c,d)},e.quadraticCurveTo=function(t,e,i,r){var a=Bezier.I,s=i,n=r;i=this._curMat.a*s+this._curMat.c*n,r=this._curMat.b*s+this._curMat.d*n,s=t,n=e,t=this._curMat.a*s+this._curMat.c*n,e=this._curMat.b*s+this._curMat.d*n;for(var h=a.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),t,e,i,r],30,2),l=0,o=h.length/2;l<o;l++)this.lineTo(h[2*l],h[2*l+1],!1);this.lineTo(i,r,!1)},e.rect=function(t,e,i,r){this._other=this._other.make(),this._other.path||(this._other.path=new Path),this._other.path.rect(t,e,i,r)},e.strokeRect=function(t,e,i,r,a){var s=.5*a;this.line(t-s,e,t+i+s,e,a,this._curMat),this.line(t+i,e,t+i,e+r,a,this._curMat),this.line(t,e,t,e+r,a,this._curMat),this.line(t-s,e+r,t+i+s,e+r,a,this._curMat)},e.clip=function(){},e.drawPoly=function(t,e,i,r,a,s,n){void 0===n&&(n=!1),this._renderKey=0,this._shader2D.glTexture=null;var h=this._getPath();if(-1==this.mId)h.polygon(t,e,i,r,a||1,s);else if(this.mHaveKey){var l=VectorGraphManager.getInstance().shapeDic[this.mId];l.setMatrix(this._curMat),l.rebuild(h.tempArray),h.setGeomtry(l)}else{var o=h.polygon(t,e,i,r,a||1,s);VectorGraphManager.getInstance().addShape(this.mId,o),o.setMatrix(this._curMat)}h.update();var u,_=[this.mX,this.mY];if((u=Submit.createShape(this,h.ib,h.vb,h.count,h.offset,Value2D.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,u.shaderValue.u_pos=_,u.shaderValue.u_mmat2=RenderState2D.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=u,0<a){if(this.mHaveLineKey){var c=VectorGraphManager.getInstance().shapeLineDic[this.mId];c.rebuild(h.tempArray),h.setGeomtry(c)}else VectorGraphManager.getInstance().addShape(this.mId,h.drawLine(t,e,i,a,s));h.update(),(u=Submit.createShape(this,h.ib,h.vb,h.count,h.offset,Value2D.create(4,0))).shaderValue.ALPHA=this._shader2D.ALPHA,u.shaderValue.u_mmat2=RenderState2D.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=u}},e.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},e._getPath=function(){return this._path||(this._path=new Path)},__getset(0,e,"globalCompositeOperation",function(){return BlendMode.NAMES[this._nBlendType]},function(t){var e=BlendMode.TOINT[t];null==e||this._nBlendType==e||(SaveBase.save(this,65536,this,!0),this._curSubmit=Submit.RENDERBASE,this._renderKey=0,this._nBlendType=e)}),__getset(0,e,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign==t||(this._other=this._other.make(),SaveBase.save(this,32768,this._other,!1),this._other.textAlign=t)}),__getset(0,e,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(SaveBase.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=t)}),__getset(0,e,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(SaveBase.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=DrawStyle.create(t))}),__getset(0,e,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline==t||(this._other=this._other.make(),SaveBase.save(this,16384,this._other,!1),this._other.textBaseline=t)}),__getset(0,e,"font",null,function(t){t!=this._other.font.toString()&&(this._other=this._other.make(),SaveBase.save(this,8,this._other,!1),this._other.font==FontInContext.EMPTY?this._other.font=new FontInContext(t):this._other.font.setFont(t))}),__getset(0,e,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth==t||(this._other=this._other.make(),SaveBase.save(this,256,this._other,!1),this._other.lineWidth=t)}),__getset(0,e,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(SaveBase.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=DrawStyle.create(t))}),__getset(0,e,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new RenderTargetMAX),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),O.__init__=function(){i.DEFAULT=new i},O._tempPoint=new Point,O._SUBMITVBSIZE=32e3,O._MAXSIZE=99999999,O._RECTVBSIZE=16,O.MAXCLIPRECT=new Rectangle(0,0,99999999,99999999),O._COUNT=0,O._tmpMatrix=new Matrix,O.SEGNUM=32,O._contextcount=0,__static(O,["_fontTemp",function(){return this._fontTemp=new FontInContext},"_drawStyleTemp",function(){return this._drawStyleTemp=new DrawStyle(null)}]),O.__init$=function(){i=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=FontInContext.EMPTY}__class(t,"",!0);var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=FontInContext.EMPTY},e.make=function(){return this==t.DEFAULT?new t:this},t.DEFAULT=null,t}()},O}(Context),GraphicsGL=function(t){function e(){e.__super.call(this)}__class(e,"laya.webgl.display.GraphicsGL",!1,t);var i=e.prototype;return i.setShader=function(t){this._saveToCmd(Render.context._setShader,[t])},i.setIBVB=function(t,e,i,r,a,s){this._saveToCmd(Render.context._setIBVB,[t,e,i,r,a,s])},i.drawParticle=function(t,e,i){var r=RunDriver.createParticleTemplate2D(i);r.x=t,r.y=e,this._saveToCmd(Render.context._drawParticle,[r])},e}(Graphics),ColorFilterActionGL=function(t){function e(){this.data=null,e.__super.call(this)}__class(e,"laya.filters.webgl.ColorFilterActionGL",!1,FilterActionGL);var i=e.prototype;return Laya.imps(i,{"laya.filters.IFilterActionGL":!0}),i.setValue=function(t){t.colorMat=this.data._mat,t.colorAlpha=this.data._alpha},i.apply3d=function(t,e,i,r,a){var s=t.getValue("bounds"),n=Value2D.create(1,0);n.setFilters([this.data]);var h=Matrix.TEMP;h.identity(),i.ctx.drawTarget(t,0,0,s.width,s.height,h,"src",n)},e}(),SubmitTexture=function(t){function o(t){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===t&&(t=1e4),o.__super.call(this,t)}__class(o,"laya.webgl.submit.SubmitTexture",!1,Submit);var e=o.prototype;return e.releaseRender=function(){var t=o._cache;(t[t._length++]=this).shaderValue.release(),this._preIsSameTextureShader=!1,this._vb=null,this._texs.length=0,this._vbPos.length=0,this._isSameTexture=!0},e.addTexture=function(t,e){this._texsID[this._texs.length]=t._uvID,this._texs.push(t),this._vbPos.push(e)},e.checkTexture=function(){if(this._texs.length<1)this._isSameTexture=!0;else{var t=this.shaderValue.textureHost.bitmap;if(null!=t)for(var e=this._vb.getFloat32Array(),i=0,r=this._texs.length;i<r;i++){var a=this._texs[i];a.active();var s=a.uv;if(this._texsID[i]!=a._uvID){this._texsID[i]=a._uvID;var n=this._vbPos[i];e[n+2]=s[0],e[n+3]=s[1],e[n+6]=s[2],e[n+7]=s[3],e[n+10]=s[4],e[n+11]=s[5],e[n+14]=s[6],e[n+15]=s[7],this._vb.setNeedUpload()}a.bitmap!=t&&(this._isSameTexture=!1)}}},e.renderSubmit=function(){if(0==this._numEle)return o._shaderSet=!1,1;var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return o._shaderSet=!1,1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=WebGL.mainContext;if(BlendMode.activeBlendFunction!=this._blendFn&&(i.enable(3042),this._blendFn(i),BlendMode.activeBlendFunction=this._blendFn),Stat.drawCall++,Stat.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&BaseShader.activeShader&&o._shaderSet?BaseShader.activeShader.uploadTexture2D(this.shaderValue.texture):this.shaderValue.upload(),o._shaderSet=!0,1<this._texs.length&&!this._isSameTexture)for(var r=t.bitmap,a=0,s=BaseShader.activeShader,n=0,h=this._texs.length;n<h;n++){var l=this._texs[n];l.bitmap==r&&n+1!=h||(s.uploadTexture2D(l.source),i.drawElements(4,6*(n-a+1),5123,this._startIdx+6*a*CONST3D2D.BYTES_PIDX),r=l.bitmap,a=n)}else i.drawElements(4,this._numEle,5123,this._startIdx);return 1},o.create=function(t,e,i,r,a){var s=o._cache._length?o._cache[--o._cache._length]:new o;null==i&&((i=s._selfVb||(s._selfVb=VertexBuffer2D.create(-1))).clear(),r=0),s._ib=e,s._vb=i,s._startIdx=r*CONST3D2D.BYTES_PIDX,s._numEle=0;var n=t._nBlendType;s._blendFn=t._targets?BlendMode.targetFns[n]:BlendMode.fns[n],s.shaderValue=a,s.shaderValue.setValue(t._shader2D);var h=t._shader2D.filters;return h&&s.shaderValue.setFilters(h),s},o._cache=((o._cache=[])._length=0,o._cache),o._shaderSet=!0,o}(),SubmitCanvas=function(t){function s(){this._matrix=new Matrix,this._matrix4=CONST3D2D.defaultMatrix4.concat(),s.__super.call(this,1e4),this.shaderValue=new Value2D(0,0)}__class(s,"laya.webgl.submit.SubmitCanvas",!1,Submit);var e=s.prototype;return e.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var t=RenderState2D.worldAlpha,e=RenderState2D.worldMatrix4,i=RenderState2D.worldMatrix,r=RenderState2D.worldFilters,a=RenderState2D.worldShaderDefines,s=this.shaderValue,n=this._matrix,h=this._matrix4,l=Matrix.TEMP;return Matrix.mul(n,i,l),h[0]=l.a,h[1]=l.b,h[4]=l.c,h[5]=l.d,h[12]=l.tx,h[13]=l.ty,RenderState2D.worldMatrix=l.clone(),RenderState2D.worldMatrix4=h,RenderState2D.worldAlpha=RenderState2D.worldAlpha*s.alpha,s.filters&&s.filters.length&&(RenderState2D.worldFilters=s.filters,RenderState2D.worldShaderDefines=s.defines),this._ctx_src.flush(),RenderState2D.worldAlpha=t,RenderState2D.worldMatrix4=e,RenderState2D.worldMatrix.destroy(),RenderState2D.worldMatrix=i,RenderState2D.worldFilters=r,RenderState2D.worldShaderDefines=a,1},e.releaseRender=function(){var t=s._cache;this._ctx_src=null,t[t._length++]=this},e.getRenderType=function(){return 10003},s.create=function(t,e,i){var r=s._cache._length?s._cache[--s._cache._length]:new s;r._ctx_src=t;var a=r.shaderValue;return a.alpha=e,a.defines.setValue(0),i&&i.length&&a.setFilters(i),r},s._cache=((s._cache=[])._length=0,s._cache),s}(),LoopLine=function(t){function _(t,e,i,r,a){this._points=[];for(var s=NaN,n=NaN,h=-1,l=-1,o=i.length/2-1,u=0;u<o;u++)s=i[2*u],n=i[2*u+1],(.01<Math.abs(h-s)||.01<Math.abs(l-n))&&this._points.push(s,n),h=s,l=n;s=i[2*o],n=i[2*o+1],h=this._points[0],l=this._points[1],(.01<Math.abs(h-s)||.01<Math.abs(l-n))&&this._points.push(s,n),_.__super.call(this,t,e,0,0,this._points.length/2,0,r,a)}__class(_,"laya.webgl.shapes.LoopLine",!1,BasePoly);var e=_.prototype;return e.getData=function(t,e,i){if(0<this.borderWidth){for(var r=this.color,a=(r>>16&255)/255,s=(r>>8&255)/255,n=(255&r)/255,h=[],l=0,o=0,u=[],_=Math.floor(this._points.length/2),c=0;c<_;c++)l=this._points[2*c],o=this._points[2*c+1],h.push(this.x+l,this.y+o,a,s,n);this.createLoopLine(h,u,this.borderWidth,i+h.length/5),t.append(new Uint16Array(u)),e.append(new Float32Array(h))}},e.createLoopLine=function(t,e,i,r,a,s){t.length;var n=t.concat(),h=a||t,l=this.borderColor,o=(l>>16&255)/255,u=(l>>8&255)/255,_=(255&l)/255,c=[n[0],n[1]],d=[n[n.length-5],n[n.length-4]],f=d[0]+.5*(c[0]-d[0]),m=d[1]+.5*(c[1]-d[1]);n.unshift(f,m,0,0,0),n.push(f,m,0,0,0);var g,p,x,b,v,T,y,S,A,E,R,M,L,w,C,I,D,B,P,F,N=n.length/5,V=r,G=i/2;x=n[0],b=n[1],E=x-(v=n[5]),A=(A=-(b-(T=n[6])))/(F=Math.sqrt(A*A+E*E))*G,E=E/F*G,h.push(x-A,b-E,o,u,_,x+A,b+E,o,u,_);for(var O=1;O<N-1;O++)x=n[5*(O-1)],b=n[5*(O-1)+1],v=n[5*O],T=n[5*O+1],y=n[5*(O+1)],S=n[5*(O+1)+1],E=x-v,M=v-y,C=(-(A=(A=-(b-T))/(F=Math.sqrt(A*A+E*E))*G)+x)*(-(E=E/F*G)+T)-(-A+v)*(-E+b),B=(-(R=(R=-(T-S))/(F=Math.sqrt(R*R+M*M))*G)+y)*(-(M=M/F*G)+T)-(-R+v)*(-M+S),P=(L=-E+b-(-E+T))*(D=-R+v-(-R+y))-(I=-M+S-(-M+T))*(w=-A+v-(-A+x)),Math.abs(P)<.1?(P+=10.1,h.push(v-A,T-E,o,u,_,v+A,T+E,o,u,_)):(((g=(w*B-D*C)/P)-v)*(g-v)+((p=(I*C-L*B)/P)-T)+(p-T),h.push(g,p,o,u,_,v-(g-v),T-(p-T),o,u,_));s&&(e=s);var W=this.edges+1;for(O=1;O<W;O++)e.push(V+2*(O-1),V+2*(O-1)+1,V+2*O+1,V+2*O+1,V+2*O,V+2*(O-1));return e.push(V+2*(O-1),V+2*(O-1)+1,V+1,V+1,V,V+2*(O-1)),h},_}(),Ellipse=function(t){function h(t,e,i,r,a,s,n){h.__super.call(this,t,e,i,r,40,a,s,n)}return __class(h,"laya.webgl.shapes.Ellipse",!1,BasePoly),h}(),Line=function(t){function s(t,e,i,r,a){this._points=[],this.rebuild(i),s.__super.call(this,t,e,0,0,0,a,r,a,0)}__class(s,"laya.webgl.shapes.Line",!1,BasePoly);var e=s.prototype;return e.rebuild=function(t){var e=t.length;e!=this._points.length&&(this.mUint16Array=new Uint16Array(6*(e/2-1)),this.mFloat32Array=new Float32Array(5*e)),this._points.length=0;for(var i=NaN,r=NaN,a=-1,s=-1,n=t.length/2,h=0;h<n;h++)i=t[2*h],r=t[2*h+1],(.01<Math.abs(a-i)||.01<Math.abs(s-r))&&this._points.push(i,r),a=i,s=r},e.getData=function(t,e,i){var r=[],a=[];0<this.borderWidth&&this.createLine2(this._points,r,this.borderWidth,i,a,this._points.length/2),this.mUint16Array.set(r,0),this.mFloat32Array.set(a,0),t.append(this.mUint16Array),e.append(this.mFloat32Array)},s}(),Polygon=function(t){function n(t,e,i,r,a,s){this._points=null,this._start=-1,this._repaint=!1,this.earcutTriangles=null,this._mat=Matrix.create(),this._points=i.slice(0,i.length),n.__super.call(this,t,e,0,0,this._points.length/2,r,a,s)}__class(n,"laya.webgl.shapes.Polygon",!1,BasePoly);var e=n.prototype;return e.rebuild=function(t){this._repaint||(this._points.length=0,this._points=this._points.concat(t))},e.setMatrix=function(t){t.copyTo(this._mat)},e.needUpdate=function(t){return this._repaint=this._mat.a==t.a&&this._mat.b==t.b&&this._mat.c==t.c&&this._mat.d==t.d&&this._mat.tx==t.tx&&this._mat.ty==t.ty,!this._repaint},e.getData=function(t,e,i){var r,a=0,s=this._points,n=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=i){for(this._start=i,r=[],n=this.earcutTriangles.length,a=0;a<n;a++)r.push(this.earcutTriangles[a]+i);this.mUint16Array=new Uint16Array(r)}}else{this._start=i,r=[];var h=[],l=[],o=this.color,u=(o>>16&255)/255,_=(o>>8&255)/255,c=(255&o)/255;for(n=Math.floor(s.length/2),a=0;a<n;a++)h.push(this.x+s[2*a],this.y+s[2*a+1],u,_,c),l.push(this.x+s[2*a],this.y+s[2*a+1]);for(this.earcutTriangles=Earcut.earcut(l,null,2),n=this.earcutTriangles.length,a=0;a<n;a++)r.push(this.earcutTriangles[a]+i);this.mUint16Array=new Uint16Array(r),this.mFloat32Array=new Float32Array(h)}t.append(this.mUint16Array),e.append(this.mFloat32Array)},n}(),MeshTexture=function(t){function p(){p.__super.call(this,laya.webgl.utils.MeshTexture.const_stride,0,0),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}__class(p,"laya.webgl.utils.MeshTexture",!1,Mesh2D);var e=p.prototype;return e.addData=function(t,e,i,r,a,s){for(var n=t.length/2,h=this._vb.needSize(n*p.const_stride)>>2,l=this._vb.getFloat32Array(),o=0,u=0;u<n;u++){var _=t[o],c=t[o+1],d=_*r.a+c*r.c+r.tx,f=_*r.b+c*r.d+r.ty;l[h++]=d,l[h++]=f,l[h++]=e[o],l[h++]=e[o+1],o+=2}this._vb.setNeedUpload();var m=this.vertNum;if(0<m){(n=i.length)>p.tmpIdx.length&&(p.tmpIdx=new Uint16Array(n));for(var g=0;g<n;g++)p.tmpIdx[g]=i[g]+m;this._ib.appendU16Array(p.tmpIdx,i.length)}else this._ib.append(i);this._ib.setNeedUpload(),this.vertNum+=n,this.indexNum+=i.length},e.releaseMesh=function(){this._vb._byteLength=0,this._ib._byteLength=0,this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy()},p.getAMesh=function(){return laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new p},p.const_stride=16,p._POOL=[],__static(p,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5126,2,8]},"tmpIdx",function(){return this.tmpIdx=new Uint16Array(4)}]),p}(),ShaderDefines2D=function(t){function i(){i.__super.call(this,i.__name2int,i.__int2name,i.__int2nameMap)}return __class(i,"laya.webgl.shader.d2.ShaderDefines2D",!1,ShaderDefines),i.__init__=function(){i.reg("TEXTURE2D",1),i.reg("COLOR2D",2),i.reg("PRIMITIVE",4),i.reg("GLOW_FILTER",8),i.reg("BLUR_FILTER",16),i.reg("COLOR_FILTER",32),i.reg("COLOR_ADD",64),i.reg("WORLDMAT",128),i.reg("FILLTEXTURE",256),i.reg("FSHIGHPRECISION",1024)},i.reg=function(t,e){ShaderDefines._reg(t,e,i.__name2int,i.__int2name)},i.toText=function(t,e,i){return ShaderDefines._toText(t,e,i)},i.toInt=function(t){return ShaderDefines._toInt(t,i.__name2int)},i.TEXTURE2D=1,i.COLOR2D=2,i.PRIMITIVE=4,i.FILTERGLOW=8,i.FILTERBLUR=16,i.FILTERCOLOR=32,i.COLORADD=64,i.WORLDMAT=128,i.FILLTEXTURE=256,i.SKINMESH=512,i.SHADERDEFINE_FSHIGHPRECISION=1024,i.__name2int={},i.__int2name=[],i.__int2nameMap=[],i}(),Atlaser=function(t){function s(t,e,i,r,a){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,s.__super.call(this,t,e,a),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey={},this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new AtlasWebGLCanvas,(this._atlasCanvas._atlaser=this)._atlasCanvas.width=i,this._atlasCanvas.height=r,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}__class(s,"laya.webgl.atlas.Atlaser",!1,AtlasGrid);var e=s.prototype;return e.computeUVinAtlasTexture=function(t,e,i,r){var a=AtlasResourceManager.atlasTextureWidth,s=AtlasResourceManager.atlasTextureHeight,n=i/a,h=r/s,l=(i+t.bitmap.width)/a,o=(r+t.bitmap.height)/s,u=t.bitmap.width/a,_=t.bitmap.height/s;t.uv=[n+e[0]*u,h+e[1]*_,l-(1-e[2])*u,h+e[3]*_,l-(1-e[4])*u,o-(1-e[5])*_,n+e[6]*u,o-(1-e[7])*_]},e.findBitmapIsExist=function(t){if(t instanceof laya.webgl.resource.WebGLImage){var e=t,i=e.url,r=this._InAtlasWebGLImagesKey[i||e.id];if(r)return r.offsetInfoID}return-1},e.addToAtlasTexture=function(t,e,i){if(t instanceof laya.webgl.resource.WebGLImage){var r=t,a=r.url;this._InAtlasWebGLImagesKey[a||r.id]={bitmap:t,offsetInfoID:this._InAtlasWebGLImagesOffsetValue.length},this._InAtlasWebGLImagesOffsetValue.push([e,i])}this._atlasCanvas.texSubImage2D(e,i,t.atlasSource),t.clearAtlasSource()},e.addToAtlas=function(t,e,i){t._atlasID=this._inAtlasTextureKey.length;var r=t.uv.slice(),a=t.bitmap;this._inAtlasTextureKey.push(t),this._inAtlasTextureOriUVValue.push(r),this._inAtlasTextureBitmapValue.push(a),this.computeUVinAtlasTexture(t,r,e,i),t.bitmap=this._atlasCanvas},e.clear=function(){for(var t=0,e=this._inAtlasTextureKey.length;t<e;t++)this._inAtlasTextureKey[t].bitmap=this._inAtlasTextureBitmapValue[t],this._inAtlasTextureKey[t].uv=this._inAtlasTextureOriUVValue[t],this._inAtlasTextureKey[t]._atlasID=-1,this._inAtlasTextureKey[t].bitmap.lock=!1,this._inAtlasTextureKey[t].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue.length=0},e.dispose=function(){this.clear(),this._atlasCanvas.destroy()},__getset(0,e,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),__getset(0,e,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),__getset(0,e,"texture",function(){return this._atlasCanvas}),s}(),BaseShader=function(t){function e(){e.__super.call(this),this.lock=!0}return __class(e,"laya.webgl.shader.BaseShader",!1,t),e.activeShader=null,e.bindShader=null,e}(Resource),Buffer=function(t){function e(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,e.__super.call(this),e._gl=WebGL.mainContext}__class(e,"laya.webgl.utils.Buffer",!1,t);var i=e.prototype;return i._bind=function(){this.activeResource(),e._bindActive[this._bufferType]!=this._glBuffer&&(34962==this._bufferType&&(e._bindVertexBuffer=this._glBuffer),e._gl.bindBuffer(this._bufferType,e._bindActive[this._bufferType]=this._glBuffer),BaseShader.activeShader=null)},i.recreateResource=function(){this._glBuffer||(this._glBuffer=e._gl.createBuffer()),this.completeCreate()},i.disposeResource=function(){this._glBuffer&&(WebGL.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},__getset(0,i,"bufferUsage",function(){return this._bufferUsage}),e._gl=null,e._bindActive={},e._bindVertexBuffer=null,e._enableAtributes=[],e}(Resource),RenderTarget2D=function(e){function u(t,e,i,r,a,s,n,h,l){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===i&&(i=6408),void 0===r&&(r=5121),void 0===a&&(a=34041),void 0===s&&(s=!1),void 0===n&&(n=!1),void 0===h&&(h=-1),void 0===l&&(l=-1),this._type=1,this._w=t,this._h=e,this._surfaceFormat=i,this._surfaceType=r,this._depthStencilFormat=a,Render.isConchWebGL&&34041==this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=s,this._repeat=n,this._minFifter=h,this._magFifter=l,this._createWebGLRenderTarget(),this.bitmap.lock=!0,u.__super.call(this,this.bitmap,Texture.INV_UV)}__class(u,"laya.webgl.resource.RenderTarget2D",!1,e);var t=u.prototype;return Laya.imps(t,{"laya.resource.IDispose":!0}),t.getType=function(){return this._type},t.getTexture=function(){return this},t.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},t.release=function(){this.destroy()},t.recycle=function(){u.POOL.push(this)},t.start=function(){var t=WebGL.mainContext;return this._preRenderTarget=RenderState2D.curRenderTarget,RenderState2D.curRenderTarget=this,t.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(t.viewport(0,0,this._w,this._h),this._svWidth=RenderState2D.width,this._svHeight=RenderState2D.height,RenderState2D.width=this._w,RenderState2D.height=this._h,BaseShader.activeShader=null),this},t.clear=function(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1);var a=WebGL.mainContext;a.clearColor(t,e,i,r);var s=16384;switch(this._depthStencilFormat){case 33189:s|=256;break;case 36168:s|=1024;break;case 34041:s|=256,s|=1024}a.clear(s)},t.end=function(){var t=WebGL.mainContext;t.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,RenderState2D.curRenderTarget=this._preRenderTarget,1==this._type?(t.viewport(0,0,this._svWidth,this._svHeight),RenderState2D.width=this._svWidth,RenderState2D.height=this._svHeight,BaseShader.activeShader=null):t.viewport(0,0,Laya.stage.width,Laya.stage.height)},t.getData=function(t,e,i,r){var a=WebGL.mainContext;if(a.bindFramebuffer(36160,this.bitmap.frameBuffer),!(36053==a.checkFramebufferStatus(36160)))return a.bindFramebuffer(36160,null),null;var s=new Uint8Array(this._w*this._h*4);return a.readPixels(t,e,i,r,this._surfaceFormat,this._surfaceType,s),a.bindFramebuffer(36160,null),s},t.destroy=function(t){void 0===t&&(t=!1),this._destroy||(this._loaded=!1,this.bitmap.offAll(),this.bitmap.disposeResource(),this.bitmap.dispose(),this.offAll(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,e.prototype.destroy.call(this))},t.dispose=function(){},t._createWebGLRenderTarget=function(){this.bitmap=new WebGLRenderTarget(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(t){this.event("recovered")})},__getset(0,t,"source",function(){return this._alreadyResolved?Laya.superGet(Texture,this,"source"):null}),__getset(0,t,"magFifter",function(){return this._magFifter}),__getset(0,t,"mipMap",function(){return this._mipMap}),__getset(0,t,"minFifter",function(){return this._minFifter}),__getset(0,t,"surfaceType",function(){return this._surfaceType}),__getset(0,t,"depthStencilFormat",function(){return this._depthStencilFormat}),__getset(0,t,"surfaceFormat",function(){return this._surfaceFormat}),u.create=function(t,e,i,r,a,s,n,h,l){void 0===i&&(i=6408),void 0===r&&(r=5121),void 0===a&&(a=34041),void 0===s&&(s=!1),void 0===n&&(n=!1),void 0===h&&(h=-1),void 0===l&&(l=-1);var o=u.POOL.pop();return o||(o=new u(t,e)),o.bitmap&&o._w==t&&o._h==e&&o._surfaceFormat==i&&o._surfaceType==r&&o._depthStencilFormat==a&&o._mipMap==s&&o._repeat==n&&o._minFifter==h&&o._magFifter==l||(o._w=t,o._h=e,o._surfaceFormat=i,o._surfaceType=r,o._depthStencilFormat=a,Render.isConchWebGL&&34041==o._depthStencilFormat&&(o._depthStencilFormat=33189),o._mipMap=s,o._repeat=n,o._minFifter=h,o._magFifter=l,o.release(),o._createWebGLRenderTarget()),o},u.TYPE2D=1,u.TYPE3D=2,u.POOL=[],u}(Texture),TextureSV=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=Value2D._TEXCOORD,void 0===t&&(t=0),e.__super.call(this,1,t)}__class(e,"laya.webgl.shader.d2.value.TextureSV",!1,Value2D);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(),PrimitiveSV=function(t){function e(t){this.a_color=null,this.u_pos=[0,0],e.__super.call(this,4,0),this.position=[2,5126,!1,5*CONST3D2D.BYTES_PE,0],this.a_color=[3,5126,!1,5*CONST3D2D.BYTES_PE,2*CONST3D2D.BYTES_PE]}return __class(e,"laya.webgl.shader.d2.value.PrimitiveSV",!1,Value2D),e}(),Color2dSV=function(t){function e(t){e.__super.call(this,2,0),this.color=[]}return __class(e,"laya.webgl.shader.d2.value.Color2dSV",!1,Value2D),e.prototype.setValue=function(t){t.fillStyle&&(this.color=t.fillStyle._color._color),t.strokeStyle&&(this.color=t.strokeStyle._color._color)},e}(),FillTextureSV=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=Value2D._TEXCOORD,e.__super.call(this,256,0)}__class(e,"laya.webgl.shader.d2.value.FillTextureSV",!1,Value2D);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(),SkinSV=function(t){function i(t){this.texcoord=null,this.offsetX=300,this.offsetY=0,i.__super.call(this,512,0);var e=8*CONST3D2D.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*CONST3D2D.BYTES_PE],this.color=[4,5126,!1,e,4*CONST3D2D.BYTES_PE]}return __class(i,"laya.webgl.shader.d2.skinAnishader.SkinSV",!1,Value2D),i}(),Shader=function(t){function o(t,e,i,r){if(this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,o.__super.call(this),!t||!e)throw"Shader Error";this._id=++o._count,this._vs=t,this._ps=e,this._nameMap=r||{},null!=i&&(o.sharders[i]=this)}__class(o,"laya.webgl.shader.Shader",!1,BaseShader);var e=o.prototype;return e.recreateResource=function(){this._compile(),this.completeCreate(),this.memorySize=0},e.disposeResource=function(){WebGL.mainContext.deleteShader(this._vshader),WebGL.mainContext.deleteShader(this._pshader),WebGL.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var t=[this._vs,this._ps],e=WebGL.mainContext;if(this._program=e.createProgram(),this._vshader=o._createShader(e,t[0],35633),this._pshader=o._createShader(e,t[1],35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader),e.linkProgram(this._program),!Render.isConchApp&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);var i,r,a=0,s=0;for(s=Render.isConchApp?e.getProgramParameterEx(this._vs,this._ps,"",35721):e.getProgramParameter(this._program,35721),a=0;a<s;a++){var n=null;i={vartype:"attribute",glfun:null,ivartype:0,attrib:n=Render.isConchApp?e.getActiveAttribEx(this._vs,this._ps,"",a):e.getActiveAttrib(this._program,a),location:e.getAttribLocation(this._program,n.name),name:n.name,type:n.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(i)}var h=0;for(h=Render.isConchApp?e.getProgramParameterEx(this._vs,this._ps,"",35718):e.getProgramParameter(this._program,35718),a=0;a<h;a++){var l=null;l=Render.isConchApp?e.getActiveUniformEx(this._vs,this._ps,"",a):e.getActiveUniform(this._program,a),0<(i={vartype:"uniform",glfun:null,ivartype:1,attrib:n,location:e.getUniformLocation(this._program,l.name),name:l.name,type:l.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(i.name=i.name.substr(0,i.name.length-3),i.isArray=!0,i.location=e.getUniformLocation(this._program,i.name)),this._params.push(i)}for(a=0,r=this._params.length;a<r;a++)if((i=this._params[a]).indexOfParams=a,i.index=1,i.value=[i.location,null],i.codename=i.name,i.name=this._nameMap[i.codename]?this._nameMap[i.codename]:i.codename,(this._paramsMap[i.name]=i)._this=this,i.uploadedValue=[],"attribute"!=i.vartype)switch(i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.glfun=e.uniformMatrix4fv,i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}else i.fun=this._attribute}},e.getUniform=function(t){return this._paramsMap[t]},e._attribute=function(t,e){var i=WebGL.mainContext,r=Buffer._enableAtributes,a=t.location;return r[a]||i.enableVertexAttribArray(a),i.vertexAttribPointer(a,e[0],e[1],e[2],e[3],e[4]+this._offset),r[a]=Buffer._bindVertexBuffer,1},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!=e?(WebGL.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!=e[0]||i[1]!=e[1]||i[2]!=e[2]||i[3]!=e[3]?(WebGL.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return WebGL.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!=e[0]||i[1]!=e[1]?(WebGL.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!=e[0]||i[1]!=e[1]||i[2]!=e[2]||i[3]!=e[3]?(WebGL.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return WebGL.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!=e[0]||i[1]!=e[1]||i[2]!=e[2]?(WebGL.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return WebGL.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!=e[0]||i[1]!=e[1]||i[2]!=e[2]||i[3]!=e[3]?(WebGL.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return WebGL.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return WebGL.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return WebGL.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return WebGL.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!=e?(WebGL.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return WebGL.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!=e[0]||i[1]!=e[1]?(WebGL.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return WebGL.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!=e[0]||i[1]!=e[1]||i[2]!=e[2]?(WebGL.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return WebGL.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!=e[0]||i[1]!=e[1]||i[2]!=e[2]||i[3]!=e[3]?(WebGL.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return WebGL.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=WebGL.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),i.activeTexture(o._TEXTURES[this._curActTexIndex]),WebGLContext.bindTexture(i,3553,e),this._curActTexIndex++,1):(i.activeTexture(o._TEXTURES[r[0]]),WebGLContext.bindTexture(i,3553,e),0)},e._uniform_samplerCube=function(t,e){var i=WebGL.mainContext,r=t.uploadedValue;return null==r[0]?(r[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),i.activeTexture(o._TEXTURES[this._curActTexIndex]),WebGLContext.bindTexture(i,34067,e),this._curActTexIndex++,1):(i.activeTexture(o._TEXTURES[r[0]]),WebGLContext.bindTexture(i,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){this.activeResource(),WebGLContext.UseProgram(this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},e.uploadTexture2D=function(t){Stat.shaderCall++;var e=WebGL.mainContext;e.activeTexture(33984),WebGLContext.bindTexture(e,3553,t)},e.upload=function(t,e){BaseShader.activeShader=BaseShader.bindShader=this,this._lastUseFrameCount===Stat.loopCount||this.activeResource(),WebGLContext.UseProgram(this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;WebGL.mainContext;for(var i,r,a=e.length,s=0,n=0;n<a;n++)null!=(r=t[(i=e[n]).name])&&(s+=i.fun.call(this,i,r));Stat.shaderCall+=s},e.uploadArray=function(t,e,i){BaseShader.activeShader=this,(BaseShader.bindShader=this).activeResource(),WebGLContext.UseProgram(this._program);this._params;for(var r,a,s=0,n=e-2;0<=n;n-=2)(a=this._paramsMap[t[n]])&&null!=(r=t[n+1])&&(i&&i[a.name]&&i[a.name].bind(),s+=a.fun.call(this,a,r));Stat.shaderCall+=s},e.getParams=function(){return this._params},o.getShader=function(t){return o.sharders[t]},o.create=function(t,e,i,r){return new o(t,e,i,r)},o.withCompile=function(t,e,i,r){if(i&&o.sharders[i])return o.sharders[i];var a=o._preCompileShader[2e-4*t];if(!a)throw new Error("withCompile shader err!"+t);return a.createShader(e,i,r)},o.withCompile2D=function(t,e,i,r,a){if(r&&o.sharders[r])return o.sharders[r];var s=o._preCompileShader[2e-4*t+e];if(!s)throw new Error("withCompile shader err!"+t+" "+e);return s.createShader(i,r,a)},o.addInclude=function(t,e){ShaderCompile.addInclude(t,e)},o.preCompile=function(t,e,i,r){var a=2e-4*t;o._preCompileShader[a]=new ShaderCompile(a,e,i,r)},o.preCompile2D=function(t,e,i,r,a){var s=2e-4*t+e;o._preCompileShader[s]=new ShaderCompile(s,i,r,a)},o._createShader=function(t,e,i){var r=t.createShader(i);return t.shaderSource(r,e),t.compileShader(r),r},o._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],o._count=0,o._preCompileShader={},o.SHADERNAME2ID=2e-4,o.sharders=((o.sharders=[]).length=32,o.sharders),__static(o,["nameKey",function(){return this.nameKey=new StringKey}]),o}(),AtlasWebGLCanvas=function(t){function e(){this._atlaser=null,this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,e.__super.call(this)}__class(e,"laya.webgl.atlas.AtlasWebGLCanvas",!1,t);var i=e.prototype;return i.recreateResource=function(){var t=WebGL.mainContext,e=this._source=t.createTexture(),i=WebGLContext.curBindTexTarget,r=WebGLContext.curBindTexValue;WebGLContext.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),i&&r&&WebGLContext.bindTexture(t,i,r),this.memorySize=this._w*this._h*4,this.completeCreate()},i.disposeResource=function(){this._source&&(WebGL.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.texSubImage2D=function(t,e,i){if(Render.isFlash){this._flashCacheImage||(this._flashCacheImage=HTMLImage.create(""),this._flashCacheImage._image.createCanvas(this._w,this._h));var r=i.bitmapdata;this._flashCacheImage._image.copyPixels(r,0,0,r.width,r.height,t,e),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var a=WebGL.mainContext,s=WebGLContext.curBindTexTarget,n=WebGLContext.curBindTexValue;WebGLContext.bindTexture(a,3553,this._source),Render.isConchWebGL?(0<=t-1&&a.texSubImage2DEx(!0,3553,0,t-1,e,6408,5121,i),t+1<=this._w&&a.texSubImage2DEx(!0,3553,0,t+1,e,6408,5121,i),0<=e-1&&a.texSubImage2DEx(!0,3553,0,t,e-1,6408,5121,i),e+1<=this._h&&a.texSubImage2DEx(!0,3553,0,t,e+1,6408,5121,i),a.texSubImage2DEx(!0,3553,0,t,e,6408,5121,i)):(a.pixelStorei(37441,!0),0<=t-1&&a.texSubImage2D(3553,0,t-1,e,6408,5121,i),t+1<=this._w&&a.texSubImage2D(3553,0,t+1,e,6408,5121,i),0<=e-1&&a.texSubImage2D(3553,0,t,e-1,6408,5121,i),e+1<=this._h&&a.texSubImage2D(3553,0,t,e+1,6408,5121,i),a.texSubImage2D(3553,0,t,e,6408,5121,i),a.pixelStorei(37441,!1)),s&&n&&WebGLContext.bindTexture(a,s,n)}},i.texSubImage2DPixel=function(t,e,i,r,a){var s=WebGL.mainContext,n=WebGLContext.curBindTexTarget,h=WebGLContext.curBindTexValue;WebGLContext.bindTexture(s,3553,this._source);var l=new Uint8Array(a.data);Render.isConchWebGL?s.texSubImage2DEx(!0,3553,0,t,e,i,r,6408,5121,l):(s.pixelStorei(37441,!0),s.texSubImage2D(3553,0,t,e,i,r,6408,5121,l),s.pixelStorei(37441,!1)),n&&h&&WebGLContext.bindTexture(s,n,h)},__getset(0,i,"height",t.prototype._$get_height,function(t){this._h=t}),__getset(0,i,"width",t.prototype._$get_width,function(t){this._w=t}),e}(Bitmap),WebGLSubImage=function(t){function h(t,e,i,r,a,s,n){this.offsetX=0,this.offsetY=0,h.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=s,this.canvas=t,this._ctx=t.getContext("2d",void 0),this._w=r,this._h=a,this.offsetX=e,this.offsetY=i,this.src=n,this._enableMerageInAtlas=!0,AtlasResourceManager.enabled&&this._w<AtlasResourceManager.atlasLimitWidth&&this._h<AtlasResourceManager.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}__class(h,"laya.webgl.resource.WebGLSubImage",!1,t);var e=h.prototype;return Laya.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e.size=function(t,e){this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this.canvas&&(this.canvas.height=e,this.canvas.width=t)},e.recreateResource=function(){this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},e.createWebGlTexture=function(){var t=WebGL.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var e=this._source=t.createTexture(),i=WebGLContext.curBindTexTarget,r=WebGLContext.curBindTexValue;WebGLContext.bindTexture(t,3553,e),Render.isConchWebGL?t.texImage2DEx(!0,3553,0,6408,6408,5121,this.canvas):(t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this.canvas),t.pixelStorei(37441,!1));var a=this.minFifter,s=this.magFifter,n=this.repeat?10497:33071,h=Arith.isPOT(this.width,this.height);h?(this.mipmap?-1!=a||(a=9987):-1!=a||(a=9729),-1!=s||(s=9729),t.texParameteri(3553,10240,s),t.texParameteri(3553,10241,a),t.texParameteri(3553,10242,n),t.texParameteri(3553,10243,n),this.mipmap&&t.generateMipmap(3553)):(-1!=a||(a=9729),-1!=s||(s=9729),t.texParameteri(3553,10241,a),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&r&&WebGLContext.bindTexture(t,i,r),this.canvas=null,h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4},e.disposeResource=function(){AtlasResourceManager.enabled&&this._allowMerageInAtlas||!this._source||(WebGL.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},e.clearAtlasSource=function(){},__getset(0,e,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t}),__getset(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),__getset(0,e,"atlasSource",function(){return this.canvas}),h}(Bitmap),WebGLRenderTarget=function(t){function o(t,e,i,r,a,s,n,h,l){void 0===i&&(i=6408),void 0===r&&(r=5121),void 0===a&&(a=34041),void 0===s&&(s=!1),void 0===n&&(n=!1),void 0===h&&(h=-1),void 0===l&&(l=1),o.__super.call(this),this._w=t,this._h=e,this._surfaceFormat=i,this._surfaceType=r,this._depthStencilFormat=a,Render.isConchWebGL&&34041==this._depthStencilFormat&&(this._depthStencilFormat=33189),this._mipMap=s,this._repeat=n,this._minFifter=h,this._magFifter=l}__class(o,"laya.webgl.resource.WebGLRenderTarget",!1,t);var e=o.prototype;return e.recreateResource=function(){var t=WebGL.mainContext;this._frameBuffer||(this._frameBuffer=t.createFramebuffer()),this._source||(this._source=t.createTexture());var e=WebGLContext.curBindTexTarget,i=WebGLContext.curBindTexValue;WebGLContext.bindTexture(t,3553,this._source),t.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var r=this._minFifter,a=this._magFifter,s=this._repeat?10497:33071,n=Arith.isPOT(this._w,this._h);if(n?(this._mipMap?-1!=r||(r=9987):-1!=r||(r=9729),-1!=a||(a=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,s),t.texParameteri(3553,10243,s),this._mipMap&&t.generateMipmap(3553)):(-1!=r||(r=9729),-1!=a||(a=9729),t.texParameteri(3553,10241,r),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=t.createRenderbuffer()),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.bindFramebuffer(36160,null),e&&i&&WebGLContext.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),n&&this._mipMap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this.completeCreate()},e.disposeResource=function(){this._frameBuffer&&(WebGL.mainContext.deleteTexture(this._source),WebGL.mainContext.deleteFramebuffer(this._frameBuffer),WebGL.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},__getset(0,e,"depthStencilBuffer",function(){return this._depthStencilBuffer}),__getset(0,e,"frameBuffer",function(){return this._frameBuffer}),o}(Bitmap),WebGLCharImage=function(t){function s(t,e){this.CborderSize=12,s.__super.call(this),this.char=t,this.isSpace=" "==t,this.xs=e.scaleX,this.ys=e.scaleY,this.font=e.font.toString(),this.fontSize=e.font.size,this.fillColor=e.fillColor,this.borderColor=e.borderColor,this.lineWidth=e.lineWidth,this.underLine=e.underLine;var i,r=Render.isConchApp;r?((i=ConchTextCanvas)._source=ConchTextCanvas,i._source.canvas=ConchTextCanvas):i=Browser.canvas.source,this.canvas=i,this._enableMerageInAtlas=!0,this._ctx=r?i:this.canvas.getContext("2d",void 0);var a=Utils.measureText(this.char,this.font);this.cw=a.width*this.xs,this.ch=(a.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new Texture(this)}__class(s,"laya.webgl.resource.WebGLCharImage",!1,t);var e=s.prototype;return Laya.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e.active=function(){this.texture.active()},e.recreateResource=function(){var t=Render.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),t){var e=this.fontSize;1==this.xs&&1==this.ys||(e=parseInt(e*(this.xs>this.ys?this.xs:this.ys)+""));var i="normal 100 "+e+"px Arial";this.borderColor&&(i+=" 1 "+this.borderColor),this._ctx.font=i,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,this.CborderSize,this.CborderSize,null,null,null)}else{if(this._ctx.save(),this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,Text.RightToLeft&&(this._ctx.textAlign="end"),this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this.char,0,0,null,null,null)):-1==this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this.char,0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this.char,0,0,null,null,0,null)),this.underLine){this._ctx.lineWidth=1,this._ctx.strokeStyle=this.fillColor,this._ctx.beginPath(),this._ctx.moveTo(0,this.fontSize+1);var r=this._ctx.measureText(this.char).width+1;this._ctx.lineTo(r,this.fontSize+1),this._ctx.stroke()}this._ctx.restore()}this.borderSize=this.CborderSize,this.completeCreate()},e.onresize=function(t,e){this._w=t,this._h=e,this._allowMerageInAtlas=!0},e.clearAtlasSource=function(){},__getset(0,e,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(t){this._enableMerageInAtlas=t}),__getset(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),__getset(0,e,"atlasSource",function(){return this.canvas}),s.createOneChar=function(t,e){return new s(t,e)},s}(Bitmap),WebGLCanvas=function(t){function i(){this.flipY=!0,this.premulAlpha=!1,this.alwaysChange=!1,i.__super.call(this)}__class(i,"laya.webgl.resource.WebGLCanvas",!1,t);var e=i.prototype;return e.getCanvas=function(){return this._canvas},e.clear=function(){this._ctx&&this._ctx.clear()},e.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null},e._setContext=function(t){this._ctx=t},e.getContext=function(t,e){return this._ctx?this._ctx:this._ctx=i._createContext(this)},e.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this._canvas&&(this._canvas.height=e,this._canvas.width=t))},e.activeResource=function(t){void 0===t&&(t=!1),this._source||this.recreateResource()},e.recreateResource=function(){this.createWebGlTexture(),this.completeCreate()},e.disposeResource=function(){this._source&&!this.iscpuSource&&(WebGL.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},e.createWebGlTexture=function(){var t=WebGL.mainContext;this._canvas;var e=this._source=t.createTexture();this.iscpuSource=!1;var i=WebGLContext.curBindTexTarget,r=WebGLContext.curBindTexValue;WebGLContext.bindTexture(t,3553,e),t.pixelStorei(37440,this.flipY?1:0),Render.isConchWebGL?t.texImage2DEx(this.premulAlpha,3553,0,6408,6408,5121,this._imgData):(this.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),this.premulAlpha&&t.pixelStorei(37441,!1)),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),t.pixelStorei(37440,0),this.memorySize=this._w*this._h*4,i&&r&&WebGLContext.bindTexture(t,i,r)},e.reloadCanvasData=function(){var t=WebGL.mainContext;if(!this._source)throw"reloadCanvasData error, gl texture not created!";var e=WebGLContext.curBindTexTarget,i=WebGLContext.curBindTexValue;WebGLContext.bindTexture(t,3553,this._source),Render.isConchWebGL?t.texImage2DEx(this.premulAlpha,3553,0,6408,6408,5121,this._imgData):(this.premulAlpha&&t.pixelStorei(37441,!0),t.texImage2D(3553,0,6408,6408,5121,this._imgData),this.premulAlpha&&t.pixelStorei(37441,!1)),t.pixelStorei(37440,0),e&&i&&WebGLContext.bindTexture(t,e,i)},e.texSubImage2D=function(t,e,i){var r=WebGL.mainContext,a=WebGLContext.curBindTexTarget,s=WebGLContext.curBindTexValue;WebGLContext.bindTexture(r,3553,this._source),Render.isConchWebGL?r.texSubImage2DEx(!0,3553,0,e,i,6408,5121,t._source):(r.pixelStorei(37441,!0),r.texSubImage2D(3553,0,e,i,6408,5121,t._source),r.pixelStorei(37441,!1)),a&&s&&WebGLContext.bindTexture(r,a,s)},e.toBase64=function(t,e,i){var r=null;this._canvas&&(r=this._canvas.toDataURL(t,e)),i.call(this,r)},__getset(0,e,"asBitmap",null,function(t){this._ctx&&(this._ctx.asBitmap=t)}),__getset(0,e,"source",function(){return this.alwaysChange&&this.reloadCanvasData(),this._source}),__getset(0,e,"context",function(){return this._ctx}),i._createContext=null,i}(Bitmap),Buffer2D=function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,e.__super.call(this),this.lock=!0}__class(e,"laya.webgl.utils.Buffer2D",!1,t);var i=e.prototype;return i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._buffer.byteLength||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),Stat.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Buffer._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),Buffer._gl.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),Stat.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Buffer._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),e||i){var r=this._buffer.slice(e,i);Buffer._gl.bufferSubData(this._bufferType,t,r)}else Buffer._gl.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this._bind(),this._bufferData(),!0)},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this._bind(),this._bufferSubData(t,e,i),!0)},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this.memorySize=t,e&&this._buffer&&0<this._buffer.byteLength){var i=new ArrayBuffer(t);new Uint8Array(i).set(new Uint8Array(this._buffer),0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this},i.append=function(t){this._upload=!0;var e,i;e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(t,0),this._byteLength+=e,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);for(var i=new Uint16Array(this._buffer,this._byteLength,e),r=0;r<e;r++)i[r]=t[r];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i;i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(t,e,i,r){void 0===r&&(r=1),this._upload=!0;var a,s;a=i*r,this._resizeBuffer(this._byteLength+a,!0),s=new e(this._buffer,this._byteLength);var n=0;for(n=0;n<i;n++)s[n]=t[n];this._byteLength+=a,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return Buffer._gl.bindBuffer(this._bufferType,null),Buffer._bindActive[this._bufferType]=null,BaseShader.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var r=this._bind_subUpload();return Buffer._gl.bindBuffer(this._bufferType,null),Buffer._bindActive[this._bufferType]=null,BaseShader.activeShader=null,r},i.disposeResource=function(){t.prototype.disposeResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},__getset(0,i,"byteLength",null,function(t){this._byteLength!=t&&(t<=this._buffer.byteLength||this._resizeBuffer(2*t+256,!0),this._byteLength=t)}),__getset(0,i,"bufferLength",function(){return this._buffer.byteLength}),e.__int__=function(t){IndexBuffer2D.QuadrangleIB=IndexBuffer2D.create(35044),GlUtils.fillIBQuadrangle(IndexBuffer2D.QuadrangleIB,16)},e.FLOAT32=4,e.SHORT=2,e}(Buffer),TextSV=function(t){function e(t){e.__super.call(this,64),this.defines.add(64)}__class(e,"laya.webgl.shader.d2.value.TextSV",!1,t);var i=e.prototype;return i.release=function(){(e.pool[e._length++]=this).clear()},i.clear=function(){t.prototype.clear.call(this)},e.create=function(){return e._length?e.pool[--e._length]:new e(null)},e.pool=[],e._length=0,e}(TextureSV),GlowSV=function(e){function i(t){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,i.__super.call(this,9)}__class(i,"laya.webgl.shader.d2.value.GlowSV",!1,e);var t=i.prototype;return t.setValue=function(t){e.prototype.setValue.call(this,t)},t.clear=function(){e.prototype.clear.call(this)},i}(TextureSV),Shader2X=function(t){function a(t,e,i,r){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,a.__super.call(this,t,e,i,r)}__class(a,"laya.webgl.shader.d2.Shader2X",!1,t);var e=a.prototype;return e.upload2dQuick1=function(t){this.upload(t,this._params2dQuick1||this._make2dQuick1())},e._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var t,e=this._params,i=0,r=e.length;i<r;i++)t=e[i],(Render.isFlash||"size"!=t.name&&"position"!=t.name&&"texcoord"!=t.name)&&this._params2dQuick1.push(t)}return this._params2dQuick1},e.disposeResource=function(){t.prototype.disposeResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var t,e=this._params,i=0,r=e.length;i<r;i++)t=e[i],(Render.isFlash||"size"!=t.name)&&this._params2dQuick2.push(t)}return this._params2dQuick2},a.create=function(t,e,i,r){return new a(t,e,i,r)},a}(Shader),VertexBuffer2D=function(i){function r(t,e){this._floatArray32=null,this._vertexStride=0,r.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,Render.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}__class(r,"laya.webgl.utils.VertexBuffer2D",!1,i);var t=r.prototype;return t.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},t.bind=function(t){t&&t._bind(),this._bind()},t.insertData=function(t,e){this.getFloat32Array().set(t,e),this._upload=!0},t.bind_upload=function(t){t._bind_upload()||t._bind(),this._bind_upload()||this._bind()},t._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},t.disposeResource=function(){i.prototype.disposeResource.call(this);var t=Buffer._enableAtributes;if(!Render.isConchWebGL)for(var e=0;e<10;e++)WebGL.mainContext.disableVertexAttribArray(e),t[e]=null},t.destory=function(){this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},__getset(0,t,"vertexStride",function(){return this._vertexStride}),r.create=function(t,e){return void 0===e&&(e=35048),new r(t,e)},r}(Buffer2D),IndexBuffer2D=function(t){function e(t){this._uint8Array=null,this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,Render.isFlash||(this._buffer=new ArrayBuffer(8))}__class(e,"laya.webgl.utils.IndexBuffer2D",!1,Buffer2D);var i=e.prototype;return i._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i.destory=function(){this._uint16Array=null,this._uint8Array=null,this._buffer=null},e.QuadrangleIB=null,e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(),WebGLImage=function(t){function s(t,e,i,r){if(this._format=0,this._mipmap=!1,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this._image=null,this.minFifter=0,void(this.magFifter=0)===i&&(i=6408),void 0===r&&(r=!0),s.__super.call(this,t,e),this._format=i,this._mipmap=r,this.repeat=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof t)this._url=t,this._src=t,this._image=new Browser.window.Image,e&&(e.onload&&(this.onload=e.onload),e.onerror&&(this.onerror=e.onerror),e.onCreate&&e.onCreate(this)),this._image.crossOrigin=t&&0==t.indexOf("data:")?null:"",t&&(this._image.src=t);else if(t instanceof ArrayBuffer){this._src=e,this._url=this._src;var a=new Byte(t);a.readUTFBytes(4),a.readUTFBytes(2),a.getInt16();a.endian="bigEndian",this._w=a.getInt16(),this._h=a.getInt16();a.getInt16(),a.getInt16();this._image=new Uint8Array(t,a.pos),this._format=WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL,AtlasResourceManager.enabled&&this._w<AtlasResourceManager.atlasLimitWidth&&this._h<AtlasResourceManager.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}else this._src=e,this._url=this._src,this._image=t.source||t,this.onresize();this._$5__enableMerageInAtlas=!0}__class(s,"laya.webgl.resource.WebGLImage",!1,t);var e=s.prototype;return Laya.imps(e,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),e._init_=function(t,e){},e._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=WebGL.mainContext,e=this._source=t.createTexture(),i=WebGLContext.curBindTexTarget,r=WebGLContext.curBindTexValue;if(WebGLContext.bindTexture(t,3553,e),Render.isConchWebGL)switch(this._format){case 6408:t.texImage2DEx(!0,3553,0,this._format,6408,5121,this._image);break;case WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}else{switch(t.pixelStorei(37441,!0),this._format){case 6408:t.texImage2D(3553,0,this._format,6408,5121,this._image);break;case WebGL.compressEtc1.COMPRESSED_RGB_ETC1_WEBGL:t.compressedTexImage2D(3553,0,this._format,this._w,this._h,0,this._image)}t.pixelStorei(37441,!1)}var a=this.minFifter,s=this.magFifter,n=this.repeat?10497:33071,h=Arith.isPOT(this._w,this._h);h?(this.mipmap?-1!=a||(a=9987):-1!=a||(a=9729),-1!=s||(s=9729),t.texParameteri(3553,10241,a),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,n),t.texParameteri(3553,10243,n),this.mipmap&&t.generateMipmap(3553)):(-1!=a||(a=9729),-1!=s||(s=9729),t.texParameteri(3553,10241,a),t.texParameteri(3553,10240,s),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&r&&WebGLContext.bindTexture(t,i,r),this._image.onload=null,this._image=null,h&&this.mipmap?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._recreateLock=!1},e.recreateResource=function(){var t=this;if(null!=this._src&&""!=this._src)if(this._needReleaseAgain=!1,this._image){if(this._recreateLock)return;this._allowMerageInAtlas&&this._$5__enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0;var e=this;this._image=new Browser.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){if(e._needReleaseAgain)return e._needReleaseAgain=!1,e._image.onload=null,void(e._image=null);e._allowMerageInAtlas&&e._enableMerageInAtlas?(t.memorySize=0,t._recreateLock=!1):e._createWebGlTexture(),e.completeCreate()},this._image.src=this._src}},e.disposeResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(WebGL.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},e.onresize=function(){this._w=this._image.width,this._h=this._image.height,AtlasResourceManager.enabled&&this._w<AtlasResourceManager.atlasLimitWidth&&this._h<AtlasResourceManager.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},e.clearAtlasSource=function(){this._image=null},__getset(0,e,"onload",null,function(t){var e=this;this._onload=t,this._image&&(this._image.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),__getset(0,e,"onerror",null,function(t){var e=this;this._onerror=t,this._image&&(this._image.onerror=null!=this._onerror?function(){e._onerror()}:null)}),__getset(0,e,"format",function(){return this._format}),__getset(0,e,"enableMerageInAtlas",function(){return this._$5__enableMerageInAtlas},function(t){this._$5__enableMerageInAtlas=t}),__getset(0,e,"atlasSource",function(){return this._image}),__getset(0,e,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),__getset(0,e,"mipmap",function(){return this._mipmap}),s}(HTMLImage);Laya.__init([AtlasGrid,DrawText,WebGLContext2D,ShaderCompile]),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(t,e){"use strict";for(var i in Object.defineProperty(e,"__esModule",{value:!0}),Laya){var r=Laya[i];r&&r.__isclass&&(e[i]=r)}});