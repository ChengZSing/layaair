var RotationInfo=function(){function e(){this.absolute=!1,this.alpha=NaN,this.beta=NaN,this.gamma=NaN,this.compassAccuracy=NaN}return __class(e,"laya.device.motion.RotationInfo",!0),e}(),AccelerationInfo=function(){function e(){this.x=NaN,this.y=NaN,this.z=NaN}return __class(e,"laya.device.motion.AccelerationInfo",!0),e}(),Geolocation=function(){function i(){}return __class(i,"laya.device.geolocation.Geolocation",!0),i.getCurrentPosition=function(t,n){i.navigator.geolocation.getCurrentPosition(function(e){i.position.setPosition(e),t.runWith(i.position)},function(e){n.runWith(e)},{enableHighAccuracy:i.enableHighAccuracy,timeout:i.timeout,maximumAge:i.maximumAge})},i.watchPosition=function(t,n){return i.navigator.geolocation.watchPosition(function(e){i.position.setPosition(e),t.runWith(i.position)},function(e){n.runWith(e)},{enableHighAccuracy:i.enableHighAccuracy,timeout:i.timeout,maximumAge:i.maximumAge})},i.clearWatch=function(e){i.navigator.geolocation.clearWatch(e)},i.PERMISSION_DENIED=1,i.POSITION_UNAVAILABLE=2,i.TIMEOUT=3,i.enableHighAccuracy=!1,i.maximumAge=0,__static(i,["navigator",function(){return this.navigator=Browser.window.navigator},"position",function(){return this.position=new GeolocationInfo},"supported",function(){return this.supported=!!i.navigator.geolocation},"timeout",function(){return this.timeout=1e10}]),i}(),GeolocationInfo=function(){function e(){this.pos=null,this.coords=null}__class(e,"laya.device.geolocation.GeolocationInfo",!0);var t=e.prototype;return t.setPosition=function(e){this.pos=e,this.coords=e.coords},__getset(0,t,"timestamp",function(){return this.pos.timestamp}),__getset(0,t,"heading",function(){return this.coords.heading}),__getset(0,t,"latitude",function(){return this.coords.latitude}),__getset(0,t,"altitudeAccuracy",function(){return this.coords.altitudeAccuracy}),__getset(0,t,"accuracy",function(){return this.coords.accuracy}),__getset(0,t,"altitude",function(){return this.coords.altitude}),__getset(0,t,"speed",function(){return this.coords.speed}),__getset(0,t,"longitude",function(){return this.coords.longitude}),e}(),Media=function(){function e(){}return __class(e,"laya.device.media.Media",!0),e.supported=function(){return!!Browser.window.navigator.getUserMedia},e.getMedia=function(e,t,n){Browser.window.navigator.getUserMedia&&Browser.window.navigator.getUserMedia(e,function(e){t.runWith(Browser.window.URL.createObjectURL(e))},function(e){n.runWith(e)})},e.__init$=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia},e}(),Accelerator=function(o){function n(e){n.__super.call(this),this.onDeviceOrientationChange=this.onDeviceOrientationChange.bind(this)}__class(n,"laya.device.motion.Accelerator",!1,o);var e=n.prototype;return e.on=function(e,t,n,i){return o.prototype.on.call(this,e,t,n,i),Browser.window.addEventListener("devicemotion",__bind(this,this.onDeviceOrientationChange)),this},e.off=function(e,t,n,i){return void 0===i&&(i=!1),this.hasListener(e)||Browser.window.removeEventListener("devicemotion",__bind(this,this.onDeviceOrientationChange)),o.prototype.off.call(this,e,t,n,i)},e.onDeviceOrientationChange=function(e){var t=e.interval;n.acceleration.x=e.acceleration.x,n.acceleration.y=e.acceleration.y,n.acceleration.z=e.acceleration.z,n.accelerationIncludingGravity.x=e.accelerationIncludingGravity.x,n.accelerationIncludingGravity.y=e.accelerationIncludingGravity.y,n.accelerationIncludingGravity.z=e.accelerationIncludingGravity.z,n.rotationRate.alpha=-1*e.rotationRate.gamma,n.rotationRate.beta=-1*e.rotationRate.alpha,n.rotationRate.gamma=e.rotationRate.beta,Browser.onAndriod?(n.onChrome&&(n.rotationRate.alpha*=180/Math.PI,n.rotationRate.beta*=180/Math.PI,n.rotationRate.gamma*=180/Math.PI),n.acceleration.x*=-1,n.accelerationIncludingGravity.x*=-1):Browser.onIOS&&(n.acceleration.y*=-1,n.acceleration.z*=-1,n.accelerationIncludingGravity.y*=-1,n.accelerationIncludingGravity.z*=-1,t*=1e3),this.event("change",[n.acceleration,n.accelerationIncludingGravity,n.rotationRate,t])},__getset(1,n,"instance",function(){return n._instance=n._instance||new n(0)},laya.events.EventDispatcher._$SET_instance),n.getTransformedAcceleration=function(e){(n.transformedAcceleration=n.transformedAcceleration||new AccelerationInfo).z=e.z,90==Browser.window.orientation?(n.transformedAcceleration.x=e.y,n.transformedAcceleration.y=-e.x):-90==Browser.window.orientation?(n.transformedAcceleration.x=-e.y,n.transformedAcceleration.y=e.x):Browser.window.orientation?180==Browser.window.orientation&&(n.transformedAcceleration.x=-e.x,n.transformedAcceleration.y=-e.y):(n.transformedAcceleration.x=e.x,n.transformedAcceleration.y=e.y);var t=NaN;return-90==Laya.stage.canvasDegree?(t=n.transformedAcceleration.x,n.transformedAcceleration.x=-n.transformedAcceleration.y,n.transformedAcceleration.y=t):90==Laya.stage.canvasDegree&&(t=n.transformedAcceleration.x,n.transformedAcceleration.x=n.transformedAcceleration.y,n.transformedAcceleration.y=-t),n.transformedAcceleration},n._instance=null,n.transformedAcceleration=null,__static(n,["acceleration",function(){return this.acceleration=new AccelerationInfo},"accelerationIncludingGravity",function(){return this.accelerationIncludingGravity=new AccelerationInfo},"rotationRate",function(){return this.rotationRate=new RotationInfo},"onChrome",function(){return this.onChrome=-1<Browser.userAgent.indexOf("Chrome")}]),n}(EventDispatcher),Gyroscope=function(o){function t(e){t.__super.call(this),this.onDeviceOrientationChange=this.onDeviceOrientationChange.bind(this)}__class(t,"laya.device.motion.Gyroscope",!1,o);var e=t.prototype;return e.on=function(e,t,n,i){return o.prototype.on.call(this,e,t,n,i),Browser.window.addEventListener("deviceorientation",__bind(this,this.onDeviceOrientationChange)),this},e.off=function(e,t,n,i){return void 0===i&&(i=!1),this.hasListener(e)||Browser.window.removeEventListener("deviceorientation",__bind(this,this.onDeviceOrientationChange)),o.prototype.off.call(this,e,t,n,i)},e.onDeviceOrientationChange=function(e){t.info.alpha=e.alpha,t.info.beta=e.beta,t.info.gamma=e.gamma,e.webkitCompassHeading&&(t.info.alpha=-1*e.webkitCompassHeading,t.info.compassAccuracy=e.webkitCompassAccuracy),this.event("change",[e.absolute,t.info])},__getset(1,t,"instance",function(){return t._instance=t._instance||new t(0)},laya.events.EventDispatcher._$SET_instance),t._instance=null,__static(t,["info",function(){return this.info=new RotationInfo}]),t}(EventDispatcher),Shake=function(e){function t(){this.throushold=0,this.shakeInterval=0,this.callback=null,this.lastX=NaN,this.lastY=NaN,this.lastZ=NaN,this.lastMillSecond=NaN,t.__super.call(this)}__class(t,"laya.device.Shake",!1,e);var n=t.prototype;return n.start=function(e,t){this.throushold=e,this.shakeInterval=t,this.lastX=this.lastY=this.lastZ=NaN,Accelerator.instance.on("change",this,__bind(this,this.onShake))},n.stop=function(){Accelerator.instance.off("change",this,__bind(this,this.onShake))},n.onShake=function(e,t,n,i){if(isNaN(this.lastX))return this.lastX=t.x,this.lastY=t.y,this.lastZ=t.z,void(this.lastMillSecond=Browser.now());var o=Math.abs(this.lastX-t.x),a=Math.abs(this.lastY-t.y),r=Math.abs(this.lastZ-t.z);this.isShaked(o,a,r)&&(Browser.now()-this.lastMillSecond>this.shakeInterval&&(this.event("change"),this.lastMillSecond=Browser.now()));this.lastX=t.x,this.lastY=t.y,this.lastZ=t.z},n.isShaked=function(e,t,n){return e>this.throushold&&t>this.throushold||e>this.throushold&&n>this.throushold||t>this.throushold&&n>this.throushold},__getset(1,t,"instance",function(){return t._instance=t._instance||new t},laya.events.EventDispatcher._$SET_instance),t._instance=null,t}(EventDispatcher),Video=function(n){function i(e,t){this.htmlVideo=null,this.videoElement=null,this.internalTexture=null,void 0===e&&(e=320),void 0===t&&(t=240),i.__super.call(this),Render.isWebGL?this.htmlVideo=new WebGLVideo:this.htmlVideo=new HtmlVideo,this.videoElement=this.htmlVideo.getVideo(),(this.videoElement.layaTarget=this).internalTexture=new Texture(this.htmlVideo),this.videoElement.addEventListener("abort",i.onAbort),this.videoElement.addEventListener("canplay",i.onCanplay),this.videoElement.addEventListener("canplaythrough",i.onCanplaythrough),this.videoElement.addEventListener("durationchange",i.onDurationchange),this.videoElement.addEventListener("emptied",i.onEmptied),this.videoElement.addEventListener("error",i.onError),this.videoElement.addEventListener("loadeddata",i.onLoadeddata),this.videoElement.addEventListener("loadedmetadata",i.onLoadedmetadata),this.videoElement.addEventListener("loadstart",i.onLoadstart),this.videoElement.addEventListener("pause",i.onPause),this.videoElement.addEventListener("play",i.onPlay),this.videoElement.addEventListener("playing",i.onPlaying),this.videoElement.addEventListener("progress",i.onProgress),this.videoElement.addEventListener("ratechange",i.onRatechange),this.videoElement.addEventListener("seeked",i.onSeeked),this.videoElement.addEventListener("seeking",i.onSeeking),this.videoElement.addEventListener("stalled",i.onStalled),this.videoElement.addEventListener("suspend",i.onSuspend),this.videoElement.addEventListener("timeupdate",i.onTimeupdate),this.videoElement.addEventListener("volumechange",i.onVolumechange),this.videoElement.addEventListener("waiting",i.onWaiting),this.videoElement.addEventListener("ended",this.onPlayComplete.bind(this)),this.size(e,t),Browser.onMobile&&(this.onDocumentClick=this.onDocumentClick.bind(this),Browser.document.addEventListener("touchend",__bind(this,this.onDocumentClick)))}__class(i,"laya.device.media.Video",!1,n);var e=i.prototype;return e.onPlayComplete=function(e){Laya.timer.clear(this,__bind(this,this.renderCanvas)),this.event("ended")},e.load=function(e){0==e.indexOf("blob:")?this.videoElement.src=e:this.htmlVideo.setSource(e,laya.device.media.Video.MP4)},e.play=function(){this.videoElement.play(),Laya.timer.frameLoop(1,this,__bind(this,this.renderCanvas))},e.pause=function(){this.videoElement.pause(),Laya.timer.clear(this,__bind(this,this.renderCanvas))},e.reload=function(){this.videoElement.load()},e.canPlayType=function(e){var t;switch(e){case laya.device.media.Video.MP4:t="video/mp4";break;case laya.device.media.Video.OGG:t="video/ogg";break;case laya.device.media.Video.WEBM:t="video/webm"}return this.videoElement.canPlayType(t)},e.renderCanvas=function(){0!=this.readyState&&(Render.isWebGL&&this.htmlVideo.updateTexture(),this.graphics.clear(),this.graphics.drawTexture(this.internalTexture,0,0,this.width,this.height))},e.onDocumentClick=function(){this.videoElement.play(),this.videoElement.pause(),Browser.document.removeEventListener("touchend",__bind(this,this.onDocumentClick))},e.size=function(e,t){return n.prototype.size.call(this,e,t),this.videoElement.width=e/Browser.pixelRatio,this.paused&&this.renderCanvas(),this},e.destroy=function(e){void 0===e&&(e=!0),n.prototype.destroy.call(this,e),this.videoElement.removeEventListener("abort",i.onAbort),this.videoElement.removeEventListener("canplay",i.onCanplay),this.videoElement.removeEventListener("canplaythrough",i.onCanplaythrough),this.videoElement.removeEventListener("durationchange",i.onDurationchange),this.videoElement.removeEventListener("emptied",i.onEmptied),this.videoElement.removeEventListener("error",i.onError),this.videoElement.removeEventListener("loadeddata",i.onLoadeddata),this.videoElement.removeEventListener("loadedmetadata",i.onLoadedmetadata),this.videoElement.removeEventListener("loadstart",i.onLoadstart),this.videoElement.removeEventListener("pause",i.onPause),this.videoElement.removeEventListener("play",i.onPlay),this.videoElement.removeEventListener("playing",i.onPlaying),this.videoElement.removeEventListener("progress",i.onProgress),this.videoElement.removeEventListener("ratechange",i.onRatechange),this.videoElement.removeEventListener("seeked",i.onSeeked),this.videoElement.removeEventListener("seeking",i.onSeeking),this.videoElement.removeEventListener("stalled",i.onStalled),this.videoElement.removeEventListener("suspend",i.onSuspend),this.videoElement.removeEventListener("timeupdate",i.onTimeupdate),this.videoElement.removeEventListener("volumechange",i.onVolumechange),this.videoElement.removeEventListener("waiting",i.onWaiting),this.videoElement.removeEventListener("ended",__bind(this,this.onPlayComplete)),this.pause(),this.videoElement=null},e.syncVideoPosition=function(){var e,t=Laya.stage;e=Utils.getGlobalPosAndScale(this);var n=t._canvasTransform.a,i=t._canvasTransform.d,o=e.x*t.clientScaleX*n+t.offset.x,a=e.y*t.clientScaleY*i+t.offset.y;this.videoElement.style.left=o+"px",this.videoElement.style.top=a+"px",this.videoElement.width=this.width/Browser.pixelRatio,this.videoElement.height=this.height/Browser.pixelRatio},__getset(0,e,"height",n.prototype._$get_height,function(e){Laya.superSet(Sprite,this,"height",e),this.paused&&this.renderCanvas()}),__getset(0,e,"seeking",function(){return this.videoElement.seeking}),__getset(0,e,"preload",function(){return this.videoElement.preload},function(e){this.videoElement.preload=e}),__getset(0,e,"seekable",function(){return this.videoElement.seekable}),__getset(0,e,"paused",function(){return this.videoElement.paused}),__getset(0,e,"loop",function(){return this.videoElement.loop},function(e){this.videoElement.loop=e}),__getset(0,e,"ended",function(){return this.videoElement.ended}),__getset(0,e,"muted",function(){return this.videoElement.muted},function(e){this.videoElement.muted=e}),__getset(0,e,"duration",function(){return this.videoElement.duration}),__getset(0,e,"videoHeight",function(){return this.videoElement.videoHeight}),__getset(0,e,"videoWidth",function(){return this.videoElement.videoWidth}),__getset(0,e,"playbackRate",function(){return this.videoElement.playbackRate},function(e){this.videoElement.playbackRate=e}),__getset(0,e,"currentSrc",function(){return this.videoElement.currentSrc}),__getset(0,e,"readyState",function(){return this.videoElement.readyState}),__getset(0,e,"volume",function(){return this.videoElement.volume},function(e){this.videoElement.volume=e}),__getset(0,e,"width",n.prototype._$get_width,function(e){this.videoElement.width=this.width/Browser.pixelRatio,Laya.superSet(Sprite,this,"width",e),this.paused&&this.renderCanvas()}),__getset(0,e,"currentTime",function(){return this.videoElement.currentTime},function(e){this.videoElement.currentTime=e,this.renderCanvas()}),__getset(0,e,"error",function(){return this.videoElement.error}),__getset(0,e,"buffered",function(){return this.videoElement.buffered}),i.onAbort=function(e){e.target.layaTarget.event("abort")},i.onCanplay=function(e){e.target.layaTarget.event("canplay")},i.onCanplaythrough=function(e){e.target.layaTarget.event("canplaythrough")},i.onDurationchange=function(e){e.target.layaTarget.event("durationchange")},i.onEmptied=function(e){e.target.layaTarget.event("emptied")},i.onError=function(e){e.target.layaTarget.event("error")},i.onLoadeddata=function(e){e.target.layaTarget.event("loadeddata")},i.onLoadedmetadata=function(e){e.target.layaTarget.event("loadedmetadata")},i.onLoadstart=function(e){e.target.layaTarget.event("loadstart")},i.onPause=function(e){e.target.layaTarget.event("pause")},i.onPlay=function(e){e.target.layaTarget.event("play")},i.onPlaying=function(e){e.target.layaTarget.event("playing")},i.onProgress=function(e){e.target.layaTarget.event("progress")},i.onRatechange=function(e){e.target.layaTarget.event("ratechange")},i.onSeeked=function(e){e.target.layaTarget.event("seeked")},i.onSeeking=function(e){e.target.layaTarget.event("seeking")},i.onStalled=function(e){e.target.layaTarget.event("stalled")},i.onSuspend=function(e){e.target.layaTarget.event("suspend")},i.onTimeupdate=function(e){e.target.layaTarget.event("timeupdate")},i.onVolumechange=function(e){e.target.layaTarget.event("volumechange")},i.onWaiting=function(e){e.target.layaTarget.event("waiting")},i.MP4=1,i.OGG=2,i.CAMERA=4,i.WEBM=8,i.SUPPORT_PROBABLY="probably",i.SUPPORT_MAYBY="maybe",i.SUPPORT_NO="",i}(Sprite),HtmlVideo=function(e){function t(){this.video=null,t.__super.call(this),this._w=1,this._h=1,this.createDomElement()}__class(t,"laya.device.media.HtmlVideo",!1,e);var n=t.prototype;return n.createDomElement=function(){var e=this;this._source=this.video=Browser.createElement("video");var t=this.video.style;t.position="absolute",t.top="0px",t.left="0px",this.video.addEventListener("loadedmetadata",function(){this._w=e.video.videoWidth,this._h=e.video.videoHeight}.bind(this))},n.setSource=function(e,t){for(;this.video.childElementCount;)this.video.firstChild.remove();t&Video.MP4&&this.appendSource(e,"video/mp4"),t&Video.OGG&&this.appendSource(e+".ogg","video/ogg")},n.appendSource=function(e,t){var n=Browser.createElement("source");n.src=e,n.type=t,this.video.appendChild(n)},n.getVideo=function(){return this.video},t.create=function(){return new t},t}(Bitmap),WebGLVideo=function(e){function t(){this.gl=null,this.preTarget=null,this.preTexture=null,t.__super.call(this),Browser.onIPhone||(this.gl=WebGL.mainContext,this._source=this.gl.createTexture(),this.preTarget=WebGLContext.curBindTexTarget,this.preTexture=WebGLContext.curBindTexValue,WebGLContext.bindTexture(this.gl,3553,this._source),this.gl.texParameteri(3553,10242,33071),this.gl.texParameteri(3553,10243,33071),this.gl.texParameteri(3553,10240,9729),this.gl.texParameteri(3553,10241,9729),this.preTarget&&this.preTexture&&WebGLContext.bindTexture(this.gl,this.preTarget,this.preTexture))}return __class(t,"laya.device.media.WebGLVideo",!1,HtmlVideo),t.prototype.updateTexture=function(){Browser.onIPhone||(WebGLContext.bindTexture(this.gl,3553,this._source),this.gl.texImage2D(3553,0,6407,6407,5121,this.video))},t}();Laya.__init([Media]),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(e,t){"use strict";for(var n in Object.defineProperty(t,"__esModule",{value:!0}),Laya){var i=Laya[n];i&&i.__isclass&&(t[n]=i)}});